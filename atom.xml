<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>戚名钰的博客</title>
  <subtitle>怀揣创业梦的信安践行者</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://qimingyu.github.io/"/>
  <updated>2016-08-22T15:20:28.598Z</updated>
  <id>http://qimingyu.github.io/</id>
  
  <author>
    <name>戚名钰</name>
    <email>mingyuqi.java@qq.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>对手机安全SDK的大数据分析</title>
    <link href="http://qimingyu.github.io/2016/08/22/%E5%AF%B9%E6%89%8B%E6%9C%BA%E5%AE%89%E5%85%A8SDK%E7%9A%84%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    <id>http://qimingyu.github.io/2016/08/22/对手机安全SDK的大数据分析/</id>
    <published>2016-08-22T14:35:37.000Z</published>
    <updated>2016-08-22T15:20:28.598Z</updated>
    
    <content type="html">&lt;h4 id=&quot;1-前言&quot;&gt;&lt;a href=&quot;#1-前言&quot; class=&quot;headerlink&quot; title=&quot;1.前言&quot;&gt;&lt;/a&gt;1.前言&lt;/h4&gt;&lt;p&gt;由于很多东西没有说清楚，浪费了大量时间搞明白数据怎么来的以及各个数据的意义等，整个流程不清晰，数据怎么来的？怎么上报的？给我的数据已经经过哪些处理？现在是怎样的？这些信息都是模糊的，直接接手做这件事，就显得的非常乱，然后就是一点一点摸，终于才搞的差不多。&lt;/p&gt;
&lt;h4 id=&quot;2-认识数据&quot;&gt;&lt;a href=&quot;#2-认识数据&quot; class=&quot;headerlink&quot; title=&quot;2.认识数据&quot;&gt;&lt;/a&gt;2.认识数据&lt;/h4&gt;&lt;p&gt;以CUID作为记录唯一标识，统计截止到8月13日的所有上报数据。&lt;br&gt;根据&lt;code&gt;log_id&lt;/code&gt;有8类数据有上报，每类log上报的不同之处在于其&lt;code&gt;d2&lt;/code&gt;字段的信息。&lt;/p&gt;
&lt;p&gt;以我的理解整理如下：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;report.mobile_cuid_0725&lt;/code&gt;是不带日期的黑CUID&lt;br&gt;&lt;code&gt;report.mobile_cuid_with_date&lt;/code&gt;是带日期的黑CUID&lt;/p&gt;
&lt;p&gt;两个数据库一模一样，唯一的区别是一个带日期，一个不带日期&lt;/p&gt;
&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;count&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;DISTINCT&lt;/span&gt; cuid) &lt;span class=&quot;keyword&quot;&gt;AS&lt;/span&gt; cuid_number &lt;span class=&quot;keyword&quot;&gt;FROM&lt;/span&gt; mobile_cuid_0725&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;是&lt;code&gt;179410&lt;/code&gt;条记录，去重之后的CUID是179410条记录，这是黑CUID。（这里的数据与徐超汇报PPT里面的数据不一致，经确认，以这个数据为准）&lt;/p&gt;
&lt;p&gt;&lt;code&gt;data_security_lab_shadow&lt;/code&gt;数据是安全SDK上报的数据，有白有黑，需要和&lt;code&gt;mobile_cuid_0725&lt;/code&gt;里面的CUID进行比对，规定在&lt;code&gt;mobile_cuid_0725&lt;/code&gt;数据库中出现过的CUID为黑，没有在&lt;code&gt;mobile_cuid_0725&lt;/code&gt;出现过的CUID为白，把&lt;code&gt;data_security_lab_shadow&lt;/code&gt;中的数据分为了两类。&lt;/p&gt;
&lt;p&gt;在进行CUID对比的过程中，&lt;code&gt;data_security_lab_shadow&lt;/code&gt;中的CUID和&lt;code&gt;mobile_cuid_0725&lt;/code&gt;中的CUID还不一样，&lt;br&gt;前者的格式为：&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471090027900.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;p&gt;后者的格式为：&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471089442503.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;因此查询过程中还要对前者的CUID进行切割，取前面的与后者进行比较，同时还要将其转化为大写。&lt;/p&gt;
&lt;p&gt;前者的黑CUID要完全去重：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;DISTINCT&lt;/span&gt; cuid  &lt;span class=&quot;keyword&quot;&gt;FROM&lt;/span&gt; mobile_cuid_0725&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;结果共&lt;code&gt;179410&lt;/code&gt;条记录，后者安全SDK上报的数据，CUID会有重复的。&lt;/p&gt;
&lt;h4 id=&quot;3-基础知识&quot;&gt;&lt;a href=&quot;#3-基础知识&quot; class=&quot;headerlink&quot; title=&quot;3.基础知识&quot;&gt;&lt;/a&gt;3.基础知识&lt;/h4&gt;&lt;p&gt;数据库操作&lt;code&gt;union&lt;/code&gt;与&lt;code&gt;union all&lt;/code&gt;的区别，前者自动去重，后者不去重。&lt;br&gt;当两个数据集A和B进行&lt;code&gt;leftouterjoin&lt;/code&gt;的时候，例如：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;A&lt;/th&gt;
&lt;th style=&quot;text-align:right&quot;&gt;B&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;（1，2）&lt;/td&gt;
&lt;td style=&quot;text-align:right&quot;&gt;（3，2）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;（3，4）&lt;/td&gt;
&lt;td style=&quot;text-align:right&quot;&gt;（3，3）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;code&gt;leftouterjoin&lt;/code&gt;之后，变为：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;C&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;（1，2，none）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;（3，4，2）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;（3，4，3 ）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;现在是主要目标是针对&lt;code&gt;data_security_lab_shadow&lt;/code&gt;中的两类数据，对其他字段进行人工统计分析，找出一些规律。&lt;/p&gt;
&lt;h4 id=&quot;4-解决问题&quot;&gt;&lt;a href=&quot;#4-解决问题&quot; class=&quot;headerlink&quot; title=&quot;4.解决问题&quot;&gt;&lt;/a&gt;4.解决问题&lt;/h4&gt;&lt;p&gt;以下一共有七个方面的信息需要统计，未完待续。。。&lt;/p&gt;
&lt;h5 id=&quot;4-1-统计黑cuid发生钱包欺诈交易时间点附近的设备状态，包括安装的应用信息、病毒扫描信息等，看看有没有什么规律（没有统计过）&quot;&gt;&lt;a href=&quot;#4-1-统计黑cuid发生钱包欺诈交易时间点附近的设备状态，包括安装的应用信息、病毒扫描信息等，看看有没有什么规律（没有统计过）&quot; class=&quot;headerlink&quot; title=&quot;4.1 统计黑cuid发生钱包欺诈交易时间点附近的设备状态，包括安装的应用信息、病毒扫描信息等，看看有没有什么规律（没有统计过）&quot;&gt;&lt;/a&gt;4.1 统计黑cuid发生钱包欺诈交易时间点附近的设备状态，包括安装的应用信息、病毒扫描信息等，看看有没有什么规律（没有统计过）&lt;/h5&gt;&lt;p&gt;#####4.2 黑白样本CUID“应用监控（logid=1001005，1001001，1001002）”上报的平均条数（时间粒度分为周、半月、月），后期例行化的统计应用监控的上报情况，监控上报次数突增的一些cuid。&lt;/p&gt;
&lt;p&gt;1周(week)=604800秒(s)&lt;br&gt;15天(d)=1296000秒(s)&lt;br&gt;30天(d)=2592000秒(s)&lt;/p&gt;
&lt;p&gt;1001005是应用监控日志：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;首次全量上报验证&lt;/li&gt;
&lt;li&gt;以后增量上报验证&lt;/li&gt;
&lt;li&gt;有新安装APP验证&lt;/li&gt;
&lt;li&gt;APP升级上报验证&lt;/li&gt;
&lt;li&gt;卸载APP上报验证&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;因为是统计上报的条数，因此黑白样本均不用去重。&lt;br&gt;黑样本，&lt;code&gt;tmp.qi_black_week&lt;/code&gt;：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; b.guid cuid,&lt;span class=&quot;keyword&quot;&gt;round&lt;/span&gt;(b.server_time/&lt;span class=&quot;number&quot;&gt;604800&lt;/span&gt;) server_time &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;DISTINCT&lt;/span&gt; cuid &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; tmp.mobile_cuid_with_date)a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;outer&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;join&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;upper&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;split&lt;/span&gt;(cuid,&lt;span class=&quot;string&quot;&gt;&#39;\\|&#39;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]) guid,server_time &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; report.data_security_lab_shadow  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; log_id = &lt;span class=&quot;number&quot;&gt;1001005&lt;/span&gt;)b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; a.cuid=b.guid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; b.guid &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;每个cuid提交的日志总次数分布图：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; cuid,&lt;span class=&quot;keyword&quot;&gt;count&lt;/span&gt;(*) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;FROM&lt;/span&gt; qi_black_week_1001005 &lt;span class=&quot;keyword&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;by&lt;/span&gt; cuid&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;images/2016-8-22/1471432633357.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;黑样本上报日志数：1139447，黑样本cuid数：2613，平均每个cuid上报日志数：436&lt;/p&gt;
&lt;p&gt;白样本，&lt;code&gt;tmp.qi_white_week&lt;/code&gt;:&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; b.guid cuid,&lt;span class=&quot;keyword&quot;&gt;round&lt;/span&gt;(b.server_time/&lt;span class=&quot;number&quot;&gt;604800&lt;/span&gt;) server_time &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;DISTINCT&lt;/span&gt; cuid &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; tmp.mobile_cuid_with_date)a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;right&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;outer&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;join&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;upper&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;split&lt;/span&gt;(cuid,&lt;span class=&quot;string&quot;&gt;&#39;\\|&#39;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]) guid,server_time &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; report.data_security_lab_shadow  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; log_id = &lt;span class=&quot;number&quot;&gt;1001005&lt;/span&gt;)b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; a.cuid=b.guid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; a.cuid &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;以星期为单位显示每个cuid提交日志的次数：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; cuid,&lt;span class=&quot;keyword&quot;&gt;count&lt;/span&gt;(*) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;FROM&lt;/span&gt; qi_white_week_1001005 &lt;span class=&quot;keyword&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;by&lt;/span&gt; cuid&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;images/2016-8-22/1471436481327.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;白样本上报日志数：8406988077，白样本cuid数：9249604，平均每个cuid上报日志数：908&lt;/p&gt;
&lt;p&gt;1001109是扫描宿主安全运行环境&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;被宿主调用时上报&lt;/li&gt;
&lt;li&gt;24小时上报&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;黑样本：&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471437386372.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;黑样本共上报记录数：33113，黑样本cuid数：2351，平均每个cuid上报：14&lt;/p&gt;
&lt;p&gt;白样本：&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471437742497.png&quot; alt=&quot;Alt text&quot;&gt;&lt;br&gt;白样本共上报记录数：217951423，白样本cuid数：10917661，平均每个cuid上报：20&lt;/p&gt;
&lt;p&gt;结论：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&quot;4-3-整理出每天的登陆ip和cuid的对应关系，关注登陆cuid过多的ip。使用我们的接口查询ip的情况，筛选出恶意ip，以及其对应的cuid（例行化）。&quot;&gt;&lt;a href=&quot;#4-3-整理出每天的登陆ip和cuid的对应关系，关注登陆cuid过多的ip。使用我们的接口查询ip的情况，筛选出恶意ip，以及其对应的cuid（例行化）。&quot; class=&quot;headerlink&quot; title=&quot;4.3  整理出每天的登陆ip和cuid的对应关系，关注登陆cuid过多的ip。使用我们的接口查询ip的情况，筛选出恶意ip，以及其对应的cuid（例行化）。&quot;&gt;&lt;/a&gt;4.3  整理出每天的登陆ip和cuid的对应关系，关注登陆cuid过多的ip。使用我们的接口查询ip的情况，筛选出恶意ip，以及其对应的cuid（例行化）。&lt;/h5&gt;&lt;h5 id=&quot;4-4-统计最新全量黑白CUID安装和卸载全部应用的情况（查看应用监控数据（logid-1001005）），提取出在黑白样本中区分度比较大的应用，整理出列表。&quot;&gt;&lt;a href=&quot;#4-4-统计最新全量黑白CUID安装和卸载全部应用的情况（查看应用监控数据（logid-1001005）），提取出在黑白样本中区分度比较大的应用，整理出列表。&quot; class=&quot;headerlink&quot; title=&quot;4.4 统计最新全量黑白CUID安装和卸载全部应用的情况（查看应用监控数据（logid=1001005）），提取出在黑白样本中区分度比较大的应用，整理出列表。&quot;&gt;&lt;/a&gt;4.4 统计最新全量黑白CUID安装和卸载全部应用的情况（查看应用监控数据（logid=1001005）），提取出在黑白样本中区分度比较大的应用，整理出列表。&lt;/h5&gt;&lt;p&gt;白样本，&lt;code&gt;tmp.qi_white_week&lt;/code&gt;：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; b.guid cuid,b.d2 &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;DISTINCT&lt;/span&gt; cuid &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; tmp.mobile_cuid_with_date)a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;right&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;outer&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;join&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;upper&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;split&lt;/span&gt;(cuid,&lt;span class=&quot;string&quot;&gt;&#39;\\|&#39;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]) guid,d2 &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; report.data_security_lab_shadow  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; log_id = &lt;span class=&quot;number&quot;&gt;1001005&lt;/span&gt;)b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; a.cuid=b.guid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; a.cuid &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; SparkContext,SparkConf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark.sql &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; HiveContext,SQLContext&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; sys&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;reload (sys)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sys.setdefaultencoding(&lt;span class=&quot;string&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;parseLine&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(rowLine)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record=[]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record.append(&lt;span class=&quot;string&quot;&gt;&#39;qi&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record.append(&lt;span class=&quot;string&quot;&gt;&#39;mingyu&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]=(rowLine.cuid)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]=&lt;span class=&quot;string&quot;&gt;&#39;qimingyu&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; rowLine.d2 != &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; rowLine.d2.has_key(&lt;span class=&quot;string&quot;&gt;&#39;2&#39;&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; rowLine.d2[&lt;span class=&quot;string&quot;&gt;&#39;2&#39;&lt;/span&gt;] != &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                record[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]=rowLine.d2[&lt;span class=&quot;string&quot;&gt;&#39;2&#39;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                record[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]=&lt;span class=&quot;string&quot;&gt;&#39;qimingyu&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            record[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]=&lt;span class=&quot;string&quot;&gt;&#39;qimingyu&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        record[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]=&lt;span class=&quot;string&quot;&gt;&#39;qimingyu&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; str(record[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;])+&lt;span class=&quot;string&quot;&gt;&quot;,&quot;&lt;/span&gt;+record[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; __name__==&lt;span class=&quot;string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    conf = SparkConf().setAppName(&lt;span class=&quot;string&quot;&gt;&quot;spark_sql_demo&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.network.timeout&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;3000&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.driver.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;1024&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.executor.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;1024&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.storage.memoryFraction&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;0.1&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.akka.frameSize&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;500&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc = SparkContext(conf=conf)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    hc = HiveContext(sparkContext=sc)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# sql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    cmd=&lt;span class=&quot;string&quot;&gt;&#39;select * from tmp.qi&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sqlraw = hc.sql(cmd)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# DataFrame to RDD&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result = sqlraw.map(parseLine)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# save as txt&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result.saveAsTextFile(&lt;span class=&quot;string&quot;&gt;&quot;hdfs://yq01-sw-hds01.yq01.baidu.com:8020/tmp/qimingyu/qi_white_1001005&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc.stop()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;黑样本，&lt;code&gt;tmp.qi_black_week&lt;/code&gt;：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; b.guid cuid,b.d2 &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;DISTINCT&lt;/span&gt; cuid &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; tmp.mobile_cuid_with_date)a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;outer&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;join&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;upper&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;split&lt;/span&gt;(cuid,&lt;span class=&quot;string&quot;&gt;&#39;\\|&#39;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]) guid,都 &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; report.data_security_lab_shadow  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; log_id = &lt;span class=&quot;number&quot;&gt;1001005&lt;/span&gt;)b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; a.cuid=b.guid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; b.guid &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; SparkContext,SparkConf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark.sql &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; HiveContext,SQLContext&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; sys&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;reload (sys)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sys.setdefaultencoding(&lt;span class=&quot;string&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;parseLine&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(rowLine)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record=[]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record.append(rowLine.cuid)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; rowLine.d2 == &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        record.append(&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; rowLine.d2.has_key(&lt;span class=&quot;string&quot;&gt;&#39;2&#39;&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            record.append(rowLine.d2[&lt;span class=&quot;string&quot;&gt;&#39;2&#39;&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            record.append(&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; record[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]+&lt;span class=&quot;string&quot;&gt;&quot;,&quot;&lt;/span&gt;+record[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; __name__==&lt;span class=&quot;string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    conf = SparkConf().setAppName(&lt;span class=&quot;string&quot;&gt;&quot;spark_sql_black_1001005&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.network.timeout&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;3000&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.driver.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;1024&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.executor.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;1024&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.storage.memoryFraction&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;0.1&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.akka.frameSize&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;500&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc = SparkContext(conf=conf)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    hc = HiveContext(sparkContext=sc)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# sql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    cmd=&lt;span class=&quot;string&quot;&gt;&#39;select * from tmp.qi_black_1001005_app&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sqlraw = hc.sql(cmd)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# DataFrame to RDD&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result = sqlraw.map(parseLine)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# save as txt&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result.saveAsTextFile(&lt;span class=&quot;string&quot;&gt;&quot;hdfs://yq01-sw-hds01.yq01.baidu.com:8020/tmp/qimingyu/qi_black_1001005_app&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc.stop()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;处理程序的时候遇到的第一个问题就是中英文的问题，python编码，遇到的第二个问题是数据异常的处理，有空值和一些莫名其妙的Hug等。&lt;/p&gt;
&lt;h5 id=&quot;4-5-统计CUID对应多个IMEI和IMSI的情况，列出来（例行化）。&quot;&gt;&lt;a href=&quot;#4-5-统计CUID对应多个IMEI和IMSI的情况，列出来（例行化）。&quot; class=&quot;headerlink&quot; title=&quot;4.5 统计CUID对应多个IMEI和IMSI的情况，列出来（例行化）。&quot;&gt;&lt;/a&gt;4.5 统计CUID对应多个IMEI和IMSI的情况，列出来（例行化）。&lt;/h5&gt;&lt;p&gt;CUID是百度设备唯一标识&lt;br&gt;IMEI（国际移动台设备识别码），与设备唯一对应，对应的logid：1001112&lt;br&gt;IMSI（国际移动客户识别码），与SIM卡唯一对应，对应的logid：1001112&lt;/p&gt;
&lt;p&gt;logid=1001112，一共上报条数2092164264条记录&lt;br&gt;其中黑样本上报记录数218153条，白样本上报记录数2091946111，&lt;br&gt;去重之后黑样本上报记录数165499条，白样本上报记录数1480943247&lt;br&gt;这里的去重是&lt;code&gt;guid&lt;/code&gt;和&lt;code&gt;d2&lt;/code&gt;完全相同的算一条记录：&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471349322240.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;黑样本（tmp.qi_black_cuid）：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; b.guid,b.d2 &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;DISTINCT&lt;/span&gt; cuid &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; tmp.mobile_cuid_with_date)a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;outer&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;join&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;upper&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;split&lt;/span&gt;(cuid,&lt;span class=&quot;string&quot;&gt;&#39;\\|&#39;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]) guid,d2 &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; report.data_security_lab_shadow  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; log_id = &lt;span class=&quot;number&quot;&gt;1001112&lt;/span&gt;)b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; a.cuid=b.guid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; b.guid &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;黑样本去重：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;distinct&lt;/span&gt; * &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; tmp.qi_black_cuid&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;白样本（tmp.qi_white_cuid）&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; b.guid,b.d2 &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;DISTINCT&lt;/span&gt; cuid &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; tmp.mobile_cuid_with_date)a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;right&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;outer&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;join&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;upper&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;split&lt;/span&gt;(cuid,&lt;span class=&quot;string&quot;&gt;&#39;\\|&#39;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]) guid,d2 &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; report.data_security_lab_shadow  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; log_id = &lt;span class=&quot;number&quot;&gt;1001112&lt;/span&gt;)b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; a.cuid=b.guid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; a.cuid &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;白样本去重：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;distinct&lt;/span&gt; * &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; tmp.qi_white_cuid&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后在Spark-SQL中编写如下的程序&lt;code&gt;black_cuid_ip.py&lt;/code&gt;进行统计：&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; SparkContext,SparkConf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark.sql &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; HiveContext,SQLContext&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; sys&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;parseLine&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(rowLine)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record=&amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record[&lt;span class=&quot;string&quot;&gt;&#39;cuid&#39;&lt;/span&gt;] = rowLine.guid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; rowLine.d2[&lt;span class=&quot;string&quot;&gt;&#39;0&#39;&lt;/span&gt;] == &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        record[&lt;span class=&quot;string&quot;&gt;&#39;imei&#39;&lt;/span&gt;] = set()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        record[&lt;span class=&quot;string&quot;&gt;&#39;imei&#39;&lt;/span&gt;] = set([rowLine.d2[&lt;span class=&quot;string&quot;&gt;&#39;0&#39;&lt;/span&gt;]])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; rowLine.d2[&lt;span class=&quot;string&quot;&gt;&#39;5&#39;&lt;/span&gt;] == &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        record[&lt;span class=&quot;string&quot;&gt;&#39;imsi&#39;&lt;/span&gt;] = set()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        record[&lt;span class=&quot;string&quot;&gt;&#39;imsi&#39;&lt;/span&gt;] = set([rowLine.d2[&lt;span class=&quot;string&quot;&gt;&#39;5&#39;&lt;/span&gt;]])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; record&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;imei_imsi&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(datax,datay)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; datay[&lt;span class=&quot;string&quot;&gt;&#39;imei&#39;&lt;/span&gt;]:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        datax[&lt;span class=&quot;string&quot;&gt;&#39;imei&#39;&lt;/span&gt;].add(i)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; datay[&lt;span class=&quot;string&quot;&gt;&#39;imsi&#39;&lt;/span&gt;]:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        datax[&lt;span class=&quot;string&quot;&gt;&#39;imsi&#39;&lt;/span&gt;].add(i)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; datax&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(data)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record=[]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record.append(len(data[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;][&lt;span class=&quot;string&quot;&gt;&#39;imei&#39;&lt;/span&gt;]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record.append(len(data[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;][&lt;span class=&quot;string&quot;&gt;&#39;imsi&#39;&lt;/span&gt;]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; data[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]+&lt;span class=&quot;string&quot;&gt;&quot;,&quot;&lt;/span&gt;+str(record[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;])+&lt;span class=&quot;string&quot;&gt;&quot;,&quot;&lt;/span&gt;+str(record[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; __name__==&lt;span class=&quot;string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    conf = SparkConf().setAppName(&lt;span class=&quot;string&quot;&gt;&quot;spark_sql_demo&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.network.timeout&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;3000&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.driver.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;1024&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.executor.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;1024&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.storage.memoryFraction&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;0.1&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.akka.frameSize&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;500&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc = SparkContext(conf=conf)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    hc = HiveContext(sparkContext=sc)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# sql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sqlraw = hc.sql(&lt;span class=&quot;string&quot;&gt;&#39;select * from tmp.qi_black_cuid_distinct&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# DataFrame to RDD&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rddraw = sqlraw.map(parseLine)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# RDD to KV pairs&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    kvraw = rddraw.map(&lt;span class=&quot;keyword&quot;&gt;lambda&lt;/span&gt; x: (x[&lt;span class=&quot;string&quot;&gt;&#39;cuid&#39;&lt;/span&gt;],x))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# reducebykey&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result = kvraw.reduceByKey(imei_imsi).map(number)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# save as txt&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result.saveAsTextFile(&lt;span class=&quot;string&quot;&gt;&quot;hdfs://yq01-sw-hds01.yq01.baidu.com:8020/tmp/qimingyu/qi_black_cuid_imei_imsi&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc.stop()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;程序中数据结构的定义，采用键值对的形式，但值是一个字典的数据结构{}，字典中字段的值采用的是集合的数据结构set()，这样当add集合的时候，能够求出其个数。&lt;/p&gt;
&lt;p&gt;保存在HDFS上之后，路径为：&lt;code&gt;hdfs://yq01-sw-hds01.yq01.baidu.com:8020/tmp/qimingyu/qi_black_cuid_imei_imsi&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;然后在&lt;code&gt;work@yq01-sw-hdsserver00.yq01.baidu.com&lt;/code&gt;机器上，用hive客户端创建一个表，&lt;code&gt;qi_black_cuid_imei_imsi&lt;/code&gt;,&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;hive&amp;gt; create table qi_black_cuid_imei_imsi(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;gt; cuid string,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;gt; imei int,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;gt; imsi int)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;gt; ROW FORMAT DELIMITED&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;gt; FIELDS TERMINATED BY &amp;apos;,&amp;apos;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后把之前保存在HDFS上的数据先移到本地，再put到该表的目录下：&lt;br&gt;&lt;figure class=&quot;highlight powershell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;bin/hadoop fs -put  ~/qimingyu01/qi_black_cuid_imei_imsi/part-&lt;span class=&quot;number&quot;&gt;00000&lt;/span&gt;  hdfs://yq01-sw-hds00.yq01.baidu.com:&lt;span class=&quot;number&quot;&gt;8020&lt;/span&gt;/user/hive/warehouse/tmp.db/qi_black_cuid_imei_imsi/&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;处理白样本的时候，经常报这个错误：&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471417010764.png&quot; alt=&quot;Alt text&quot;&gt;&lt;br&gt;原来正是因为在数据中有这条记录的存在：&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471416980022.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;告诉我以后处理数据的时候，一定不要相信数据本身，各种情况都有可能出现，一定要写好各种边界判断条件！&lt;/p&gt;
&lt;p&gt;最终处理后得到的结果，以cuid作为唯一标识，得到以下三个字段：cuid，该cuid对应的imei的数目，该cuid对应的imsi的数目&lt;/p&gt;
&lt;p&gt;白样本共19885889条记录，黑样本共条记录。&lt;/p&gt;
&lt;p&gt;黑白样本分布结果显示如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;项目&lt;/th&gt;
&lt;th style=&quot;text-align:right&quot;&gt;白样本&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;黑样本&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;存储表格&lt;/td&gt;
&lt;td style=&quot;text-align:right&quot;&gt;tmp.qi_white_cuid_imei_imsi&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;tmp.qi_black_cuid_imei_imsi&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;总记录数&lt;/td&gt;
&lt;td style=&quot;text-align:right&quot;&gt;19885889&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;9376&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;imei大于1的记录数&lt;/td&gt;
&lt;td style=&quot;text-align:right&quot;&gt;475215 （2.38%）&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;132 （1.4%）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;imsi大于1的记录数&lt;/td&gt;
&lt;td style=&quot;text-align:right&quot;&gt;1458187 （7.33%）&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;496  （5.29%）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;imei和imsi均大于1的记录数&lt;/td&gt;
&lt;td style=&quot;text-align:right&quot;&gt;203819（1.02%）&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;87（0.92%）&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;黑白样本分布统计图：&lt;/p&gt;
&lt;p&gt;白样本统计图：&lt;br&gt;纵坐标为imei，横坐标为cuid&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471420153078.png&quot; alt=&quot;Alt text&quot;&gt;&lt;br&gt;纵坐标为imsi，横坐标为cuid&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471420231238.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;黑样本统计图：&lt;br&gt;纵坐标为imei，横坐标为cuid&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471420371636.png&quot; alt=&quot;Alt text&quot;&gt;&lt;br&gt;纵坐标为imsi，横坐标为cuid&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471420408932.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;结论：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;对于同一个cuid设备的imsi和imsi之间的数量没有必然关系&lt;/li&gt;
&lt;li&gt;估计在白样本中有些黑设备没有检测出来（可以重点关注白样本中imei和imsi高的cuid，交给钱包组看看是否是他们的检测机制没有报黑）&lt;/li&gt;
&lt;li&gt;普遍黑样本的分布值比白样本陡峭（很好理解，我们对个别设备确实是检测出来报黑了）&lt;/li&gt;
&lt;li&gt;在该人工统计特征上，黑白样本没有明显区别&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&quot;4-6-统计安全SDK上报的“病毒云扫（logid-1001110）”的情况。&quot;&gt;&lt;a href=&quot;#4-6-统计安全SDK上报的“病毒云扫（logid-1001110）”的情况。&quot; class=&quot;headerlink&quot; title=&quot;4.6 统计安全SDK上报的“病毒云扫（logid=1001110）”的情况。&quot;&gt;&lt;/a&gt;4.6 统计安全SDK上报的“病毒云扫（logid=1001110）”的情况。&lt;/h5&gt;&lt;p&gt;黑样本&lt;code&gt;tmp.qi_black_1001110&lt;/code&gt;：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; b.guid,b.d2,b.server_time &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;DISTINCT&lt;/span&gt; cuid &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; tmp.mobile_cuid_with_date)a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;outer&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;join&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;upper&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;split&lt;/span&gt;(cuid,&lt;span class=&quot;string&quot;&gt;&#39;\\|&#39;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]) guid,d2,server_time &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; report.data_security_lab_shadow  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; log_id = &lt;span class=&quot;number&quot;&gt;1001110&lt;/span&gt;)b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; a.cuid=b.guid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; b.guid &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NULL&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;由多少个黑cuid上报的多少条病毒云扫1001110日志中，对应用包名字段做个统计，对风险等级做个统计，对病毒名做个统计&lt;/p&gt;
&lt;p&gt;等级：&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471488438520.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;病毒名：&lt;br&gt;一共有87个不同的病毒名，&lt;/p&gt;
&lt;p&gt;包名：&lt;br&gt;一共有127个不同的包名，&lt;/p&gt;
&lt;p&gt;白样本&lt;code&gt;tmp.qi_white_1001110&lt;/code&gt;：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; b.guid,b.d2,b.server_time &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;DISTINCT&lt;/span&gt; cuid &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; tmp.mobile_cuid_with_date)a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;right&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;outer&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;join&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;upper&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;split&lt;/span&gt;(cuid,&lt;span class=&quot;string&quot;&gt;&#39;\\|&#39;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]) guid,d2,server_time &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; report.data_security_lab_shadow  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; log_id = &lt;span class=&quot;number&quot;&gt;1001110&lt;/span&gt;)b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; a.cuid=b.guid&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; a.cuid &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;代码：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; SparkContext,SparkConf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark.sql &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; HiveContext,SQLContext&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; sys&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;parseLine&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(rowLine)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record=[]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record.append(rowLine.guid)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record.append(rowLine.d2[&lt;span class=&quot;string&quot;&gt;&#39;0&#39;&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record.append(rowLine.d2[&lt;span class=&quot;string&quot;&gt;&#39;1&#39;&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    record.append(rowLine.d2[&lt;span class=&quot;string&quot;&gt;&#39;2&#39;&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; str(record[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;])+&lt;span class=&quot;string&quot;&gt;&quot;,&quot;&lt;/span&gt;+str(record[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;])+&lt;span class=&quot;string&quot;&gt;&quot;,&quot;&lt;/span&gt;+str(record[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;])+&lt;span class=&quot;string&quot;&gt;&quot;,&quot;&lt;/span&gt;+str(record[&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; __name__==&lt;span class=&quot;string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    conf = SparkConf().setAppName(&lt;span class=&quot;string&quot;&gt;&quot;spark_sql_demo&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.network.timeout&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;3000&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.driver.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;1024&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.executor.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;1024&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.storage.memoryFraction&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;0.1&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.akka.frameSize&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;500&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc = SparkContext(conf=conf)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    hc = HiveContext(sparkContext=sc)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# sql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sqlraw = hc.sql(&lt;span class=&quot;string&quot;&gt;&#39;select * from tmp.qi_white_1001110&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# DataFrame to RDD&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result = sqlraw.map(parseLine)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# save as txt&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result.saveAsTextFile(&lt;span class=&quot;string&quot;&gt;&quot;hdfs://yq01-sw-hds01.yq01.baidu.com:8020/tmp/qimingyu/qi_white_1001110&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc.stop()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;白样本1367593个cuid一共上报条数：3484683，每个cuid上报条数：2.55条&lt;/p&gt;
&lt;p&gt;上报中，应用包名的分布情况，一共有131256个不同的应用包名：&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471487554476.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;风险等级的分布情况，一共有三个类别，等级分别为：2，3，4，其分布如下图所示：&lt;br&gt;&lt;img src=&quot;images/2016-8-22/1471487383165.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;其中橙色为等级2。&lt;/p&gt;
&lt;p&gt;病毒名的情况，一共有4597个不同的病毒：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;select virs_name,count(*) FROM qi_white_1001110_split group by virs_name&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;images/2016-8-22/1471487775636.png&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;h5 id=&quot;4-7-统计黑白cuid的活跃天信息，主要是CUID的月活跃天数，后期例行化统计，列出活跃度较低的cuid。&quot;&gt;&lt;a href=&quot;#4-7-统计黑白cuid的活跃天信息，主要是CUID的月活跃天数，后期例行化统计，列出活跃度较低的cuid。&quot; class=&quot;headerlink&quot; title=&quot;4.7 统计黑白cuid的活跃天信息，主要是CUID的月活跃天数，后期例行化统计，列出活跃度较低的cuid。&quot;&gt;&lt;/a&gt;4.7 统计黑白cuid的活跃天信息，主要是CUID的月活跃天数，后期例行化统计，列出活跃度较低的cuid。&lt;/h5&gt;&lt;p&gt;数据分析师与机器学习，杂乱无章的数据，陷入无穷无尽的细节之中。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/08/22/对手机安全SDK的大数据分析/&quot;&gt;http://qimingyu.github.io/2016/08/22/对手机安全SDK的大数据分析/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;1-前言&quot;&gt;&lt;a href=&quot;#1-前言&quot; class=&quot;headerlink&quot; title=&quot;1.前言&quot;&gt;&lt;/a&gt;1.前言&lt;/h4&gt;&lt;p&gt;由于很多东西没有说清楚，浪费了大量时间搞明白数据怎么来的以及各个数据的意义等，整个流程不清晰，数据怎么来的？怎么上报的？给我
    
    </summary>
    
      <category term="云安全" scheme="http://qimingyu.github.io/categories/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="威胁情报" scheme="http://qimingyu.github.io/tags/%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5/"/>
    
      <category term="大数据" scheme="http://qimingyu.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="安全SDK" scheme="http://qimingyu.github.io/tags/%E5%AE%89%E5%85%A8SDK/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB和HDFS数据库迁移至Redis</title>
    <link href="http://qimingyu.github.io/2016/08/07/MongoDB%E5%92%8CHDFS%E8%BD%AC%E5%AD%98Redis/"/>
    <id>http://qimingyu.github.io/2016/08/07/MongoDB和HDFS转存Redis/</id>
    <published>2016-08-07T09:41:53.000Z</published>
    <updated>2016-08-08T03:50:55.017Z</updated>
    
    <content type="html">&lt;h3 id=&quot;总体需求：&quot;&gt;&lt;a href=&quot;#总体需求：&quot; class=&quot;headerlink&quot; title=&quot;总体需求：&quot;&gt;&lt;/a&gt;总体需求：&lt;/h3&gt;&lt;p&gt;在企业级Saas服务中，产品对外提供的查询接口如果每秒查询率不够的话，会经不起业务增长的需求，造成响应缓慢或者直接宕机的情况。因此在业务量不多的时候一般公司的接口设计如下：&lt;br&gt;第一版接口采用的是如下图所示的方案：&lt;br&gt;&lt;img src=&quot;/images/2016_8_7/1.png&quot; alt=&quot;1&quot;&gt;&lt;br&gt;由上图所知，也就是说只对请求的query做了Cache，也就是之前有请求的数据能够在Redis中命中，快速响应，而对于未命中的query，需要查询恶意IP数据库（MongoDB），ElasticSearch，然后计算出结果Score，并返回给调用者，最后再对查询结果做Cache。&lt;br&gt;这样做的缺点是：后期需求量上来之后，公司产品所能提供的每秒查询率会不够。&lt;br&gt;现在接口需要升级第二版，需要对我们的数据做全量Cache，即需要将来源于三个不同地方的数据按统一格式全部存到Reids中，并要考虑每天的增量数据。&lt;/p&gt;
&lt;h3 id=&quot;问题难点：&quot;&gt;&lt;a href=&quot;#问题难点：&quot; class=&quot;headerlink&quot; title=&quot;问题难点：&quot;&gt;&lt;/a&gt;问题难点：&lt;/h3&gt;&lt;p&gt;目前数据主要来源于如下三个数据库：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;用MongoDB存储的&lt;code&gt;恶意IP数据库&lt;/code&gt;，其数据格式为：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123; &amp;quot;_id&amp;quot; : &amp;quot;14.145.225.34_2015-09-03_0&amp;quot;, &amp;quot;Count&amp;quot; : [ &amp;quot;Total##**##1&amp;quot; ], &amp;quot;_type&amp;quot; : 0, &amp;quot;Service&amp;quot; : [ &amp;quot;tieba##**##1&amp;quot; ], &amp;quot;RuleName&amp;quot; : [ &amp;quot;RULE_MULTIPART_DOS##**##1&amp;quot; ], &amp;quot;UA&amp;quot; : [ &amp;quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)##**##1&amp;quot; ], &amp;quot;Uri&amp;quot; : [ &amp;quot;/c/s/getClientConfig?cmd=303039##**##1&amp;quot; ], &amp;quot;_date&amp;quot; : &amp;quot;2015-09-03&amp;quot;, &amp;quot;_ip&amp;quot; : &amp;quot;14.145.225.34&amp;quot; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;用另一个MongoDB存储的&lt;code&gt;蜜罐数据&lt;/code&gt;，其格式为：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123; &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;56f101049e84a61d5ceafc19&amp;quot;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;quot;attack_history&amp;quot; :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     [ &amp;#123; &amp;quot;attack_type&amp;quot; : &amp;quot;crack_password&amp;quot;, &amp;quot;source&amp;quot; : &amp;quot;web_request_log&amp;quot;, &amp;quot;end_time&amp;quot; : &amp;quot;2016-03-04 12:42:03&amp;quot;, &amp;quot;date&amp;quot; : &amp;quot;2016-03-04&amp;quot;, &amp;quot;attack_target&amp;quot; : &amp;quot;usr.mb.hd.sohu.com&amp;quot;, &amp;quot;start_time&amp;quot; : &amp;quot;2016-03-04 03:53:47&amp;quot;, &amp;quot;attack_count&amp;quot; : 92734, &amp;quot;description&amp;quot; : &amp;quot;&amp;quot; &amp;#125; ],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;quot;indicator&amp;quot; : &amp;quot;111.192.46.41&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;quot;status&amp;quot; : &amp;quot;MALICIOUS&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;quot;sub_status&amp;quot; : [ &amp;quot;crack_password&amp;quot; ],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;quot;type&amp;quot; : &amp;quot;IP&amp;quot; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;用HDFS存储的&lt;code&gt;DNS数据&lt;/code&gt;，其格式为：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;domain&amp;quot;: &amp;quot;90gj65.oqnlo196.cn&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;update&amp;quot;: &amp;quot;2016-01-03 03:08:47&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;create&amp;quot;: &amp;quot;2015-12-15 08:43:08&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;evil_type&amp;quot;: [&amp;quot;3&amp;quot;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;history&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;quot;ip&amp;quot;: [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;quot;98.126.8.11&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;quot;source&amp;quot;: &amp;quot;public&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;quot;date&amp;quot;: &amp;quot;2015-12-14&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;该问题的难点在于：这三个数据库中存储的数据格式均不相同，且相互之间有一定交叉。需要把这些数据处理合并计算之后成为一个数据，按照同样的格式存进Redis数据库里面，并且需要考虑以后的每日增量数据更新的问题。&lt;/p&gt;
&lt;h3 id=&quot;问题解决方案：&quot;&gt;&lt;a href=&quot;#问题解决方案：&quot; class=&quot;headerlink&quot; title=&quot;问题解决方案：&quot;&gt;&lt;/a&gt;问题解决方案：&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;关于存进Redis数据库中的格式：&lt;br&gt;我们最终需要的是，当别人输入查询某个IP的时候，我们能给出其IP的四个维度的信息：&lt;br&gt; (1). 该IP在恶意IP库中最近出现的时间；&lt;br&gt; (2). DNS域名服务器中最近出现的时间；&lt;br&gt; (3). 该IP所绑定的域名数量；&lt;br&gt; (4). 域名数量中恶意域名的数量；&lt;/p&gt;
&lt;p&gt; 这四个维度分别对应存储进Redis中Value的四个值。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;因此Redis的哈希存储（HSET）符合我们的业务需求，而根据数据存储方式，初步有如下两套方案：&lt;/p&gt;
&lt;p&gt; 方案一：&lt;br&gt;&lt;img src=&quot;/images/2016_8_7/2.png&quot; alt=&quot;2&quot;&gt;&lt;br&gt; 方案二：&lt;br&gt;&lt;img src=&quot;/images/2016_8_7/3.png&quot; alt=&quot;3&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;方案一&lt;/strong&gt;在最终的查询效率上面要高，对C段查询请求的支持较好，但存数据的时候Value信息不好存。&lt;br&gt;&lt;strong&gt;方案二&lt;/strong&gt;非常容易存数据，但对C段查询支持不太好。&lt;/p&gt;
&lt;p&gt;考虑到最终的查询效率，最终决定采用&lt;strong&gt;方案一&lt;/strong&gt;。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;最终给出如下的大致解决方案：&lt;br&gt;一个IP地址对应的所填Value的4个值：&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;恶意IP库中最近出现的时间&lt;/code&gt;：只与mongoDB有关&lt;br&gt;python程序连接好两个mongo数据库，在数据库中例如查询，只需注意“indicator”字段，表示IP，然后attack_history字段里面的end_time，注意进行内部比较。入Redis库。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;DNS中最近时间&lt;/code&gt;：只与DNS有关&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;域名数量&lt;/code&gt;：只与DNS有关&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;恶意域名数量&lt;/code&gt;：只与DNS有关&lt;/p&gt;
&lt;p&gt; 针对后三个值，打算用Redis-Spark直接进行读写。再合并第一个字段，最终进行插入。 &lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;实际解决过程：&quot;&gt;&lt;a href=&quot;#实际解决过程：&quot; class=&quot;headerlink&quot; title=&quot;实际解决过程：&quot;&gt;&lt;/a&gt;实际解决过程：&lt;/h3&gt;&lt;h4 id=&quot;1-处理DNS数据&quot;&gt;&lt;a href=&quot;#1-处理DNS数据&quot; class=&quot;headerlink&quot; title=&quot;1.处理DNS数据&quot;&gt;&lt;/a&gt;1.处理DNS数据&lt;/h4&gt;&lt;p&gt;针对&lt;code&gt;DNS&lt;/code&gt;数据，由于其在HDFS上有一个备份，因此直接用我们的Spark集群处理。具体处理代码&lt;br&gt;&lt;code&gt;ipdomain_spark.py&lt;/code&gt;如下，这是Spark上所提交的应用代码：&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; random&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; sys&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; time,datetime&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;reload(sys)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sys.setdefaultencoding(&lt;span class=&quot;string&quot;&gt;&#39;utf-8&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; SparkContext,SparkConf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hdfsdir=&lt;span class=&quot;string&quot;&gt;&quot;your_address_hdfsdir&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;resultdir = &lt;span class=&quot;string&quot;&gt;&quot;your_address_redultdir&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#/*************************Public Dns Functions*************************/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getIPs&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(data)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;evil_type&quot;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; data:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        evil_type = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        evil_type = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ipdict = &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; item &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; data[&lt;span class=&quot;string&quot;&gt;&quot;history&quot;&lt;/span&gt;]:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        day = item[&lt;span class=&quot;string&quot;&gt;&quot;date&quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; ip &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; item[&lt;span class=&quot;string&quot;&gt;&quot;ip&quot;&lt;/span&gt;]:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ip &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; ipdict:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; day&amp;gt;ipdict[ip]:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    ipdict[ip] = day&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                ipdict[ip] = day&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    iplist = []&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; ip,xdate &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; ipdict.items():&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        iplist.append((ip,[xdate,&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,evil_type]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; iplist&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;mergeByIp&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(x,y)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; x[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]&amp;lt;y[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        x[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] = y[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;#for date&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    x[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] += y[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;#for domain nums&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    x[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;] += y[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;#for evil domain nums&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; x&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;toStr&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(data)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    data[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;].insert(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;0000-00-00&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;%s\t%s&quot;&lt;/span&gt;%(data[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;],json.dumps(data[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    curtime=sys.argv[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    conf = SparkConf().setAppName(&lt;span class=&quot;string&quot;&gt;&quot;selectActiveIps&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.network.timeout&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;3000&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.executor.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;3072&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.driver.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;3072&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.akka.frameSize&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;500&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc = SparkContext(conf=conf)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    wholeData=sc.pickleFile(hdfsdir+curtime+&lt;span class=&quot;string&quot;&gt;&quot;/elasticwhole&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .flatMap(getIPs)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .reduceByKey(mergeByIp,&lt;span class=&quot;number&quot;&gt;2000&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .map(toStr)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .coalesce(&lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    wholeData.saveAsTextFile(resultdir+curtime)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc.stop()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这是Spark提交任务的脚本&lt;code&gt;ipdomain.sh&lt;/code&gt;：&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#/**************************normal settings***********************/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hdfsdir=&#39;your_hdfsdir_address&#39;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sparkdir=&#39;/home/work/spark/spark-1.6.1-bin-hadoop2.6/bin/&#39;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yarndir=&#39;/home/work/hadoop/hadoop/hadoop-2.6.0/bin/&#39;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#################################################################################&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;export YARN_CONF_DIR=/home/work/hadoop/hadoop/hadoop-2.6.0/etc/hadoop&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$&amp;#123;sparkdir&amp;#125;/spark-submit --master yarn \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --deploy-mode cluster \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --queue default \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --num-executors 100 \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --executor-cores 4 \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --driver-cores 4 \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --executor-memory 15g \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --driver-memory 20g \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         ipdomain_spark.py  $1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if [ $? -eq 0 ];then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    unset YARN_CONF_DIR&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    exit 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fi&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这样处理之后使原来的DNS数据变为如下格式：&lt;br&gt;&lt;img src=&quot;/images/2016_8_7/4.png&quot; alt=&quot;4&quot;&gt;&lt;/p&gt;
&lt;p&gt;其中“0000-00-00”就是等待另外两个数据库处理之后把该日期插进去。&lt;/p&gt;
&lt;h4 id=&quot;2-处理恶意IP数据&quot;&gt;&lt;a href=&quot;#2-处理恶意IP数据&quot; class=&quot;headerlink&quot; title=&quot;2.处理恶意IP数据&quot;&gt;&lt;/a&gt;2.处理恶意IP数据&lt;/h4&gt;&lt;p&gt;针对&lt;code&gt;MongoDB&lt;/code&gt;中的&lt;code&gt;恶意IP数据&lt;/code&gt;，按如直接查询处理，直接按脚本&lt;code&gt;emongo2redis.py&lt;/code&gt;运行，代码如下：&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; pymongo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; os&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;client_evilips = pymongo.MongoClient(&lt;span class=&quot;string&quot;&gt;&#39;your_mongodb_address&#39;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;30000&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;db_evilips = client_evilips.ticdb&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;collection_evilips = db_evilips.evilips&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;data2=collection_evilips.find(&amp;#123;&amp;#125;,&amp;#123;&lt;span class=&quot;string&quot;&gt;&#39;indicator&#39;&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;attack_history.date&#39;&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;file = open(&lt;span class=&quot;string&quot;&gt;&quot;evilips.txt&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;r+w&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; data2:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; i.has_key(&lt;span class=&quot;string&quot;&gt;&#39;attack_history&#39;&lt;/span&gt;):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        listA=i[&lt;span class=&quot;string&quot;&gt;&#39;attack_history&#39;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        record = &amp;#123;&lt;span class=&quot;string&quot;&gt;&#39;date&#39;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&#39;0&#39;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;ip&#39;&lt;/span&gt;:&lt;span class=&quot;string&quot;&gt;&#39;0&#39;&lt;/span&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        record[&lt;span class=&quot;string&quot;&gt;&#39;ip&#39;&lt;/span&gt;]=i[&lt;span class=&quot;string&quot;&gt;&#39;indicator&#39;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; item &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; listA:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; item[&lt;span class=&quot;string&quot;&gt;&#39;date&#39;&lt;/span&gt;] &amp;gt;= record[&lt;span class=&quot;string&quot;&gt;&#39;date&#39;&lt;/span&gt;]:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                record[&lt;span class=&quot;string&quot;&gt;&#39;date&#39;&lt;/span&gt;]=item[&lt;span class=&quot;string&quot;&gt;&#39;date&#39;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        s = str(record[&lt;span class=&quot;string&quot;&gt;&#39;ip&#39;&lt;/span&gt;]+&lt;span class=&quot;string&quot;&gt;&quot;,&quot;&lt;/span&gt;+record[&lt;span class=&quot;string&quot;&gt;&#39;date&#39;&lt;/span&gt;]+os.linesep)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        file.write(s)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;file.close()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这里得到一个&lt;code&gt;evilips.txt&lt;/code&gt;文件，里面数据个数如下：&lt;br&gt;&lt;img src=&quot;/images/2016_8_7/5.png&quot; alt=&quot;5&quot;&gt;&lt;br&gt;IP和日期用逗号隔开。&lt;/p&gt;
&lt;h4 id=&quot;3-处理蜜罐数据&quot;&gt;&lt;a href=&quot;#3-处理蜜罐数据&quot; class=&quot;headerlink&quot; title=&quot;3.处理蜜罐数据&quot;&gt;&lt;/a&gt;3.处理蜜罐数据&lt;/h4&gt;&lt;p&gt;针对&lt;code&gt;MongoDB&lt;/code&gt;中的&lt;code&gt;蜜罐数据&lt;/code&gt;，直接查询之后，还需要进行日期的比较，直接按脚本&lt;code&gt;mongo2reids.py&lt;/code&gt;运行，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; pymongo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; os&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;client_urltable = pymongo.MongoClient(&lt;span class=&quot;string&quot;&gt;&#39;your_mongodb_address&#39;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;27017&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;db_urltable = client_urltable.urldb&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;collection_urltable = db_urltable.urltable&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;data_urltable = collection_urltable.find(&amp;#123;&amp;#125;,&amp;#123;&lt;span class=&quot;string&quot;&gt;&#39;_ip&#39;&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;_date&#39;&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;_id&#39;&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;file = open(&lt;span class=&quot;string&quot;&gt;&quot;urltable.txt&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;r+w&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;counter,s=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; ii &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; data_urltable:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    counter+=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    s += str(ii[&lt;span class=&quot;string&quot;&gt;&#39;_ip&#39;&lt;/span&gt;]+&lt;span class=&quot;string&quot;&gt;&quot;,&quot;&lt;/span&gt;+ii[&lt;span class=&quot;string&quot;&gt;&#39;_date&#39;&lt;/span&gt;]+os.linesep)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; counter &amp;gt;= &lt;span class=&quot;number&quot;&gt;100000&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        file.write(s)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        counter,s=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; counter:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    file.write(s)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;file.close()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这里得到一个&lt;code&gt;urltable.txt&lt;/code&gt;,数据格式如下：&lt;br&gt;&lt;img src=&quot;/images/2016_8_7/6.png&quot; alt=&quot;6&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;4-数据合并&quot;&gt;&lt;a href=&quot;#4-数据合并&quot; class=&quot;headerlink&quot; title=&quot;4.数据合并&quot;&gt;&lt;/a&gt;4.数据合并&lt;/h4&gt;&lt;p&gt;将&lt;code&gt;urltable.txt&lt;/code&gt;和&lt;code&gt;evilips.txt&lt;/code&gt;中的数据进行合并，推送到Spark的HDFS中，其保存路径为：&lt;code&gt;/dailywork/ipdomain/ipmongo2.txt&lt;/code&gt;,而此时Spark中还有我们第一步处理的数据，保存路径为：&lt;code&gt;/dailywork/ipdomain/2016-08-01&lt;/code&gt;,将这两个数据进行合并，合并方式为：以DNS数据为准，IP为唯一主键，当ipmongo2.txt中有DNS中的IP时，将后面的日期插入DNS的第一个Value中。因此用Spark中的&lt;code&gt;leftOuterJoin&lt;/code&gt;函数。而此时遇到的第一个问题是，按照道理，jion之后的数据条目不应该比DNS的数据条目还要多，当时出现的问题是：DNS中有&lt;code&gt;21948374&lt;/code&gt;条记录，ipmongo2.txt中有&lt;code&gt;5855408&lt;/code&gt;条记录，jion之后有&lt;code&gt;22505689&lt;/code&gt;条数据，也就是说，jion之后的数据条目增多了，这是不正常的。后面反复排查错误，直到发现ipmongo2.txt中有键值相同的数据，于是将键值相同的数据进行去重，去重的同时，依然要比较他们后面日期值的大小，保留最近的日期进行保存。去重之后的恶意IP数据有&lt;code&gt;2714252&lt;/code&gt;条记录，此时再Jion，就正常了。最后给出&lt;code&gt;ipdomain_spark_jion.py&lt;/code&gt;代码如下：&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; sys&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; SparkContext,SparkConf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hdfsdir=&lt;span class=&quot;string&quot;&gt;&quot;your_hdfsdir_address&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#/*************************Public Dns Functions*************************/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(data)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    list=json.loads(data[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; data[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;] == &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; data[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]+&lt;span class=&quot;string&quot;&gt;&quot;\t&quot;&lt;/span&gt;+json.dumps(list)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        list[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]=data[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;][&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; data[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]+&lt;span class=&quot;string&quot;&gt;&quot;\t&quot;&lt;/span&gt;+json.dumps(list)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    conf = SparkConf().setAppName(&lt;span class=&quot;string&quot;&gt;&quot;selectActiveIps&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.network.timeout&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;3000&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.executor.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;3072&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.driver.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;3072&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.akka.frameSize&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;500&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc = SparkContext(conf=conf)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;##2 mongoDB data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ipData=sc.textFile(hdfsdir+&lt;span class=&quot;string&quot;&gt;&quot;/dailywork/ipdomain/ipmongo2.txt&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;## Key Value pairs&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    smalldata=ipData.map(&lt;span class=&quot;keyword&quot;&gt;lambda&lt;/span&gt; x: (x.split(&lt;span class=&quot;string&quot;&gt;&quot;,&quot;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;],x.split(&lt;span class=&quot;string&quot;&gt;&quot;,&quot;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;## Duplicate removal&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    reduce_smalldata=smalldata.reduceByKey( &lt;span class=&quot;keyword&quot;&gt;lambda&lt;/span&gt; x,y : x &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; x&amp;gt;=y &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; y )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;## DNS data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    wholeData=sc.textFile(hdfsdir+&lt;span class=&quot;string&quot;&gt;&quot;/dailywork/ipdomain/2016-08-01&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;## Key Value pairs&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    bigdata = wholeData.map(&lt;span class=&quot;keyword&quot;&gt;lambda&lt;/span&gt; x: (x.split(&lt;span class=&quot;string&quot;&gt;&quot;\t&quot;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;],x.split(&lt;span class=&quot;string&quot;&gt;&quot;\t&quot;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;## join&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    lastData=bigdata.leftOuterJoin(reduce_smalldata)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;## replace and sort&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result=lastData.sortByKey().map(replace)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;## Save data&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    result.saveAsTextFile(hdfsdir+&lt;span class=&quot;string&quot;&gt;&quot;/test/temp1&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc.stop()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;提交脚本代码与第一步一样。&lt;br&gt;此时得到的数据格式为：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;113.66.157.30,[&amp;quot;2016-01-03&amp;quot;, &amp;quot;2016-03-02&amp;quot;, 1, 0] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;180.97.69.40,[&amp;quot;2016-07-31&amp;quot;, &amp;quot;2015-11-23&amp;quot;, 1, 0] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104.238.140.70,[&amp;quot;2016-07-06&amp;quot;, &amp;quot;2016-06-12&amp;quot;, 1, 0]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137.175.47.157,[&amp;quot;0000-00-00&amp;quot;, &amp;quot;2016-08-01&amp;quot;, 2230, 82]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;可以看到有些IP的恶意域名数量为0，但是在恶意IP数据库里面出现过，而有些IP的恶意域名数量不为0，但是没有出现在恶意IP数据库里面，此时统计了一下，有9675条IP记录，既出现在了恶意域名数据库中，又出现在了DNS域名记录中。这里的几个数据很值得研究。&lt;/p&gt;
&lt;h4 id=&quot;5-存到Redis集群中&quot;&gt;&lt;a href=&quot;#5-存到Redis集群中&quot; class=&quot;headerlink&quot; title=&quot;5.存到Redis集群中&quot;&gt;&lt;/a&gt;5.存到Redis集群中&lt;/h4&gt;&lt;p&gt;将得到的数据存到Redis集群中。&lt;br&gt;Redis集群有几种存法，一个是官网给出的用这样的命令存：&lt;br&gt;&lt;figure class=&quot;highlight powershell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cat data.txt | redis-cli&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;而data.txt中的数据格式为：&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;hset Key field value&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hset Key filed value&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;……&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;就是一行一行从文本读命令，然后用客户端命令执行。&lt;br&gt;还有一个是基于Redis本身的事务机制，批量读取数据，然后做少量次数的存储。&lt;br&gt;最终，我是在Spark平台上直接import redis包处理的。这里遇到的第一个问题是，刚开始一直报莫名其妙的错误，后来发现Python的第三方redis包并不能处理集群的情况，只能处理单机版的情况，后来又换成了&lt;a href=&quot;https://pypi.python.org/pypi/redis-py-cluster/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;redis-py-cluster 1.2.0&lt;/a&gt;包，而该包也是依赖redis包的，因此提交运行的时候，两个包都要打包提交上去。第二个问题是，Spark平台报执行内存不足的错误，后来在提交的时候，需要在应用中指定大一点的内存，将&lt;code&gt;spark.driver.maxResultSize&lt;/code&gt;调为&lt;code&gt;2g&lt;/code&gt;，最后应用代码&lt;code&gt;spark2redis.py&lt;/code&gt;为：&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; json&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; sys&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; rediscluster &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; StrictRedisCluster&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; pyspark &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; SparkContext,SparkConf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hdfsdir=&lt;span class=&quot;string&quot;&gt;&quot;your_hdfsdir_address&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#/*************************Public Dns Functions*************************/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    conf = SparkConf().setAppName(&lt;span class=&quot;string&quot;&gt;&quot;selectActiveIps&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.network.timeout&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;3000&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.executor.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;3072&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.yarn.driver.memoryOverhead&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;3072&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.akka.frameSize&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;500&quot;&lt;/span&gt;)\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    .set(&lt;span class=&quot;string&quot;&gt;&quot;spark.driver.maxResultSize&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;2g&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc = SparkContext(conf=conf)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;## connect to redis&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    startup_nodes = [&amp;#123;&lt;span class=&quot;string&quot;&gt;&quot;host&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;your_host_address&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;port&quot;&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&quot;6777&quot;&lt;/span&gt;&amp;#125;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rc = StrictRedisCluster(startup_nodes=startup_nodes)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;## rawdata&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rawdata = sc.textFile(hdfsdir+&lt;span class=&quot;string&quot;&gt;&quot;/test/temp1&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;## Key Value pairs&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rawkv = rawdata.map(&lt;span class=&quot;keyword&quot;&gt;lambda&lt;/span&gt; x: (x.split(&lt;span class=&quot;string&quot;&gt;&quot;\t&quot;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;],x.split(&lt;span class=&quot;string&quot;&gt;&quot;\t&quot;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;## initialization &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;## pipeline_redis = r.pipeline()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;## count = 0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;## batch_size =  10000&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;## hset to redis&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; onerecord &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; rawkv.collect():&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; onerecord[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].count(&lt;span class=&quot;string&quot;&gt;&#39;.&#39;&lt;/span&gt;) == &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ipc=onerecord[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].split(&lt;span class=&quot;string&quot;&gt;&quot;.&quot;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]+&lt;span class=&quot;string&quot;&gt;&quot;.&quot;&lt;/span&gt;+onerecord[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].split(&lt;span class=&quot;string&quot;&gt;&quot;.&quot;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]+&lt;span class=&quot;string&quot;&gt;&quot;.&quot;&lt;/span&gt;+onerecord[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;].split(&lt;span class=&quot;string&quot;&gt;&quot;.&quot;&lt;/span&gt;)[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            rc.hset(ipc, onerecord[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;], onerecord[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;##       count += 1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;##       if not count % batch_size:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;##           pipeline_redis.execute()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;#send the last batch&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;comment&quot;&gt;##       pipeline_redis.execute()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sc.stop()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;提交脚本为&lt;code&gt;ipdomain.sh&lt;/code&gt;:&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#/**************************normal settings***********************/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hdfsdir=&lt;span class=&quot;string&quot;&gt;&#39;your_hdfsdir_address&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sparkdir=&lt;span class=&quot;string&quot;&gt;&#39;/home/work/spark/spark-1.6.1-bin-hadoop2.6/bin/&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yarndir=&lt;span class=&quot;string&quot;&gt;&#39;/home/work/hadoop/hadoop/hadoop-2.6.0/bin/&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;export YARN_CONF_DIR=/home/work/hadoop/hadoop/hadoop&lt;span class=&quot;number&quot;&gt;-2.6&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;/etc/hadoop&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$&amp;#123;sparkdir&amp;#125;/spark-submit --master yarn \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --deploy-mode cluster \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --queue default \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --num-executors &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --executor-cores &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --driver-cores &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt; \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --executor-memory &lt;span class=&quot;number&quot;&gt;15&lt;/span&gt;g \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --driver-memory &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt;g \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         --py-files /home/work/qimingyu01/redis-py-cluster&lt;span class=&quot;number&quot;&gt;-1.2&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;/rediscluster.zip,/home/work/qimingyu01/redis&lt;span class=&quot;number&quot;&gt;-2.10&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.5&lt;/span&gt;/redis.zip \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                         spark2redis.py&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;6-查询性能测试&quot;&gt;&lt;a href=&quot;#6-查询性能测试&quot; class=&quot;headerlink&quot; title=&quot;6.查询性能测试&quot;&gt;&lt;/a&gt;6.查询性能测试&lt;/h4&gt;&lt;p&gt;将数据全部存入Redis集群后，查询结果如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;单个记录查询测试结果：&lt;br&gt;&lt;img src=&quot;/images/2016_8_7/7.png&quot; alt=&quot;7&quot;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;全部记录查询测试结果，返回所有的Key值：&lt;br&gt;&lt;img src=&quot;/images/2016_8_7/8.png&quot; alt=&quot;8&quot;&gt;&lt;br&gt;可见不到响应时长不超过4秒，相当的快。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/08/07/MongoDB和HDFS转存Redis/&quot;&gt;http://qimingyu.github.io/2016/08/07/MongoDB和HDFS转存Redis/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;总体需求：&quot;&gt;&lt;a href=&quot;#总体需求：&quot; class=&quot;headerlink&quot; title=&quot;总体需求：&quot;&gt;&lt;/a&gt;总体需求：&lt;/h3&gt;&lt;p&gt;在企业级Saas服务中，产品对外提供的查询接口如果每秒查询率不够的话，会经不起业务增长的需求，造成响应缓慢或者直接宕
    
    </summary>
    
      <category term="云安全" scheme="http://qimingyu.github.io/categories/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="MongoDB" scheme="http://qimingyu.github.io/tags/MongoDB/"/>
    
      <category term="HDFS" scheme="http://qimingyu.github.io/tags/HDFS/"/>
    
      <category term="Redis" scheme="http://qimingyu.github.io/tags/Redis/"/>
    
      <category term="Spark" scheme="http://qimingyu.github.io/tags/Spark/"/>
    
      <category term="威胁情报" scheme="http://qimingyu.github.io/tags/%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5/"/>
    
  </entry>
  
  <entry>
    <title>如何算商人的账——百度summer Party有感</title>
    <link href="http://qimingyu.github.io/2016/08/07/Summer_Party%E6%9C%89%E6%84%9F/"/>
    <id>http://qimingyu.github.io/2016/08/07/Summer_Party有感/</id>
    <published>2016-08-07T09:29:43.000Z</published>
    <updated>2016-08-07T09:33:28.460Z</updated>
    
    <content type="html">&lt;p&gt;今天百度举行了一年一度的Summer Party，请了一些明星，当然现场有各种小礼品，这一场下来，应该也得花些钱。而我思考的是，站在企业的角度上，是否应该花这笔钱，这笔钱是否值得花，这就是商人的账，应该怎么去算？&lt;/p&gt;
&lt;p&gt;表面上，这是一种浪费，而实际上这是一种企业宣传和文化鼓舞。小公司在钱上斤斤计较，这样的公司必定做不大。因此对公司而言，谈节约，去计较每一笔开销并不一定是好事。有些钱，就得花，并且还要大方的花，毫不计较的花。不仅要花，还要花的有价值，商人的账就是应该这样算，不能用普通人的思维去考虑。关键时刻还要有肚量，考虑什么是最关键的，在战略上什么是最重要的，是什么东西值得你为之花这么多钱的。因此，商人看世界，或者说老板看世界，与普通眼中的世界是不一样的，他能一眼看出价值，你值多少钱或者这件事值多少钱。&lt;/p&gt;
&lt;p&gt;其二，久闻海底捞火锅服务态度好，服务周到，一直想去见识一番，也想通过体验去思考其商业模式，其通过提高品质的服务来打开差异化的市场。因此，所谓的价格高低，只是公司的策略及品牌不一样。关于这一点，一定要定位准确。今天由于用餐人数多，我们去的时候已经没有位置了，出乎意料的是，工作人员居然免费送了我们每人一个价值大概10元左右的零食小礼包。因为我是慕名而去的，但这一小小的举动，让我深深的认定了“海底捞”这一品牌，它在我心里的价值骤然飙升，或许就这一件事情，让我今后都愿意为此付出更高的价格，愿意为此买单。是的，它这一举动，无形中提高了其品牌在消费者心中的价值，于企业而言，虽然短期内花出去了钱，但它确实是赚到了，这笔买卖，并不亏。这就是商人的账。&lt;/p&gt;
&lt;p&gt;那么，这样的思维，对于我平时做事，给我一些启发。&lt;br&gt;第一，一定要有忧患意识。要随时做好接受市场挑战的准备，要把自己的价值放在市场上去衡量，时刻明白自己的真实斤两。有了这个前提，平时做事，就一定要以提高自己的社会价值为唯一标准。这个社会价值与其自身能力是画等号的，并不与任何外界物质相关，即创造和打造好自己在社会上别人无法替代的“身份标识”。这个基于个人的“身份标识”真是太重要了，我觉得这是一个人年轻的时候，所唯一应该追求的东西。很多时候，只需做好了这个，后面的厚积薄发往往是水到渠成的事情。而这个“身份标识”关乎很多事情，它代表你平时的每一个行为，每一场报告，每一封邮件，每一篇周报，每一个由你完成的任务等等在别人心中所留下的整体印象和水平。马克思说“人的本质是一切社会关系的总和”。只有真正理解好了这句话，就会意识到唯一的价值来源在于人本身。所谓“天时地利人和”，表面上是三个原因，而“势”由人所造，在我看来，任何一件事情能否做成，归根到底都是“人”的原因。&lt;br&gt;第二，一定要有创业意识。要执着并坚信互联网的未来，要执着并坚信技术改变世界，未来几十年，一定要坚信这两点。因为现在时代发展变化太快了，选择也太多了，道路也更多了，稍有不慎，就会选择错误，误入歧途。因此，在看得见的未来，对于自身所面临的一切选择，一定要基于这两个信念作为评判标准，这样才不至于在社会的大潮中迷失方向。虽然现在在当员工，现在也很年轻，但一定要思考，“十年之后，我还能拿什么去与未来的年轻人去竞争？”，一定要时刻让自己去思考这个问题。将创业当做自己人生的最终目标，因此年轻时的一切准备，都要服从该目标。&lt;br&gt;第三，一定要有精英意识。今年百度Summer Party的口号是“爱百度，Du Better”，我们会做得更好。应该时刻要求自己去精益求精的做事，一丝不苟的做事，踏踏实实的做事，当然在做事的同时，不要停止对这个社会，这个时代，以及自身圈子及出路的思考。与高质量的思维模式相伴随，让精英意识贯穿于自己的每一个细胞中去。一定不要经常去羡慕别人，或者以认识某某人为荣，想通过他人或者平台来提高自己，这是错误的。应该思考，自己能做什么，自己能为公司，为团队带来什么。不要依附于他人的品牌，要去打造自己的品牌。&lt;/p&gt;
&lt;p&gt;最后，始终提醒自己，勿忘初心，我会一直在路上，在安全领域有所作为。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/08/07/Summer_Party有感/&quot;&gt;http://qimingyu.github.io/2016/08/07/Summer_Party有感/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;今天百度举行了一年一度的Summer Party，请了一些明星，当然现场有各种小礼品，这一场下来，应该也得花些钱。而我思考的是，站在企业的角度上，是否应该花这笔钱，这笔钱是否值得花，这就是商人的账，应该怎么去算？&lt;/p&gt;
&lt;p&gt;表面上，这是一种浪费，而实际上这是一种企业宣传
    
    </summary>
    
      <category term="安全感悟" scheme="http://qimingyu.github.io/categories/%E5%AE%89%E5%85%A8%E6%84%9F%E6%82%9F/"/>
    
    
      <category term="百度" scheme="http://qimingyu.github.io/tags/%E7%99%BE%E5%BA%A6/"/>
    
      <category term="企业经营" scheme="http://qimingyu.github.io/tags/%E4%BC%81%E4%B8%9A%E7%BB%8F%E8%90%A5/"/>
    
  </entry>
  
  <entry>
    <title>基于WIFI的手机室内定位项目简介</title>
    <link href="http://qimingyu.github.io/2016/07/31/%E5%9F%BA%E4%BA%8EWIFI%E7%9A%84%E6%89%8B%E6%9C%BA%E5%AE%A4%E5%86%85%E5%AE%9A%E4%BD%8D%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B/"/>
    <id>http://qimingyu.github.io/2016/07/31/基于WIFI的手机室内定位项目简介/</id>
    <published>2016-07-31T07:13:34.000Z</published>
    <updated>2016-07-31T07:48:13.129Z</updated>
    
    <content type="html">&lt;p&gt;这是去年（2015年）暑假我们团队参加“华为杯”全国大学生智能设计竞赛获得&lt;a href=&quot;http://sse.ustc.edu.cn/pages/xxll.php?newsid=1198&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;全国一等奖&lt;/a&gt;的参赛项目的介绍。该项目由于是团队劳动成果，因此具体代码和详细设计文档这里暂不给出，如有需要可联系本人索取。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2016-07-31/0001.jpg&quot; alt=&quot;1&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/2016-07-31/0002.jpg&quot; alt=&quot;2&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/2016-07-31/0003.jpg&quot; alt=&quot;3&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/2016-07-31/0004.jpg&quot; alt=&quot;4&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/2016-07-31/0005.jpg&quot; alt=&quot;5&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/2016-07-31/0006.jpg&quot; alt=&quot;6&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/2016-07-31/0007.jpg&quot; alt=&quot;7&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/2016-07-31/0008.jpg&quot; alt=&quot;8&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/2016-07-31/0009.jpg&quot; alt=&quot;9&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/2016-07-31/0010.jpg&quot; alt=&quot;10&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/2016-07-31/0011.jpg&quot; alt=&quot;11&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/2016-07-31/0012.jpg&quot; alt=&quot;12&quot;&gt;  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/07/31/基于WIFI的手机室内定位项目简介/&quot;&gt;http://qimingyu.github.io/2016/07/31/基于WIFI的手机室内定位项目简介/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;这是去年（2015年）暑假我们团队参加“华为杯”全国大学生智能设计竞赛获得&lt;a href=&quot;http://sse.ustc.edu.cn/pages/xxll.php?newsid=1198&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;全国一等奖&lt;/a&gt;
    
    </summary>
    
      <category term="笔试面经" scheme="http://qimingyu.github.io/categories/%E7%AC%94%E8%AF%95%E9%9D%A2%E7%BB%8F/"/>
    
    
      <category term="华为杯" scheme="http://qimingyu.github.io/tags/%E5%8D%8E%E4%B8%BA%E6%9D%AF/"/>
    
      <category term="室内定位" scheme="http://qimingyu.github.io/tags/%E5%AE%A4%E5%86%85%E5%AE%9A%E4%BD%8D/"/>
    
  </entry>
  
  <entry>
    <title>解决Hadoop和Spark本地版本库不统一的问题</title>
    <link href="http://qimingyu.github.io/2016/07/23/%E8%A7%A3%E5%86%B3Hadoop%E5%92%8CSpark%E6%9C%AC%E5%9C%B0%E7%89%88%E6%9C%AC%E5%BA%93%E4%B8%8D%E7%BB%9F%E4%B8%80%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>http://qimingyu.github.io/2016/07/23/解决Hadoop和Spark本地版本库不统一的问题/</id>
    <published>2016-07-23T12:40:34.000Z</published>
    <updated>2016-07-23T12:42:38.795Z</updated>
    
    <content type="html">&lt;p&gt;就是报以下这个警告的，也不知道对运行程序究竟会产生什么样的影响，但看着就是不爽，还耽误了我几天时间，把它给解决了，这里记一下，方便以后查找。&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;unable to load native-hadoop library &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; your platform... using &lt;span class=&quot;built_in&quot;&gt;builtin&lt;/span&gt;-java classes &lt;span class=&quot;built_in&quot;&gt;where&lt;/span&gt; applicable&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;先是运行Hadoop的时候报该错误，当时发现是由于Hadoop所需要的版本库和系统本地的glibc的版本库不一致导致的，但是有一个问题是系统本地库的地址是在根目录的lib和lib64下面，由于对服务器没有root权限，是无法修改该库的版本的，因此到这里，网上说的大部分解决方案都不行了。&lt;/p&gt;
&lt;p&gt;既然不能修改本地库，那就考虑修改环境变量中的PATH，PATH路径要保证读的库地址要在本地库地址路径的前面，因为PATH只要找到结果就会返回，那么我们就把路径/home/work/lacol/加进去并放在前面。&lt;/p&gt;
&lt;p&gt;我们需要自己编译一个合适的版本库，例如编译到/home/work/local/glibc目录中，然后把该目录同步到其他相同的服务器，然后用软链接，注意在集群上批量执行该命令：&lt;br&gt;&lt;figure class=&quot;highlight powershell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ln -s /home/work/local/glibc/libc.so /home/work/local/lib64/libc.so.&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;以上就解决了Hadoop的版本库的问题，可是打开Spark，发现Spark还报版本库的错误，网上给的&lt;a href=&quot;http://stackoverflow.com/questions/30369380/hadoop-unable-to-load-native-hadoop-library-for-your-platform-error-on-docker&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;该解决方案&lt;/a&gt;并不能解决该问题，后来在spark-env.sh中增加了&lt;code&gt;lib64&lt;/code&gt;的地址，最终边为如下：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;export LD_LIBRARY_PATH=$SPARK_SUBMIT_LIBRARY_PATH:$HADOOP_HOME/lib/native:/home/work/local/lib/:/home/work/local/lib64/&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;再SCP到所有集群上面，遂解决。  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/07/23/解决Hadoop和Spark本地版本库不统一的问题/&quot;&gt;http://qimingyu.github.io/2016/07/23/解决Hadoop和Spark本地版本库不统一的问题/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;就是报以下这个警告的，也不知道对运行程序究竟会产生什么样的影响，但看着就是不爽，还耽误了我几天时间，把它给解决了，这里记一下，方便以后查找。&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;p
    
    </summary>
    
      <category term="云安全" scheme="http://qimingyu.github.io/categories/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="Spark" scheme="http://qimingyu.github.io/tags/Spark/"/>
    
      <category term="Hadoop" scheme="http://qimingyu.github.io/tags/Hadoop/"/>
    
      <category term="版本库" scheme="http://qimingyu.github.io/tags/%E7%89%88%E6%9C%AC%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>为博客更新了域名</title>
    <link href="http://qimingyu.github.io/2016/06/29/%E4%B8%BA%E5%8D%9A%E5%AE%A2%E6%9B%B4%E6%96%B0%E4%BA%86%E5%9F%9F%E5%90%8D/"/>
    <id>http://qimingyu.github.io/2016/06/29/为博客更新了域名/</id>
    <published>2016-06-29T11:50:13.000Z</published>
    <updated>2016-06-29T12:14:24.395Z</updated>
    
    <content type="html">&lt;p&gt;之前的域名是：qimingyu.github.com，现在更新为：qimingyu.com。也就是说花了45元特意去注册了一个域名，使用期限是一年。&lt;/p&gt;
&lt;p&gt;起因是最近搞威胁情报接触到Whois服务，whois服务是输入域名地址或IP地址，返回给你相应的一些注册信息的服务。然后就研究了一下域名，联想到之前看到有人专门靠倒卖域名赚钱的，这其实也是一个产业，相当于抢注域名，然后养域名，静静等待买家的出现，最后转手卖掉赚钱。&lt;/p&gt;
&lt;p&gt;域名本身没有什么价值，就是网络世界的唯一标识而已。但凡是稀缺性的东西就会有价值，所以有些域名也是天价，例如：sex.com，拍了几百万美金。后来我发现在com下，输入自己的名字拼音居然没有被注册，要知道顶级域名com下，稍微有点价值的都应该被别人注册了，感谢父母啊，给我取了一个不错的名字，哈哈。&lt;/p&gt;
&lt;p&gt;其实给网站重新搞域名也是折腾了半天的，这里稍微记录一下。重点是更新域名后，原来的域名也是可以访问的。&lt;/p&gt;
&lt;p&gt;先是买一个域名，我是通过阿里云在万网上买的，然后进入其管理页面，加上以下三条域名解析记录：&lt;br&gt;&lt;img src=&quot;/images/2016_6_29/1.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后在source文件中增加一个CNAME的文件，里面写：qimingyu.com，然后通过hexo g生成之后，hexo d再推送到远端。这样就搞定了。&lt;/p&gt;
&lt;p&gt;不过45元其实还包括很多服务，邮箱什么的，还有阿里云的一整套其他东西，后面再慢慢了解吧。  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/06/29/为博客更新了域名/&quot;&gt;http://qimingyu.github.io/2016/06/29/为博客更新了域名/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;之前的域名是：qimingyu.github.com，现在更新为：qimingyu.com。也就是说花了45元特意去注册了一个域名，使用期限是一年。&lt;/p&gt;
&lt;p&gt;起因是最近搞威胁情报接触到Whois服务，whois服务是输入域名地址或IP地址，返回给你相应的一些注册信息的
    
    </summary>
    
      <category term="网站技术" scheme="http://qimingyu.github.io/categories/%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="域名" scheme="http://qimingyu.github.io/tags/%E5%9F%9F%E5%90%8D/"/>
    
  </entry>
  
  <entry>
    <title>不要重复造轮子</title>
    <link href="http://qimingyu.github.io/2016/06/28/%E4%B8%8D%E8%A6%81%E9%87%8D%E5%A4%8D%E9%80%A0%E8%BD%AE%E5%AD%90/"/>
    <id>http://qimingyu.github.io/2016/06/28/不要重复造轮子/</id>
    <published>2016-06-28T06:40:37.000Z</published>
    <updated>2016-07-11T14:49:39.000Z</updated>
    
    <content type="html">&lt;p&gt;公司在对待一件事情上考虑的是可用性和成本原则，前几天花了那么大的气力搭建了大数据机器学习的平台，其实在百度早就有一个机器学习的平台了，其提供了更为丰富的接口。只需学会用它的平台就行了。&lt;/p&gt;
&lt;p&gt;随着计算机技术的发展，技术的成长是突飞猛进的，因此做一件事一定要站在巨人的肩膀上，考虑实际需求之后，快速学会使用别人的工具达到自己所做事情的完美结果即可。站在企业的角度上招人也是，对于大企业，有其本身的技术积累，也有很多的技术基础设施的建设（大数据平台），要学会好好利用这些资源，而不要自己在那里YY，意淫，重复造轮子浪费时间。而在使用工具的过程中，遇到问题了，再去深入，这才是对的。&lt;/p&gt;
&lt;h3 id=&quot;7月11日更新&quot;&gt;&lt;a href=&quot;#7月11日更新&quot; class=&quot;headerlink&quot; title=&quot;7月11日更新&quot;&gt;&lt;/a&gt;7月11日更新&lt;/h3&gt;&lt;p&gt;虽然说不要重复造轮子，但是对轮子的理解太重要了。  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/06/28/不要重复造轮子/&quot;&gt;http://qimingyu.github.io/2016/06/28/不要重复造轮子/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;公司在对待一件事情上考虑的是可用性和成本原则，前几天花了那么大的气力搭建了大数据机器学习的平台，其实在百度早就有一个机器学习的平台了，其提供了更为丰富的接口。只需学会用它的平台就行了。&lt;/p&gt;
&lt;p&gt;随着计算机技术的发展，技术的成长是突飞猛进的，因此做一件事一定要站在巨人的
    
    </summary>
    
      <category term="安全感悟" scheme="http://qimingyu.github.io/categories/%E5%AE%89%E5%85%A8%E6%84%9F%E6%82%9F/"/>
    
    
      <category term="造轮子" scheme="http://qimingyu.github.io/tags/%E9%80%A0%E8%BD%AE%E5%AD%90/"/>
    
  </entry>
  
  <entry>
    <title>关于机器学习</title>
    <link href="http://qimingyu.github.io/2016/06/27/%E5%85%B3%E4%BA%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    <id>http://qimingyu.github.io/2016/06/27/关于机器学习/</id>
    <published>2016-06-27T13:26:01.000Z</published>
    <updated>2016-07-04T09:21:54.687Z</updated>
    
    <content type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;最近搞spark和hadoop的机器学习，简直是搞成傻逼了。太他妈难了，简直搞的想哭。之前接触机器学习，都是在单机上面能够跑的机器学习，还没有和大数据结合起来，更没有和这些大数据的平台结合起来。一旦变成集群之后，首先是对远程控制服务器全命令行的不熟，然后是对大数据平台本身的不熟，结果真是变成一脸懵逼了。报一个错完全不知所措了。&lt;/p&gt;
&lt;h2 id=&quot;我对机器学习的理解&quot;&gt;&lt;a href=&quot;#我对机器学习的理解&quot; class=&quot;headerlink&quot; title=&quot;我对机器学习的理解&quot;&gt;&lt;/a&gt;我对机器学习的理解&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;在很多情况下，正确地定义特征才是机器学习中最有挑战性的部分。并且提取特征并转化为特征向量是机器学习中很重要的一步。&lt;/li&gt;
&lt;li&gt;在工程领域，也就是说真正的企业中机器学习与大数据结合是必须的。&lt;/li&gt;
&lt;li&gt;平时的论文中，为了研究一个算法，或者改进一个机器学习算法，采用小数据集进行实验也是可以理解的，因为论文的重点在于理论的解释与实验效果的对比。&lt;/li&gt;
&lt;li&gt;关于自己的毕业论文，差分隐私，应该思考新形势下，新情景中的一些实际解决方案。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;7月4日更新&lt;/p&gt;
&lt;p&gt;数据处理引擎之于大数据就像CPU之于计算机，或大脑之于人类。Spark只是一个通用计算框架，利用Spark实现的应用才是其真正价值所在。&lt;/p&gt;
&lt;p&gt;弹性分布式数据集是spark对分步式数据和计算的基本抽象&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/06/27/关于机器学习/&quot;&gt;http://qimingyu.github.io/2016/06/27/关于机器学习/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;最近搞spark和hadoop的机器学习，简直是搞成傻逼了。太他妈难了，简直搞的想哭。之前接触机器学习，都是在单机上面能够跑的机器学习，还没
    
    </summary>
    
      <category term="云安全" scheme="http://qimingyu.github.io/categories/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="机器学习" scheme="http://qimingyu.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>我对“数据驱动安全”的一些理解</title>
    <link href="http://qimingyu.github.io/2016/06/27/%E6%88%91%E5%AF%B9%E2%80%9C%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8%E5%AE%89%E5%85%A8%E2%80%9D%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%A7%A3/"/>
    <id>http://qimingyu.github.io/2016/06/27/我对“数据驱动安全”的一些理解/</id>
    <published>2016-06-27T05:39:59.000Z</published>
    <updated>2016-06-27T06:22:47.988Z</updated>
    
    <content type="html">&lt;p&gt;最近安全圈传的比较火的就是一位白帽子黑客，脱了“世纪佳缘”厂商的一些库，然后厂商一方面认可了他提的漏洞，另一方面却报警把他抓了起来。这个事情引发了安全界广泛的讨论。具体可看以下链接：&lt;a href=&quot;https://zhuanlan.zhihu.com/p/21417658?refer=hi301&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;《“白帽”黑客被抓事件，我想说….》&lt;/a&gt;、&lt;a href=&quot;https://zhuanlan.zhihu.com/p/21428012?refer=hi301&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;《别踩白帽子上位、也别总拿未授权说事》&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;而在这件事中，我从个人道路选择的角度上给出我的一些看法。首先不可否认的是，白帽子黑客们确实为安全整体水平的提升做了很大的贡献，这点要感谢他们。但站在一个更宏观的层面来说，我觉得这些都是安全攻防中一城一地的较量与得失。有点像单兵作战和单挑。在功与防之间，即使安全工作者们战胜了黑客们，但也只是单次的胜利，我始终觉得这些工作都只是“术”，而没有上升为“道”。&lt;/p&gt;
&lt;p&gt;什么是“道”，我理解的安全中的道，就是系统和架构层次的安全。当然就全局而言，每一个层次都是需要有人存在的。但安全工作，如果能搞一整套系统，能站在一定的高度去俯视安全的“功”与“防”，相当于一个“天网”系统，这些才是真正的牛逼。如果能在安全中从事这样的工作，应该比单纯的渗透一个网络，搞掉一台主机，更让人有成就感和意义。&lt;/p&gt;
&lt;p&gt;而搞这样的工作，又回到那句与业务相关上面来了，一切安全是紧密随着业务而动的，它的根本目的是保障日常业务的顺利进行，这是在甲方做安全必须牢固树立的一个概念，就是：一切安全都应该以业务需要为最终导向。&lt;/p&gt;
&lt;p&gt;“数据驱动安全”，我理解应该是第一次使防守方获得了战场的主动权。我们能够以“数据”为武器，在一定程度上获得对整个局面的宏观把控和提前预警。&lt;/p&gt;
&lt;p&gt;如果以此为方向的话，那么在对人才的需求上面，我们可以完全招会大数据或者会机器学习的人就行了，那么传统的一些安全技能（逆向，渗透，写病毒等）对这个有什么用呢？我想有安全基础的人在具体处理一些安全相关数据时，它对数据的敏感性应该大于没有安全基础的同学，也就是说对数据本身的理解性要强于没有安全基础的同学。&lt;/p&gt;
&lt;p&gt;在技术方面，Java ——&amp;gt; hadoop/spark ——&amp;gt; 机器学习，这一整条路线都是工具，这些工具是用来解决实际安全业务问题的，然后是数据，这些数据与安全相关，如何处理这些数据，最后得到一个比较好的解决方案，这是对相关安全从事人员的要求。而在解决具体问题中，每个人所展现出的联想性与创造性，则是每个人综合能力的体现，看论文的能力，数学能力等等。&lt;/p&gt;
&lt;p&gt;因此，对个人的定位应该是立足安全，对技术采取兼容并包的态度，凡是好的都可以拿来用，但是以解决安全问题为根本。  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/06/27/我对“数据驱动安全”的一些理解/&quot;&gt;http://qimingyu.github.io/2016/06/27/我对“数据驱动安全”的一些理解/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;最近安全圈传的比较火的就是一位白帽子黑客，脱了“世纪佳缘”厂商的一些库，然后厂商一方面认可了他提的漏洞，另一方面却报警把他抓了起来。这个事情引发了安全界广泛的讨论。具体可看以下链接：&lt;a href=&quot;https://zhuanlan.zhihu.com/p/21417658
    
    </summary>
    
      <category term="安全感悟" scheme="http://qimingyu.github.io/categories/%E5%AE%89%E5%85%A8%E6%84%9F%E6%82%9F/"/>
    
    
      <category term="机器学习" scheme="http://qimingyu.github.io/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="大数据" scheme="http://qimingyu.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="数据驱动安全" scheme="http://qimingyu.github.io/tags/%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>Hadoop集群的权限控制</title>
    <link href="http://qimingyu.github.io/2016/06/24/Hadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/"/>
    <id>http://qimingyu.github.io/2016/06/24/Hadoop集群的权限控制/</id>
    <published>2016-06-24T03:54:20.000Z</published>
    <updated>2016-06-27T06:26:26.501Z</updated>
    
    <content type="html">&lt;p&gt;调研了好多文章，Hadoop的权限管理和控制都写的好复杂，还要借助第三方的认证，本人认为这些都太麻烦了。既然只是业务需要，不如搞个简单版本的。&lt;/p&gt;
&lt;p&gt;直到看了这篇文章&lt;a href=&quot;http://shiyanjun.cn/archives/994.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;基于Hadoop SLA认证机制实现权限控制&lt;/a&gt;，豁然开朗。&lt;/p&gt;
&lt;p&gt;业务需求其实很简单：做好两个方面的权限控制就行了：一个是HDFS，另一个是Yarn。而这两个方面的权限是基于CentOS本身的用户及用户组概念的。&lt;/p&gt;
&lt;p&gt;Hadoop SLA基于Hadoop的各种服务（基于协议来划分）与Linux系统的用户、用户组来实现。Hadoop通过制定接口协议的方式来实现节点之间服务调用的逻辑，这样每一个协议所指定的一组服务就是一个认证单元，再基于底层Linux系统的用户和用户组来限制用户（可能是节点服务）有权限执行某一种协议所包含的操作集合。&lt;/p&gt;
&lt;p&gt;先在hadoop的配置文件core-site.xml中增加如下属性配置：&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;name&amp;gt;hadoop.security.authorization&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后重启集群，接着修改配置文件/etc/hadoop/hadoop-policy.xml中的部分配置项，具体修改内容如下：&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;name&amp;gt;security.client.protocol.acl&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;value&amp;gt;work&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;description&amp;gt;ACL for ClientProtocol, which is used by user code&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       via the DistributedFileSystem.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       The ACL is a comma-separated list of user and group names. The user and&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       group list is separated by a blank. For e.g. &quot;alice,bob users,wheel&quot;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       A special value of &quot;*&quot; means all users are allowed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/description&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;name&amp;gt;security.refresh.policy.protocol.acl&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;value&amp;gt;work&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;description&amp;gt;ACL for RefreshAuthorizationPolicyProtocol, used by the&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       dfsadmin and mradmin commands to refresh the security policy in-effect.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       The ACL is a comma-separated list of user and group names. The user and&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       group list is separated by a blank. For e.g. &quot;alice,bob users,wheel&quot;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       A special value of &quot;*&quot; means all users are allowed.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/description&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;name&amp;gt;security.job.client.protocol.acl&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;value&amp;gt;work&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;description&amp;gt;ACL for MRClientProtocol, used by job clients to&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       communciate with the MR ApplicationMaster to query job status etc.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       The ACL is a comma-separated list of user and group names. The user and&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       group list is separated by a blank. For e.g. &quot;alice,bob users,wheel&quot;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	       A special value of &quot;*&quot; means all users are allowed.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;/description&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后将该配置文件同步到整个集群的所有节点上。&lt;/p&gt;
&lt;p&gt;最后执行如下命令，使其生效：&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./hdfs dfsadmin -refreshServiceAcl&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./yarn rmadmin -refreshServiceAcl&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;权限控制就搞定了，不过这是基于服务的权限控制。可用就行。需要说明的是，由于目前没有root权限，等到需要的时候再具体配置这块就行。  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/06/24/Hadoop集群的权限控制/&quot;&gt;http://qimingyu.github.io/2016/06/24/Hadoop集群的权限控制/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;调研了好多文章，Hadoop的权限管理和控制都写的好复杂，还要借助第三方的认证，本人认为这些都太麻烦了。既然只是业务需要，不如搞个简单版本的。&lt;/p&gt;
&lt;p&gt;直到看了这篇文章&lt;a href=&quot;http://shiyanjun.cn/archives/994.html&quot; ta
    
    </summary>
    
      <category term="云安全" scheme="http://qimingyu.github.io/categories/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="hadoop" scheme="http://qimingyu.github.io/tags/hadoop/"/>
    
      <category term="权限控制" scheme="http://qimingyu.github.io/tags/%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/"/>
    
  </entry>
  
  <entry>
    <title>我对“威胁情报”的一些看法</title>
    <link href="http://qimingyu.github.io/2016/06/24/%E6%88%91%E5%AF%B9%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9C%8B%E6%B3%95/"/>
    <id>http://qimingyu.github.io/2016/06/24/我对威胁情报的一些看法/</id>
    <published>2016-06-24T02:29:24.000Z</published>
    <updated>2016-08-09T03:32:48.301Z</updated>
    
    <content type="html">&lt;h2 id=&quot;什么是“威胁情报”&quot;&gt;&lt;a href=&quot;#什么是“威胁情报”&quot; class=&quot;headerlink&quot; title=&quot;什么是“威胁情报”&quot;&gt;&lt;/a&gt;什么是“威胁情报”&lt;/h2&gt;&lt;p&gt;威胁情报分为如下5个部分：&lt;br&gt;&lt;img src=&quot;/images/threat_intelligence/1.JPG&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;需求：根据业务需要制定合理的安全需求&lt;/li&gt;
&lt;li&gt;收集：收集所有需要的数据信息&lt;/li&gt;
&lt;li&gt;分析：采用大数据和机器学习的方法对数据进行分析处理&lt;/li&gt;
&lt;li&gt;产出：从这些数据中得到有价值的情报&lt;/li&gt;
&lt;li&gt;评价：对这些情报做出评价，并制定相应的对策&lt;br&gt;目前的主要工作是在第三步上面。而“威胁情报”在公司整个安全团队中的位置，可参考下图：&lt;br&gt;&lt;img src=&quot;/images/threat_intelligence/2.JPG&quot; alt=&quot;2&quot;&gt;&lt;br&gt;这是从宏观上，站在行业的角度看“威胁情报”。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;关于理念&quot;&gt;&lt;a href=&quot;#关于理念&quot; class=&quot;headerlink&quot; title=&quot;关于理念&quot;&gt;&lt;/a&gt;关于理念&lt;/h2&gt;&lt;p&gt;最近接触“威胁情报”，在安全领域而言，我相信这是第一次，由于数据的存在，使安全的防守方比攻击方更占优势。有一个口号说的非常精准：聚焦情报威胁，数据驱动安全。在这一点上，我看了360公司的产品，他们确确实实走在了整个业界的前列。还有一个小的创业公司，叫微步在线，他们也是专注于做威胁情报的，这些公司都走在了百度的前面。而百度的理念是：简单可依赖。我是非常认可这个理念的，因此人在百度，又是做威胁情报的，看到别的公司做的这么好，远远做在了我们的前面，深感焦虑和压力。&lt;/p&gt;
&lt;p&gt;人是要有使命感的，我要把一个产品做好，做就要做到业界最牛逼。百度有其自身的优势，在数据方面他有一定的优势，但问题在于组与组之间的流通性不足，一个小组致力于做这个小组的任务，而不是从整个大局出发，因而导致时间上的没有最大利用。但我觉得这不是问题，我只是感到时间的紧迫感。&lt;/p&gt;
&lt;h2 id=&quot;关于技术&quot;&gt;&lt;a href=&quot;#关于技术&quot; class=&quot;headerlink&quot; title=&quot;关于技术&quot;&gt;&lt;/a&gt;关于技术&lt;/h2&gt;&lt;p&gt;我一直在思考作为技术人员，或者作为一家技术型科技公司，如何给自己及公司的技术定位？我觉得最准确的是：技术一定要以业务为导向。不能靠前也不能落后，技术是匹配业务的，一定是业务需要，才去拓展技术。在我看来，任何一家公司，一定是要产生实际的社会价值与影响，并能够产生利润的，因此技术应该服务于业务，而不能本末倒置。&lt;br&gt;而随着时代的发展，社会越来越需要综合性，并且有自己想法的人才。传统安全人才需要懂一方面或者精通一方面技术即可，而现在随着各行各业及各种数据的交融，对人的综合性要求是越来越高的。&lt;br&gt;我感受到安全方面，很热门的一块，就是与大数据相结合的安全，它对人提出了如下要求：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;既要懂大数据又要懂安全（知识面的广度）&lt;/li&gt;
&lt;li&gt;快速学习能力（包括英文文档的阅读能力）&lt;/li&gt;
&lt;li&gt;数学水平（对数据本身的优化处理以及理解）&lt;/li&gt;
&lt;li&gt;沟通交流能力（PPT与展示，思路清晰）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;关于校招&quot;&gt;&lt;a href=&quot;#关于校招&quot; class=&quot;headerlink&quot; title=&quot;关于校招&quot;&gt;&lt;/a&gt;关于校招&lt;/h2&gt;&lt;p&gt;把自己全身心的投入到产品当中，全身心的解决问题，了解行业发展。我觉得这个应该才是王道。不要停止思考，至于校招offer，以及毕业论文，我觉得这应该是顺带解决完成的事情，而不要把后者作为单一的目标。社会往往喜欢有实际价值并且能够解决问题，提出创意的人。而你的创意，包括论文的创新，应该来自于实际工作中的问题，所面临的难点与痛点，这才是真正有价值的。&lt;/p&gt;
&lt;p&gt;好好学习，唯一的安全感来自于自身，以及自己所确立的价值观。&lt;/p&gt;
&lt;h2 id=&quot;更新一&quot;&gt;&lt;a href=&quot;#更新一&quot; class=&quot;headerlink&quot; title=&quot;更新一&quot;&gt;&lt;/a&gt;更新一&lt;/h2&gt;&lt;hr&gt;
&lt;p&gt;8月9日更新&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;目前的威胁情报平台是跟业务息息相关的，我们目前与两个部门紧密合作，一个是大搜，另一个是金融和钱包部门，威胁情报相当于是把安全融入到了业务中，紧紧跟随随业务推进的。&lt;/p&gt;
&lt;p&gt;我们从其他部门获取数据，数据来源有：移动端（百度钱包的安全SDK数据）、网络端（DNS数据，恶意IP数据，Whois历史记录数据，泛域数据）、恶意邮件数据，这些数据来源之后我们对其进行初步清洗，然后按照标准格式进行入库，入库之后，进行数据分析和处理，再输出到各大业务之中，确保其他业务的安全。&lt;/p&gt;
&lt;p&gt;而为了做好“威胁情报”这一件事，需要掌握的相关知识大概整理如下。要学习的知识和掌握的技能：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;知道怎么从别人的数据库中取出数据（懂各种不同数据的操作及大概原理）&lt;/li&gt;
&lt;li&gt;知道怎么预处理这些获取到的数据，并且入我们自己的威胁情报数据库中（基于大数据的操作，Spark平台的编程）&lt;/li&gt;
&lt;li&gt;利用机器学习算法进行分析（会各大机器学习算法及大概原理，熟练使用第三方函数包，MLlib，Sparking Water等）&lt;/li&gt;
&lt;li&gt;将得到的结果输出给其他业务，提供Saas的企业级服务接口给别人（Python或其他编程语言的熟练使用，写接口）&lt;/li&gt;
&lt;li&gt;有一定的安全分析能力及安全基础知识（加密解密，逆向，网络安全OWASP，系统安全等）&lt;/li&gt;
&lt;li&gt;熟练操作Linux系统&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;可见对相关从业人员的要求之高，然而更重要的，对于创业型企业来考虑（如果拿威胁情报作为创业项目的话），他们更重要的是没有数据来源渠道，因此，这个方向的创业，门槛还是相当高的，小企业不要轻易尝试。但不可否认的是，在安全领域而言，威胁情报确实是未来的一个趋势。&lt;/p&gt;
&lt;p&gt;还有一点是，我们在做事情或者写程序的时候，一定要考虑上层的架构。也就是说虽然是做的下层的事，但有时往往上层架构搭的不好，导致下面会非常混乱。因此，一定要从架构师的角度去思考问题。专注于一个领域，做好一件事，这就是本事。  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/06/24/我对威胁情报的一些看法/&quot;&gt;http://qimingyu.github.io/2016/06/24/我对威胁情报的一些看法/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;什么是“威胁情报”&quot;&gt;&lt;a href=&quot;#什么是“威胁情报”&quot; class=&quot;headerlink&quot; title=&quot;什么是“威胁情报”&quot;&gt;&lt;/a&gt;什么是“威胁情报”&lt;/h2&gt;&lt;p&gt;威胁情报分为如下5个部分：&lt;br&gt;&lt;img src=&quot;/images/threat_
    
    </summary>
    
      <category term="安全感悟" scheme="http://qimingyu.github.io/categories/%E5%AE%89%E5%85%A8%E6%84%9F%E6%82%9F/"/>
    
    
      <category term="360公司" scheme="http://qimingyu.github.io/tags/360%E5%85%AC%E5%8F%B8/"/>
    
      <category term="威胁情报" scheme="http://qimingyu.github.io/tags/%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5/"/>
    
      <category term="大数据" scheme="http://qimingyu.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"/>
    
      <category term="微步在线" scheme="http://qimingyu.github.io/tags/%E5%BE%AE%E6%AD%A5%E5%9C%A8%E7%BA%BF/"/>
    
  </entry>
  
  <entry>
    <title>Spark On YARN集群安装部署</title>
    <link href="http://qimingyu.github.io/2016/06/17/Spark_On_YARN%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"/>
    <id>http://qimingyu.github.io/2016/06/17/Spark_On_YARN集群安装部署/</id>
    <published>2016-06-17T13:22:32.000Z</published>
    <updated>2016-08-08T03:46:18.295Z</updated>
    
    <content type="html">&lt;p&gt;项目要求做威胁情报分析和病毒扫描。因此需要搭建spark的大数据平台，各种坑都被我走了一遍，心伤的很。这里写出来，让同行少走弯路。&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;基本知识&quot;&gt;&lt;a href=&quot;#基本知识&quot; class=&quot;headerlink&quot; title=&quot;基本知识&quot;&gt;&lt;/a&gt;基本知识&lt;/h2&gt;&lt;p&gt;突然接触Spark，对我来说完全是全新的平台，并且也是第一次接触计算机集群的概念。&lt;/p&gt;
&lt;h2 id=&quot;写在前面&quot;&gt;&lt;a href=&quot;#写在前面&quot; class=&quot;headerlink&quot; title=&quot;写在前面&quot;&gt;&lt;/a&gt;写在前面&lt;/h2&gt;&lt;p&gt;搭建过程其实还有很多东西没有弄懂，慢慢补充。考虑实际情况，我所面临的限制条件如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;公司的服务器，没有给root权限，只有work权限。（导致安装软件遇到各种问题）&lt;/li&gt;
&lt;li&gt;服务器没有连外网。（不能直接通过服务器下载东西）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;本文讲述在这两点下如何搭建Yarn的Spark大数据平台。软件版本为：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;服务器版本：Centos 6.4&lt;/li&gt;
&lt;li&gt;Java版本：1.8.0_91&lt;/li&gt;
&lt;li&gt;SCala版本：2.10.4&lt;/li&gt;
&lt;li&gt;hadoop版本：2.6.0&lt;/li&gt;
&lt;li&gt;spark版本：1.6.1&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;（版本的选择也很重要，不然会有各种莫名其妙的错误）&lt;/p&gt;
&lt;h2 id=&quot;SSH免密码登录&quot;&gt;&lt;a href=&quot;#SSH免密码登录&quot; class=&quot;headerlink&quot; title=&quot;SSH免密码登录&quot;&gt;&lt;/a&gt;SSH免密码登录&lt;/h2&gt;&lt;p&gt;这一步的原理是用SSH协议，产生一对公私密钥，然后把私钥留在自己电脑上，公钥发给别人，当电脑B想要登陆电脑Ａ时，本来是需要输入用户名和密码的，但Ｂ有Ａ的公钥的话，就不用输入这些了，而可以直接登陆。&lt;br&gt;因此在一个计算机集群上，这一步可以理解为让集群中的任意一台计算机拥有该集群里面其他所有计算机的公钥。具体实现如下：&lt;br&gt;我这里一共有21台主机，构成计算机集群。他们的主机名分别如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;yq01&lt;/li&gt;
&lt;li&gt;yq02&lt;/li&gt;
&lt;li&gt;yq03&lt;/li&gt;
&lt;li&gt;……&lt;/li&gt;
&lt;li&gt;yq20&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;选第一台电脑为主机，其余为工作机。&lt;br&gt;因此在每一台电脑上执行操作：&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ssh-keygen -t rsa&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后是一路回车，直到发现在指定的目录中生成了一对公私密钥。然后把机子上产生的id_rsa.pub发送给我们的第一台主机：&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;scp ~/.ssh/id_rsa.pub work@yq01:~/.ssh/id_rsa.pub.slave1   &lt;span class=&quot;comment&quot;&gt;//注意slave后面命名的数字编号&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在其余20台机器上都执行完以上步骤后，会发现主机上面文件.ssh目录中多了很多的公钥，分别为slave1到slave20的。然后在主机上把这些公钥文件全部加在用于认证的文件authorized_keys中：&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cat ~/.ssh/id_rsa.pub* &amp;gt;&amp;gt; ~/.ssh/authorized_keys&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后把主机中的authorized_keys文件分发给每个工作机：&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;scp ~/.ssh/authorized_keys work@yq01:~/.ssh/&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这样21台机器相互之间都可以用SSH免密码登录了。&lt;/p&gt;
&lt;h2 id=&quot;安装Java&quot;&gt;&lt;a href=&quot;#安装Java&quot; class=&quot;headerlink&quot; title=&quot;安装Java&quot;&gt;&lt;/a&gt;安装Java&lt;/h2&gt;&lt;p&gt;由于远程服务器均不能联网，因此安装所有软件全部都是在本地下载压缩包之后，然后通过命令&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;rz -e&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;传输到服务器端的。&lt;br&gt;注意这里有一个很大的坑，就是传输文件的时候，如下图所示：&lt;br&gt;&lt;img src=&quot;/images/spark_on_yarn/1.png&quot; alt=&quot;1&quot;&gt;&lt;br&gt;最下面那个以ASCII传输的勾选框一定不要勾选。&lt;br&gt;传输过去之后进行解压缩，命令格式为：&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf  test.tar.gz  -C  ~/java/&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;后面是指解压缩到指定路径。&lt;br&gt;解压缩之后，需要配置环境变量，这里也是很大的一个坑。当前工作目录下有一个隐藏文件夹.bashrc，就是在这里面进行配置的。配置之后，用如下命令：&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;source .bashrc&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;进行环境变量的更新，source命令表示执行当前指定文件。&lt;br&gt;环境变量还可以通过命令env进行查看。注意PATH里面的值，系统是从前往后寻找的，因此我们配的话，要放在前面。文件.bashrc里面加入如下内容：&lt;br&gt;&lt;img src=&quot;/images/spark_on_yarn/2.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;p&gt;下列命令验证Java是否安装成功：&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;java -version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;javac&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;java&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;分别出来正常的东西表示安装成功。&lt;br&gt;在一台电脑上装成功之后，将该java文件夹发送给其余所有电脑。写如下脚本文件scpjava：&lt;br&gt;&lt;img src=&quot;/images/spark_on_yarn/4.png&quot; alt=&quot;4&quot;&gt;&lt;br&gt;用如下命令执行：&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;source scpjava&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这样其他主机上面都多了一个java文件。&lt;/p&gt;
&lt;h2 id=&quot;安装SCala&quot;&gt;&lt;a href=&quot;#安装SCala&quot; class=&quot;headerlink&quot; title=&quot;安装SCala&quot;&gt;&lt;/a&gt;安装SCala&lt;/h2&gt;&lt;p&gt;过程与安装Java一样，在文件.bashrc里面继续添加如下内容：&lt;br&gt;&lt;img src=&quot;/images/spark_on_yarn/3.png&quot; alt=&quot;3&quot;&gt;&lt;br&gt;下列命令验证SCala是否安装成功：&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;scala -version&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;出来正常的东西表示安装成功。&lt;br&gt;采样同样的方法，将scala文件也分发给所有的主机。&lt;/p&gt;
&lt;h2 id=&quot;安装hadoop&quot;&gt;&lt;a href=&quot;#安装hadoop&quot; class=&quot;headerlink&quot; title=&quot;安装hadoop&quot;&gt;&lt;/a&gt;安装hadoop&lt;/h2&gt;&lt;p&gt;hadoop的安装过程也是下载压缩包之后，解压，然后配置，分发给其他主机。&lt;br&gt;其配置过程与本文所给出的参考文献一样。&lt;/p&gt;
&lt;p&gt;配置core-site.xml,如下：&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;configuration&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         # 指定NameNode主机名和请求端口号&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;name&amp;gt;fs.defaultFS&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;value&amp;gt;hdfs://yq01:9000/&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         # 文件系统依赖的基础配置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;name&amp;gt;hadoop.tmp.dir&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;value&amp;gt;file:/home/work/hadoop/hadoop-2.6.0/tmp&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;配置hdfs-site.xml，如下：&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;configuration&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;name&amp;gt;dfs.namenode.http-address&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;value&amp;gt;yq01:8810&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;name&amp;gt;dfs.namenode.secondary.http-address&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;value&amp;gt;yq01:8811&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;name&amp;gt;dfs.namenode.name.dir&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         # NameNode存储命名空间和相关元数据信息的本地文件系统目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;value&amp;gt;file:/home/work/hadoop/hadoop-2.6.0/dfs/name&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;name&amp;gt;dfs.datanode.data.dir&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         # DataNode节点存储HDFS文件的本地文件系统目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;value&amp;gt;file:/home/work/hadoop/hadoop-2.6.0/dfs/data&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         # 文件备份数量&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;name&amp;gt;dfs.replication&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &amp;lt;value&amp;gt;3&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &amp;lt;/configuration&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;第一个配置的是hdfs的网站，默认应该是50070，由于服务器只有8000到9000之间的端口允许访问，因此改为8810。&lt;/p&gt;
&lt;p&gt;配置文件mapred-site.xml，如下：&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;configuration&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  #  目的是指定框架名，告诉MapReduce它将作为YARN的应用程序运行。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;name&amp;gt;mapreduce.framework.name&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;value&amp;gt;yarn&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;配置文件yarn-site.xml，如下：&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;configuration&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;name&amp;gt;yarn.nodemanager.aux-services&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      # 告诉NodeManager需要实现一个名为mapreduce.shuffle的辅助服务&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;value&amp;gt;mapreduce_shuffle&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      # 特定的类名实现该方法&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;name&amp;gt;yarn.nodemanager.aux-services.mapreduce.shuffle.class&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;value&amp;gt;org.apache.hadoop.mapred.ShuffleHandler&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;name&amp;gt;yarn.resourcemanager.address&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;value&amp;gt;yq01:8032&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;name&amp;gt;yarn.resourcemanager.scheduler.address&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;value&amp;gt;yq01:8030&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;name&amp;gt;yarn.resourcemanager.resource-tracker.address&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;value&amp;gt;yq01:8035&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;name&amp;gt;yarn.resourcemanager.admin.address&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;value&amp;gt;yq01:8033&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;name&amp;gt;yarn.resourcemanager.webapp.address&amp;lt;/name&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;lt;value&amp;gt;yq01:8088&amp;lt;/value&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;/property&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;前面两个是告诉NodeManger需要实现一个名为mapreduce.shuffle的辅助服务，并给它一个类名作为实现该服务的方法。这个特定的配置告诉MapReduce怎么去shuffle。后面五个配置的是相应的一些地址。&lt;/p&gt;
&lt;h2 id=&quot;安装Spark&quot;&gt;&lt;a href=&quot;#安装Spark&quot; class=&quot;headerlink&quot; title=&quot;安装Spark&quot;&gt;&lt;/a&gt;安装Spark&lt;/h2&gt;&lt;p&gt;其安装配置过程与所给出的参考文献一样。&lt;/p&gt;
&lt;h2 id=&quot;最后结果&quot;&gt;&lt;a href=&quot;#最后结果&quot; class=&quot;headerlink&quot; title=&quot;最后结果&quot;&gt;&lt;/a&gt;最后结果&lt;/h2&gt;&lt;p&gt;全都配通了，上图：&lt;br&gt;&lt;img src=&quot;/images/spark_on_yarn/5.png&quot; alt=&quot;5&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/spark_on_yarn/6.png&quot; alt=&quot;6&quot;&gt;&lt;/p&gt;
&lt;p&gt;还要继续考虑授权的问题，以及一些其他方面的熟悉和了解。&lt;/p&gt;
&lt;h2 id=&quot;参考文章&quot;&gt;&lt;a href=&quot;#参考文章&quot; class=&quot;headerlink&quot; title=&quot;参考文章&quot;&gt;&lt;/a&gt;参考文章&lt;/h2&gt;&lt;p&gt;【1】&lt;a href=&quot;http://wuchong.me/blog/2015/04/04/spark-on-yarn-cluster-deploy/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Spark On YARN 集群安装部署&lt;/a&gt; &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/06/17/Spark_On_YARN集群安装部署/&quot;&gt;http://qimingyu.github.io/2016/06/17/Spark_On_YARN集群安装部署/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;项目要求做威胁情报分析和病毒扫描。因此需要搭建spark的大数据平台，各种坑都被我走了一遍，心伤的很。这里写出来，让同行少走弯路。&lt;/p&gt;
    
    </summary>
    
      <category term="云安全" scheme="http://qimingyu.github.io/categories/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="hadoop" scheme="http://qimingyu.github.io/tags/hadoop/"/>
    
      <category term="威胁情报" scheme="http://qimingyu.github.io/tags/%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5/"/>
    
      <category term="spark" scheme="http://qimingyu.github.io/tags/spark/"/>
    
  </entry>
  
  <entry>
    <title>为博客文章添加版权声明</title>
    <link href="http://qimingyu.github.io/2016/06/05/%E4%B8%BA%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E6%B7%BB%E5%8A%A0%E7%89%88%E6%9D%83%E5%A3%B0%E6%98%8E/"/>
    <id>http://qimingyu.github.io/2016/06/05/为博客文章添加版权声明/</id>
    <published>2016-06-05T15:31:40.000Z</published>
    <updated>2016-06-06T04:34:03.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;起因&quot;&gt;&lt;a href=&quot;#起因&quot; class=&quot;headerlink&quot; title=&quot;起因&quot;&gt;&lt;/a&gt;起因&lt;/h2&gt;&lt;p&gt;开始写博客不久，自认为只是为了促进自我学习，所以文章写得也并不十分精细。可这几天一反常态，陆陆续续在微博上总有人加我。直到一天在微博上收到了这样的一封私信：&lt;br&gt;&lt;img src=&quot;/images/copyright/1.png&quot; alt=&quot;1&quot;&gt;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;img src=&quot;/images/copyright/2.png&quot; alt=&quot;2&quot;&gt;&lt;br&gt;开始我并没在意，觉得自己写的文章居然还有人看上了，并且是有着79万粉丝的微博大咖，内心还是感觉不错的。于是很单纯的按照其指示加微信及QQ好友，可是申请虽提交了，对方却毫无回应，既没同意也没反对，于是我也就没放心上，就当这事儿过去了。&lt;/p&gt;
&lt;p&gt;可是之后还是陆陆续续总有人微博粉我，刚好今天下午我很闲，于是就在微博里面搜索了下自己的名字，结果出现了这样的画面：&lt;br&gt;&lt;img src=&quot;/images/copyright/3.png&quot; alt=&quot;3&quot;&gt;&lt;/p&gt;
&lt;p&gt;于是我瞬间就很懵逼了。我不是还没授权的吗？怎么转都转载了？可这并不是重点，重点是当我点开微博里面所给出的链接，原以为会跳到我的博客站点，没想到却跳到了他们的网站，纳尼？？！！&lt;br&gt;&lt;img src=&quot;/images/copyright/4.png&quot; alt=&quot;4&quot;&gt;&lt;/p&gt;
&lt;p&gt;于是这就让我忍无可忍了，虽然你们给出了作者名，但是你们也不能把链接无耻的指向自己的网站吧？也就是说一个正常的用户需要点两次，才能跳到真正的文章原始站点。&lt;/p&gt;
&lt;p&gt;虽然这种盗用转载的事在知乎上屡见不鲜，之前我每次看到作者非常气愤的骂那些公众号时都不太理解，直到今天这事到自己头上，我才明白其中的愤怒。愤怒的原因有以下三点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;自己写的文章被微博营销账号盗用，他们拿你的文章增加了自己的粉丝量。于原作者而言，是出力者，却没有得到丝毫收益。而于转载者而言，他们却用别人的劳动成果获得了自己的收益。这是与“盗窃”无一的。感觉自己的劳动却肥了他人，故而愤怒，也难怪王路会&lt;a href=&quot;https://www.douban.com/note/477775111/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;痛骂《罗辑思维》&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;转载的这两篇文章其实都是残篇，也就是说我并没有写完的。我只是想在网络空间中找一块地方，安安静静的写自己的，学自己的。所以每篇文章的发表，并没有精益求精，而仅仅只是出于监督自己学习的作用。也就是说，我的这两篇文章并不是面对广大读者，而是面对自己的。这就相当于有人把你原本打算私藏的东西公之于众了，并且在微博上以一种不可控的方式进行传播着。这是相当恐怖的，无异于一种舆论暴力，有点类似于电影&lt;a href=&quot;https://movie.douban.com/subject/6799191/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;《搜索》&lt;/a&gt;，能够把事情置于自己的可控范围内是很重要的。&lt;/li&gt;
&lt;li&gt;这两篇文章本来就涉及腾讯及360公司的机密，其笔试题本身就是不允许披露出去的。如果万一造成更大影响，其责任是由我来承担的。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;后来，在我努力下，也算是联系到了相关的编辑，该删的都删了，也算解决了这件事。这本身是件很小的事，但使我却不得不防范于未然，幸而在开始遇到这样的事，这是我第一次认识到版权的重要性，当然，也要学会保护自己的知识产权，使其处于自己的可控之中。于是用了近一个下午的时间，重新调整了一下该博客的框架，使其可以在每篇文章之后自动生成“版权声明”。&lt;/p&gt;
&lt;h2 id=&quot;解决方法&quot;&gt;&lt;a href=&quot;#解决方法&quot; class=&quot;headerlink&quot; title=&quot;解决方法&quot;&gt;&lt;/a&gt;解决方法&lt;/h2&gt;&lt;p&gt;以下内容基本来自于&lt;a href=&quot;http://kuangqi.me/tricks/append-a-copyright-info-after-every-post/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这篇文章&lt;/a&gt;，感谢作者给出的方法。&lt;br&gt;代码如下：&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Add a tail to every post from tail.md&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Great for adding copyright info&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; fs = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;fs&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hexo.extend.filter.register(&lt;span class=&quot;string&quot;&gt;&#39;before_post_render&#39;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;data&lt;/span&gt;)&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(data.copyright == &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; data;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; file_content = fs.readFileSync(&lt;span class=&quot;string&quot;&gt;&#39;tail.md&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(file_content &amp;amp;&amp;amp; data.content.length &amp;gt; &lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        data.content += file_content;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; permalink = &lt;span class=&quot;string&quot;&gt;&#39;\n本文永久链接：&#39;&lt;/span&gt; + data.permalink;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        data.content += permalink;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; data;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;用记事本打开，把上面代码写进去，然后保存成copyright.js文件，注意编码格式为UTF-8，否则为乱码，放在文件hexo–&amp;gt;themes–&amp;gt;next–&amp;gt;scripts中。&lt;br&gt;然后用MarkDown语法写一段版权声明相关的文字，同样也为UTF-8编码格式，保存为tail.md,放在文件hexo的根目录中即可，注意如果是其他地方，上面的脚本可能会找不到该文件。&lt;br&gt;如果有的文章不需要加版权声明的话，在post文章中加如下代码即可：&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;copyright: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;此时出现了另外一个问题，就是文末的永久链接地址，出现了如下所示的情况：&lt;br&gt;&lt;img src=&quot;/images/copyright/5.png&quot; alt=&quot;5&quot;&gt;&lt;br&gt;即在永久链接出现空格处，就停止了，于是我又把所有文章的命名凡是有空格的地方改为加下划线代替，这里指的是post文件的命名，但正式文件里面文章的名称没变，这样也就不影响阅读了。&lt;br&gt;还有一个问题是所自动生成的链接，前面给出的网址是http:yoursite.com（如上图所示），当我push上去之后还是这个前缀，于是我修改网站的配置文件_config.yml，加了如下代码：&lt;br&gt;&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#定义访问的域名&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;url: http://qimingyu.github.io                  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root: /&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;指定了网站的前缀域名，之后就正常了。&lt;/p&gt;
&lt;h2 id=&quot;额外&quot;&gt;&lt;a href=&quot;#额外&quot; class=&quot;headerlink&quot; title=&quot;额外&quot;&gt;&lt;/a&gt;额外&lt;/h2&gt;&lt;p&gt;之前是用dropbox同步网站的，经常出现被墙的情况，于是换了坚果云进行同步。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/06/05/为博客文章添加版权声明/&quot;&gt;http://qimingyu.github.io/2016/06/05/为博客文章添加版权声明/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;起因&quot;&gt;&lt;a href=&quot;#起因&quot; class=&quot;headerlink&quot; title=&quot;起因&quot;&gt;&lt;/a&gt;起因&lt;/h2&gt;&lt;p&gt;开始写博客不久，自认为只是为了促进自我学习，所以文章写得也并不十分精细。可这几天一反常态，陆陆续续在微博上总有人加我。直到一天在微博上收到了这样的一封私信：&lt;br&gt;&lt;img src=&quot;/images/copyright/1.png&quot; alt=&quot;1&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="网站技术" scheme="http://qimingyu.github.io/categories/%E7%BD%91%E7%AB%99%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="hexo" scheme="http://qimingyu.github.io/tags/hexo/"/>
    
      <category term="版权声明" scheme="http://qimingyu.github.io/tags/%E7%89%88%E6%9D%83%E5%A3%B0%E6%98%8E/"/>
    
  </entry>
  
  <entry>
    <title>关于两份实习offer的选择与比较</title>
    <link href="http://qimingyu.github.io/2016/05/27/%E5%85%B3%E4%BA%8E%E4%B8%A4%E4%BB%BD%E5%AE%9E%E4%B9%A0offer%E7%9A%84%E9%80%89%E6%8B%A9%E4%B8%8E%E6%AF%94%E8%BE%83/"/>
    <id>http://qimingyu.github.io/2016/05/27/关于两份实习offer的选择与比较/</id>
    <published>2016-05-27T07:23:30.000Z</published>
    <updated>2016-05-27T08:05:03.000Z</updated>
    
    <content type="html">&lt;p&gt;找实习的工作终于告一段落了，里面各种心酸历程就不提了。现在重点比较下我拿到的两个offer，以及给出我的选择思考过程，由于这次选择将会很大程度上影响甚至决定我未来的发展方向，因此这次选择是相当关键的。在此，我做出了基于自身的思考和慎重抉择。我希望十年后，我不后悔今天的这次选择，并且我相信自己的判断。因此，我把自己的思考写下来，希望日后的自己能够感谢现在的自己。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;虽然我们不知道未来等待自己的是什么，但是在现有程度上做出最合理最慎重的选择，是应该的。选择后，就决不后悔，也决不遗憾。&lt;br&gt;两份offer，一个是高通公司，给出的职位是手机支付安全研究与开发。一个是百度公司，给出的职位是威胁情报云安全，用大数据做安全。&lt;br&gt;先说发展趋势，高通是一家主要做芯片的公司，在手机芯片领域具有其垄断优势。而我去做的是手机支付与手机防盗功能，采用的是TEE与TrustZone技术。而TEE与TrustZone应该都属于可信计算的研究范畴，集中是在硬件设备，特别是芯片层面的安全之上，带我的师兄是做嵌入式出身的。对于高通公司而言，这一块是可以做，也是可以推的，因为毕竟微软、华为、IBM都给出了自己的系统安全解决方案，往后发展，芯片层面的安全应该会是智能设备的标配。对于我的师兄来说，嵌入式出身去高通应该是非常合理且合适的，并且也是相当优秀的。但是可信计算当前的现状是学术界大大走在了工业界之前，虽然沈昌祥院士前不久作了题为&lt;a href=&quot;http://science.china.com.cn/2015-11/04/content_8349167.htm&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;《用可信计算构筑网络安全》&lt;/a&gt;的报告。但是在知乎上面很多人却给出了&lt;a href=&quot;https://www.zhihu.com/question/45344859&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;不同的意见&lt;/a&gt;。而一个人要想在合理的时间内站上时代的风口浪尖，一定要往最新最热最火的方向跑，因为这样个人才会获得最快速的成长，获得最大的自由。而不是在一个奄奄一息的地方浪费生命。总体来说，在高通，把安全做进芯片，进而给出一整套的安全解决方案，这是一种纯技术，而这些技术往往又没有体现在用户身上，自然其价值很难准确衡量和体现，更重要的是，以市场的角度去衡量，这并不是一个现金流部门，并不是直接与用户进行对话，他们的价格是依赖于下游的供应商和上游的手机制造商的，安全包含于整个产品之中，单就部门议价能力而言是不够的。也正是这样的原因，导致了高通外企的不加班，并且薪水的中规中矩（正式员工），这几乎是整体科技企业的现状，当然也包括华为在内。而之所以实习工资开的高，估计高通的逼格也比较高导致的吧。但是往往一个公司逼格高，不一定代表你所在的部门就逼格高，而即使你所在的部门逼格高，也并不代表你在里面就能做自己真正想做的事。外企还存在一个问题是人情的冷暖，也就是工作和生活分的很开，职位权责也很分明，各司其职。在其中待久了，会导致与社会主流一定程度上的脱节。如果说，干了3年，想跳槽，那时候你的积累是什么？人脉及圈子吗？你在外企，与国内的主流互联网公司并不是一个圈子，到时候创业很困难，几乎没有可能性了。跳槽的话，也估计是相同的科技型企业，就我个人而言，这应该不是我要的。&lt;br&gt;整体而言，互联网公司与科技公司还是有很大不同的，互联网公司直接面对的是用户，直接为用户提供服务，在这点上，我更喜欢互联网公司。互联网公司的思维方式也与传统科技型企业有很大不同，互联网公司更开放，更活跃，也更创新。&lt;br&gt;安全分为：移动安全（支付，APP），系统安全（Windows客户端，PE，病毒），网络安全（Web渗透），云安全（大数据），工控安全(设备安全）等，在众多的安全领域和分支下，云安全和移动安全是目前非常好两个的趋势，各大互联网公司都在做（BAT+360），其实技术总体呈现出错综复杂，各领域融合的特点，也就是非常需要复合型与快速学习型的人才。移动安全我没有了解过，我稍微有点优势的地方应该在于系统安全、网络安全和云安全。&lt;br&gt;因此对于9月份的校招，我有两个方向，要么去乙方公司做网络安全的Web渗透方向，要么去甲方公司做大数据方向。这是我现在的思考。&lt;br&gt;除了互联网公司天生基因的优越性，我选择百度的还有一个原因是百度做的东西与我的毕业设计挂钩，由于毕业设计是做差分隐私，也是非常上层的处理，因此也是有用的。&lt;br&gt;其实企业招人，关键在于匹配度，之所以存在很优秀的人找不到好工作，可能就是研究方向偏冷门导致的。那么目前，我所欠缺之处在于：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;基础知识部分还需要加强，其包括语言及算法&lt;/li&gt;
&lt;li&gt;需要拓宽各个安全领域的知识面&lt;/li&gt;
&lt;li&gt;深入学习数据挖掘算法（云方向发展）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;去百度之后，好好学习。要有自己的方向及自己的思考，此最为关键。基于自己独立的思考和判断，可以听别人的意见，但决定一定自己做出，一定要不拘一格走出自己的道路，并且有自己的个性。  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/05/27/关于两份实习offer的选择与比较/&quot;&gt;http://qimingyu.github.io/2016/05/27/关于两份实习offer的选择与比较/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;找实习的工作终于告一段落了，里面各种心酸历程就不提了。现在重点比较下我拿到的两个offer，以及给出我的选择思考过程，由于这次选择将会很大程度上影响甚至决定我未来的发展方向，因此这次选择是相当关键的。在此，我做出了基于自身的思考和慎重抉择。我希望十年后，我不后悔今天的这次选择，并且我相信自己的判断。因此，我把自己的思考写下来，希望日后的自己能够感谢现在的自己。&lt;br&gt;
    
    </summary>
    
      <category term="笔试面经" scheme="http://qimingyu.github.io/categories/%E7%AC%94%E8%AF%95%E9%9D%A2%E7%BB%8F/"/>
    
    
      <category term="百度" scheme="http://qimingyu.github.io/tags/%E7%99%BE%E5%BA%A6/"/>
    
      <category term="威胁情报" scheme="http://qimingyu.github.io/tags/%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5/"/>
    
      <category term="高通" scheme="http://qimingyu.github.io/tags/%E9%AB%98%E9%80%9A/"/>
    
      <category term="可信计算" scheme="http://qimingyu.github.io/tags/%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97/"/>
    
  </entry>
  
  <entry>
    <title>try2hack通关教程</title>
    <link href="http://qimingyu.github.io/2016/05/12/try2hack%E9%80%9A%E5%85%B3%E6%95%99%E7%A8%8B/"/>
    <id>http://qimingyu.github.io/2016/05/12/try2hack通关教程/</id>
    <published>2016-05-12T03:25:36.000Z</published>
    <updated>2016-05-17T07:42:35.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;初衷&quot;&gt;&lt;a href=&quot;#初衷&quot; class=&quot;headerlink&quot; title=&quot;初衷&quot;&gt;&lt;/a&gt;初衷&lt;/h2&gt;&lt;p&gt;既然学完了WebGoat系列教程，下面来综合实战演练一下，同时也是检测一下自己的学习成果如何。&lt;br&gt;找了这样的一个网站，&lt;a href=&quot;http://www.try2hack.nl/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;try2hack&lt;/a&gt;，这是一个专门用来做网络攻击练习的网站，虽然比较老了，但用来做练习还是可以的。该网站一共有13道关卡，难度是逐步递增的，下面我们逐一开始挑战。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;实战攻击&quot;&gt;&lt;a href=&quot;#实战攻击&quot; class=&quot;headerlink&quot; title=&quot;实战攻击&quot;&gt;&lt;/a&gt;实战攻击&lt;/h2&gt;&lt;p&gt;这是该网站开始的页面：&lt;br&gt;&lt;img src=&quot;/images/try2hack/2.png&quot; alt=&quot;2&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;Level-1&quot;&gt;&lt;a href=&quot;#Level-1&quot; class=&quot;headerlink&quot; title=&quot;Level 1&quot;&gt;&lt;/a&gt;Level 1&lt;/h3&gt;&lt;p&gt;这是第一关，网址：&lt;a href=&quot;http://www.try2hack.nl/levels/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.try2hack.nl/levels/&lt;/a&gt;&lt;br&gt;&lt;img src=&quot;/images/try2hack/3.png&quot; alt=&quot;3&quot;&gt;&lt;br&gt;上图要求我们输入密码然后通过。我试着随便输入了两次密码，均弹出如下提示：&lt;br&gt;&lt;img src=&quot;/images/try2hack/4.png&quot; alt=&quot;4&quot;&gt;&lt;/p&gt;
&lt;p&gt;点击确定之后就跳转到了&lt;a href=&quot;http://www.disney.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;迪斯尼&lt;/a&gt;的网站。此时burpsuit才拦截到浏览器发给服务器的包。也就是说验证过程是在拦截到包之前发生的。&lt;br&gt;由此推断这是一个客户端的验证程序，并且是用JS验证密码的。我们知道所有在客户端进行的验证程序都是不安全的。果然，当查看该页面的源代码，看到了如下JS的代码片段：&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;script type=&lt;span class=&quot;string&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!--&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  function Try(passwd) &amp;#123;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (passwd ==&quot;h4x0r&quot;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      alert(&quot;Alright! On to level 2...&quot;);   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      location.href = &quot;level2-xfdgnh.xhtml&quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      alert(&quot;The password is incorrect. Please don&#39;t try again.&quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      location.href = &quot;http://www.disney.com/&quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //--&amp;gt;&lt;/span&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;由IF判断语句可以看出密码为h4x0r，于是输入密码：h4x0r，然后提交：&lt;br&gt;&lt;img src=&quot;/images/try2hack/1.png&quot; alt=&quot;1&quot;&gt;&lt;br&gt;第一关就轻松通过了。&lt;br&gt;&lt;strong&gt;总结：这一关主要考查Html的页面源代码和JS。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;Level-2&quot;&gt;&lt;a href=&quot;#Level-2&quot; class=&quot;headerlink&quot; title=&quot;Level 2&quot;&gt;&lt;/a&gt;Level 2&lt;/h3&gt;&lt;p&gt;网址：&lt;a href=&quot;http://www.try2hack.nl/levels/level2-xfdgnh.xhtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.try2hack.nl/levels/level2-xfdgnh.xhtml&lt;/a&gt;&lt;br&gt;第二关的页面如下：&lt;br&gt;&lt;img src=&quot;/images/try2hack/5.png&quot; alt=&quot;5&quot;&gt;&lt;br&gt;可以看出是需要我们输入用户名和密码，然后提交。但有一个问题就是当我们输入用户名和密码之后，点击下面第三个提交的按钮却没有反应。&lt;br&gt;于是我们打开burpsuit抓包试试，点击下面第三个按钮，burpsuit抓不到任何数据，也就是说这个按钮没有提交任何数据给服务器。那么我们需要看看该按钮所对应的function是什么了。结果在该页面单击鼠标右键希望查看该页面源代码的时候，页面却弹出了这样一个提示：&lt;br&gt;&lt;img src=&quot;/images/try2hack/6.png&quot; alt=&quot;6&quot;&gt;&lt;br&gt;也就是说在该页面鼠标右键是禁止点击的。观察到页面弹出提示的同时，输入用户名和密码的部分也消失了，同时burpsuit捕获到了数据包。不要紧，我们还有firebug，按F12打开firebug，可以看到如下代码，并且发现整个页面都处于JS的function中，原来如此！&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;script type=&lt;span class=&quot;string&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!--&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  passwd=&quot;ItIsSoEasy&quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  function disable_right_click(e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    var browser = navigator.appName.substring ( 0, 9 );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    var event_number = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (browser==&quot;Microsoft&quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      event_number = event.button;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      event_number = e.which;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if ( event_number==2 || event_number==3 || event_number==4) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      alert (&quot;Right/middle mousebutton is disabled&quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      return (false);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return (true);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  function check_mousekey () &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    var mouse_key = 93;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    var keycode = event.keyCode;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if ( keycode == mouse_key )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      alert ( &quot;Mouse Key Is Disabled&quot; );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  function trap_page_mouse_key_events () &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    var browser = navigator.appName.substring ( 0, 9 );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    document.onmousedown = disable_right_click;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if ( browser == &quot;Microsoft&quot; )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      document.onkeydown = check_mousekey;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      document.captureEvents( Event.MOUSEDOWN );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  window.onload = trap_page_mouse_key_events;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //--&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;以上这段JS的目的是定义我们不能使用鼠标右键，这个问题可以很容易的解决：我们只需用burpsuit拦截服务器的响应，修改响应代码并去掉该JS中的第一段Function代码，然后让在浏览器端正常加载就可以了。可是这样做了之后，虽然可以正常查看页面源代码了，可是通过查看页面源代码好像无所收获。然后我们继续通过burpsuit观察：&lt;br&gt;&lt;img src=&quot;/images/try2hack/7.png&quot; alt=&quot;7&quot;&gt;&lt;br&gt;以上是加载该页面时拦截到的两个请求，可看到该页面是分两步加载的。第二部分是一个flash文件，而这个flash文件正是我们输入用户名和密码的地方。现在单独分析该flash文件，根据URL把该flash文件下载到本地，用记事本打开发现是乱码。于是考虑可能需要反编译该flash文件，看看它对应的源码是什么。接着然后我们找了一个能提供&lt;a href=&quot;http://www.showmycode.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;在线反编译的网站&lt;/a&gt;，在该网站中将我们flash的URL输入进去，出现如下反编译后的结果：&lt;br&gt;&lt;img src=&quot;/images/try2hack/8.png&quot; alt=&quot;8&quot;&gt;&lt;br&gt;可以看到该函数是一个判断语句，当用户名为：try2hack，密码为：irtehh4x0r! 时通过，于是输入之后，第二关就过了。&lt;br&gt;&lt;strong&gt;总结：这一关主要考查网页flash文件的反编译。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;Level-3&quot;&gt;&lt;a href=&quot;#Level-3&quot; class=&quot;headerlink&quot; title=&quot;Level 3&quot;&gt;&lt;/a&gt;Level 3&lt;/h3&gt;&lt;p&gt;网址：&lt;a href=&quot;http://www.try2hack.nl/levels/level3-.xhtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.try2hack.nl/levels/level3-.xhtml&lt;/a&gt;&lt;br&gt;刚刚进入第三关，展现在眼前的就是这样一个页面：&lt;br&gt;&lt;img src=&quot;/images/try2hack/9.png&quot; alt=&quot;9&quot;&gt;&lt;br&gt;尝试随便输入几个密码，输入错误之后，又进入了迪斯尼的页面。。。&lt;br&gt;并且发现从第二关跳到第三关的过程中burpsuit居然拦截不到任何请求，因此估计这又是一个客户端的JS验证。观察到第二关通过时所跳转的URL为：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://www.try2hack.nl/levels/level3-.xhtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.try2hack.nl/levels/level3-.xhtml&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;发现用浏览器打开该URL后，右键居然看不到源代码。好吧，我把你用迅雷下载下来再用记事本打开总看的到源代码吧，果然，源代码是这样的：&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;script type=&lt;span class=&quot;string&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;xml&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!--&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  pwd = prompt(&quot;Please enter the password for level 3:&quot;,&quot;&quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if (pwd==PASSWORD)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    alert(&quot;Allright!\nEntering Level 4 ...&quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    location.href = CORRECTSITE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    alert(&quot;WRONG!\nBack to disneyland !!!&quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    location.href = WRONGSITE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  PASSWORD=&quot;AbCdE&quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  CORRECTSITE=&quot;level4-sfvfxc.xhtml&quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  WRONGSITE=&quot;http://www.disney.com&quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  //--&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;输入密码：AbCdE，居然显示不对？！然后我就很疑惑了，其值是不是在程序运行过程中有修改呢？于是我在这段脚本里面设断点，希望能够通过firebug调试观察password的值，可是设好断点，点击之后，根本不在断点处停下来，这是怎么回事？于是我猜想，这说明我们点击确定的代码根本没有运行到这里就被判断了。然后再看看firebug里面的脚本：&lt;br&gt;&lt;img src=&quot;/images/try2hack/10.png&quot; alt=&quot;10&quot;&gt;&lt;br&gt;居然有两个脚本，点开另外一个脚本，显示如下内容：&lt;br&gt;&lt;img src=&quot;/images/try2hack/11.png&quot; alt=&quot;11&quot;&gt;&lt;br&gt;我感觉我被欺骗了，也就是说，真正运行的是后面这段脚本！输入密码：try2hackrawks，果然顺利通过。&lt;br&gt;但这里有一个疑问，后面这一段应该称不上脚本，也就是说最终的判断还是在level3-.xhtml中实现的，那这里JavaScript里面的密码是如何被赋值到level3-.xhtml中的呢？我猜想JavaScript中应该是一个预先的预定义值，相当于初始化变量，然后其实后面的语句其实是对password变量值的修改，也就是说程序时通过第一次的值进行验证的。&lt;br&gt;为了检验我的猜想，再次设断点，运行，停下来了，原来之前停不下来是因为断点位置没有设好，那么下图则看的很清晰了：&lt;br&gt;&lt;img src=&quot;/images/try2hack/12.png&quot; alt=&quot;12&quot;&gt;&lt;br&gt;&lt;strong&gt;总结：这一关主要考查获取页面源代码和JS运行原理和流程。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;Level-4&quot;&gt;&lt;a href=&quot;#Level-4&quot; class=&quot;headerlink&quot; title=&quot;Level 4&quot;&gt;&lt;/a&gt;Level 4&lt;/h3&gt;&lt;p&gt;网址：&lt;a href=&quot;http://www.try2hack.nl/levels/level4-kdnvxs.xhtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.try2hack.nl/levels/level4-kdnvxs.xhtml&lt;/a&gt;&lt;br&gt;来到第四关，展现在眼前的居然是一片白板！？纳尼？&lt;br&gt;&lt;img src=&quot;/images/try2hack/13.png&quot; alt=&quot;13&quot;&gt;&lt;br&gt;查看页面源代码显示如下：&lt;br&gt;&lt;img src=&quot;/images/try2hack/33.png&quot; alt=&quot;33&quot;&gt;&lt;br&gt;以上代码绿色部分表示除IE外其他浏览器都能识别，详细说明见&lt;a href=&quot;http://www.cnblogs.com/thinkingthigh/archive/2013/06/19/3144239.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;。从该代码可以看出这是一个Java Applet的小程序，并且该小程序的URL地址为：&lt;a href=&quot;http://try2hack.nl/levels/PasswdLevel4.class&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://try2hack.nl/levels/PasswdLevel4.class&lt;/a&gt;  。而页面之所以不显示出来，是因为我们没有装Java runtime environment。但是后来即使装了，也是这样的报错：&lt;br&gt;&lt;img src=&quot;/images/try2hack/34.png&quot; alt=&quot;34&quot;&gt;&lt;br&gt;为了解决这个错误，我把谷歌百度翻了个底朝天，并且至少试了四种不同的浏览器，最后依然没有解决。但总体上该报错应该是版本问题，现在很少有浏览器支持Applet了，还有一个可能性是需要小程序有正式的签名，不得而知。把该.class文件下载下来，反编译后得到源码如下:&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;165&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;166&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;167&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;168&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;169&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;170&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;171&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;173&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;174&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;175&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;176&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;177&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;178&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;179&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;180&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;181&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;182&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;183&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;184&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;185&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;186&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;187&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;188&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;189&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;190&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;191&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;192&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;193&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;194&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;195&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;196&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;197&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;198&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;199&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;200&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;201&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;202&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; java.applet.Applet;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; java.applet.AppletContext;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; java.awt.*;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; java.awt.event.ActionEvent;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; java.awt.event.ActionListener;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; java.io.*;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; java.net.MalformedURLException;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; java.net.URL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; java.util.EventObject;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PasswdLevel4&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Applet&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ActionListener&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; URL finalurl;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String infile;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String inuser[];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; totno;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    InputStream countConn;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    BufferedReader countData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    URL inURL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TextField txtlogin;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Label label1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Label label2;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Label label3;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TextField txtpass;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Label lblstatus;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Button ButOk;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Button ButReset;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Label lbltitle;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PasswdLevel4&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        inuser = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; String[&lt;span class=&quot;number&quot;&gt;22&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        totno = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        countConn = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        countData = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        inURL = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        txtlogin = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; TextField();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        label1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Label();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        label2 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Label();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        label3 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Label();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        txtpass = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; TextField();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        lblstatus = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Label();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ButOk = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Button();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ButReset = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Button();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        lbltitle = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Label();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ButOk_ActionPerformed&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ActionEvent actionevent)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; flag = &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;; i &amp;lt;= totno / &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;; i++)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(txtlogin.getText().trim().toUpperCase().intern() == inuser[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; * (i - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) + &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;].trim().toUpperCase().intern() &amp;amp;&amp;amp; txtpass.getText().trim().toUpperCase().intern() == inuser[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; * (i - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) + &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;].trim().toUpperCase().intern())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                lblstatus.setText(&lt;span class=&quot;string&quot;&gt;&quot;Login Success, Loading..&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                flag = &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                String s = inuser[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;].trim().intern();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                String s1 = getParameter(&lt;span class=&quot;string&quot;&gt;&quot;targetframe&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(s1 == &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    s1 = &lt;span class=&quot;string&quot;&gt;&quot;_self&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    finalurl = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; URL(getCodeBase(), s);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt;(MalformedURLException _ex)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    lblstatus.setText(&lt;span class=&quot;string&quot;&gt;&quot;Bad URL&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                getAppletContext().showDocument(finalurl, s1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!flag)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            lblstatus.setText(&lt;span class=&quot;string&quot;&gt;&quot;Invaild Login or Password&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ButReset_ActionPerformed&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ActionEvent actionevent)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        txtlogin.setText(&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        txtpass.setText(&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;actionPerformed&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ActionEvent actionevent)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Object obj = actionevent.getSource();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(obj == ButOk)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ButOk_ActionPerformed(actionevent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(obj == ButReset)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ButReset_ActionPerformed(actionevent);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;destroy&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ButOk.setEnabled(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ButReset.setEnabled(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        txtlogin.setVisible(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        txtpass.setVisible(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;inFile&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; StringBuffer();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            countConn = inURL.openStream();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            countData = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BufferedReader(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; InputStreamReader(countConn));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            String s;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;((s = countData.readLine()) != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(totno &amp;lt; &lt;span class=&quot;number&quot;&gt;21&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    totno = totno + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    inuser[totno] = s;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    s = &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    lblstatus.setText(&lt;span class=&quot;string&quot;&gt;&quot;Cannot Exceed 10 users, Applet fail start!&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    destroy();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt;(IOException ioexception)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            getAppletContext().showStatus(&lt;span class=&quot;string&quot;&gt;&quot;IO Error:&quot;&lt;/span&gt; + ioexception.getMessage());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            countConn.close();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            countData.close();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt;(IOException ioexception1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            getAppletContext().showStatus(&lt;span class=&quot;string&quot;&gt;&quot;IO Error:&quot;&lt;/span&gt; + ioexception1.getMessage());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        setLayout(&lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        setSize(&lt;span class=&quot;number&quot;&gt;361&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;191&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        add(txtlogin);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        txtlogin.setBounds(&lt;span class=&quot;number&quot;&gt;156&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;72&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;132&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;24&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        label1.setText(&lt;span class=&quot;string&quot;&gt;&quot;Please Enter Login Name &amp;amp; Password&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        label1.setAlignment(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        add(label1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        label1.setFont(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Font(&lt;span class=&quot;string&quot;&gt;&quot;Dialog&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        label1.setBounds(&lt;span class=&quot;number&quot;&gt;41&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;36&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;280&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;24&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        label2.setText(&lt;span class=&quot;string&quot;&gt;&quot;Login&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        add(label2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        label2.setFont(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Font(&lt;span class=&quot;string&quot;&gt;&quot;Dialog&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        label2.setBounds(&lt;span class=&quot;number&quot;&gt;75&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;72&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;36&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;24&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        label3.setText(&lt;span class=&quot;string&quot;&gt;&quot;Password&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        add(label3);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        add(txtpass);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        txtpass.setEchoChar(&lt;span class=&quot;string&quot;&gt;&#39;*&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        txtpass.setBounds(&lt;span class=&quot;number&quot;&gt;156&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;108&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;132&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;24&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        lblstatus.setAlignment(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        label3.setFont(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Font(&lt;span class=&quot;string&quot;&gt;&quot;Dialog&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        label3.setBounds(&lt;span class=&quot;number&quot;&gt;75&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;108&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;57&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;21&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        add(lblstatus);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        lblstatus.setFont(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Font(&lt;span class=&quot;string&quot;&gt;&quot;Dialog&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        lblstatus.setBounds(&lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;132&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;344&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;24&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ButOk.setLabel(&lt;span class=&quot;string&quot;&gt;&quot;OK&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        add(ButOk);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ButOk.setFont(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Font(&lt;span class=&quot;string&quot;&gt;&quot;Dialog&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ButOk.setBounds(&lt;span class=&quot;number&quot;&gt;105&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;156&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;59&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ButReset.setLabel(&lt;span class=&quot;string&quot;&gt;&quot;Reset&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        add(ButReset);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ButReset.setFont(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Font(&lt;span class=&quot;string&quot;&gt;&quot;Dialog&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ButReset.setBounds(&lt;span class=&quot;number&quot;&gt;204&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;156&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;59&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        lbltitle.setAlignment(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        add(lbltitle);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        lbltitle.setFont(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Font(&lt;span class=&quot;string&quot;&gt;&quot;Dialog&quot;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        lbltitle.setBounds(&lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;336&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;24&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String s = getParameter(&lt;span class=&quot;string&quot;&gt;&quot;title&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        lbltitle.setText(s);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ButOk.addActionListener(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ButReset.addActionListener(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        infile = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; String(&lt;span class=&quot;string&quot;&gt;&quot;level4&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            inURL = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; URL(getCodeBase(), infile);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt;(MalformedURLException _ex)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            getAppletContext().showStatus(&lt;span class=&quot;string&quot;&gt;&quot;Bad Counter URL:&quot;&lt;/span&gt; + inURL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        inFile();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;为了将该class文件嵌入进去html，我自己又写了一个PasswdLevel.html，代码如下：&lt;br&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;html&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;applet&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;code&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;PasswdLevel4.class&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;500&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;500&lt;/span&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;applet&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;html&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这时可以用如下命令查看该Applet小程序：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;appletviewer PasswdLevel4.html&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;提示无法进行初始化，然后仔细看java源代码，发现程序读进去了一个level4的文件，于是按照URL地址:&lt;a href=&quot;http://try2hack.nl/levels/level4&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://try2hack.nl/levels/level4&lt;/a&gt; 将该文件下载下来。此时的文档结构目录为：&lt;br&gt;&lt;img src=&quot;/images/try2hack/35.png&quot; alt=&quot;35&quot;&gt;&lt;br&gt;此时再用上面的命令查看，则终于显示出来了：&lt;br&gt;&lt;img src=&quot;/images/try2hack/36.png&quot; alt=&quot;36&quot;&gt;&lt;br&gt;这里需要输入的用户名密码就是level4里面的用户名和密码，因为程序要验证，而就是通过这个文件读进去的，文件打开后内容如下：&lt;br&gt;&lt;img src=&quot;/images/try2hack/37.png&quot; alt=&quot;37&quot;&gt;&lt;br&gt;因此输入用户名：appletking，密码：pieceofcake，该关就通过了。&lt;br&gt;&lt;strong&gt;总结：这一关主要考查Java的反编译和Applet程序嵌入网页的机制。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;Level-5&quot;&gt;&lt;a href=&quot;#Level-5&quot; class=&quot;headerlink&quot; title=&quot;Level 5&quot;&gt;&lt;/a&gt;Level 5&lt;/h3&gt;&lt;p&gt;网址：&lt;a href=&quot;http://www.try2hack.nl/levels/level5-fdvbdf.xhtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.try2hack.nl/levels/level5-fdvbdf.xhtml&lt;/a&gt;&lt;br&gt;来到第五关：&lt;br&gt;&lt;img src=&quot;/images/try2hack/14.png&quot; alt=&quot;14&quot;&gt;&lt;br&gt;该关要求下载一个东西，然后输入正确的用户名和密码。&lt;br&gt;下载下来之后，发现是一个exe的可执行文件，然而该可执行文件在win64位机器上面跑不起来，提示不兼容。于是在win32的虚拟机运行该文件，提示缺少VBRUN300.DLL，于是又去网上下载这个dll，安装后再打开该软件，呈现如下界面：&lt;br&gt;&lt;img src=&quot;/images/try2hack/15.png&quot; alt=&quot;15&quot;&gt;&lt;br&gt;尝试输入几个用户名和密码，均提示不正确，因此这绝对是一个软件的破解了，软件逆向之后找到验证的部分就行了。于是奠出我们的神器Ollydbg。Ollydbg逆向的时候却提示这不是一个有效的可执行文件。&lt;br&gt;于是查资料发现这是一个VB3.0程序，比较老，需要用专门的VB3.0反编译工具而不能用OD。于是又得去找专门的VB3.0的反编译工具，在这里我不得不吐槽一下国内软件的下载环境，这是像坨屎一样垃圾，不是有毒就是给你装一堆稀巴烂的软件，真是深恶痛绝！把时间都浪费在这些事情上面，给初学者带来巨大的麻烦！&lt;br&gt;最终下载的是VB3.0 Decompile，下载下来之后又学了半天怎么用，最后把我们的exe文件导入，选择输出地址之后，得到了两个文件。一个文件是main.txt,另一个文件是Level5.bat。&lt;br&gt;显示内容分别如下：&lt;br&gt;main.txt:&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Global Const gc0006 = &lt;span class=&quot;string&quot;&gt;&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.,:;-*+=~|&amp;amp;!_$#@()[]&amp;#123;&amp;#125;&amp;lt;\/&amp;gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Global Const gc000A = &lt;span class=&quot;string&quot;&gt;&quot;http://www.try2hack.nl/levels/level6-ksghvb.xhtml&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Level5.bat:&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;If  edtUsername = Mid(gc0006, &lt;span class=&quot;number&quot;&gt;56&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;28&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;35&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;44&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;13&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;21&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) Then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  If  edtPassword = Mid(gc0006, &lt;span class=&quot;number&quot;&gt;45&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;48&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;25&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;15&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;40&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;25&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;19&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) Then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MsgBox &lt;span class=&quot;string&quot;&gt;&quot;Level 6 can be found at: &quot;&lt;/span&gt; &amp;amp; Left$(gc000A, &lt;span class=&quot;number&quot;&gt;37&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;21&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;29&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc0006, &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;amp; Mid(gc000A, &lt;span class=&quot;number&quot;&gt;44&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;), &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Horray!&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    End&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  End If&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;End If&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;很明显，这相当于把用户名和密码告诉我们了，按照程序照着对应的字符去找就行了，最后输入用户名：Try2Hack，密码：ILoveDodi，得到如下界面就过关了。&lt;br&gt;&lt;img src=&quot;/images/try2hack/16.png&quot; alt=&quot;16&quot;&gt;&lt;br&gt;&lt;strong&gt;总结：这一关主要考查VB3.0程序的反编译。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;Level-6&quot;&gt;&lt;a href=&quot;#Level-6&quot; class=&quot;headerlink&quot; title=&quot;Level 6&quot;&gt;&lt;/a&gt;Level 6&lt;/h3&gt;&lt;p&gt;网址：&lt;a href=&quot;http://www.try2hack.nl/levels/level6-kdsvbd.xhtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.try2hack.nl/levels/level6-kdsvbd.xhtml&lt;/a&gt;&lt;br&gt;来到第六关，这次变成了VB6.0程序：&lt;br&gt;&lt;img src=&quot;/images/try2hack/17.png&quot; alt=&quot;17&quot;&gt;&lt;br&gt;下载下来之后打开，360杀毒软件也真是狠，报告有木马，一定要删除刚下载的文件，最后把所有360程序全部关闭了。才能把程序打开。结果打开程序又出现问题，提示缺少两个组件，分别下载安装MSWINSCK.OCX和RICHTX32.OCX后才总算打开了：&lt;br&gt;&lt;img src=&quot;/images/try2hack/18.png&quot; alt=&quot;18&quot;&gt;&lt;br&gt;可以逆向吗？OD打开后看到的景象真是惨不忍睹：&lt;br&gt;&lt;img src=&quot;/images/try2hack/38.png&quot; alt=&quot;38&quot;&gt;&lt;br&gt;应该是加壳了，如果直接脱壳的话，应该能解出来，但我对这块不熟。&lt;br&gt;观察发现该客户端软件需要连接服务器进行验证，有网络的发包过程，因此可以截取其数据包进行观察。这里存在一个问题就是如果用burpsuit进行截取的话，软件的请求格式由于不是正规的http协议，无法解析。因此考虑用Wireshark，抓包如下：&lt;br&gt;&lt;img src=&quot;/images/try2hack/39.png&quot; alt=&quot;39&quot;&gt;&lt;br&gt;可以看到中间的http协议增加了一个中间层，是加密的数据，提取出来如下所示：&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;(ENCRYPTION TYPE)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;B*C*N**&lt;span class=&quot;title&quot;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;params&quot;&gt;(USERNAME)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;aaabb aaaaa aaaab abbab ababb &lt;span class=&quot;title&quot;&gt;aaaab&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;params&quot;&gt;(PASSWORD)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;aabaa abbaa aaaba baaaa babba abbba baaba abaaa abbab abbaa baaaa aaaaa babaa abaab &lt;span class=&quot;title&quot;&gt;baaab&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;params&quot;&gt;(PAGE)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;babab aabab abaab abbab aabbb aaaba&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;谷歌之后这里采用的是培根加密，具体介绍参见：&lt;a href=&quot;http://h2g2.com/edited_entry/A9837183&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://h2g2.com/edited_entry/A9837183&lt;/a&gt;&lt;br&gt;根据如下密码表对应进行一一解密：&lt;br&gt;&lt;img src=&quot;/images/try2hack/48.png&quot; alt=&quot;48&quot;&gt;&lt;br&gt;最后解密出来的结果为：&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;用户名：dabomb &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;密码：encryptionrawks &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;URL：xfkohc&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;输入之后就通过了：&lt;br&gt;&lt;img src=&quot;/images/try2hack/40.png&quot; alt=&quot;40&quot;&gt;&lt;br&gt;&lt;strong&gt;总结：这一节主要考查软件的脱壳或者从中间抓包截取数据和对一些加解密算法的了解&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;Level-7&quot;&gt;&lt;a href=&quot;#Level-7&quot; class=&quot;headerlink&quot; title=&quot;Level 7&quot;&gt;&lt;/a&gt;Level 7&lt;/h3&gt;&lt;p&gt;网址：&lt;a href=&quot;http://www.try2hack.nl/levels/level7-xfkohc.php&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.try2hack.nl/levels/level7-xfkohc.php&lt;/a&gt;&lt;br&gt;&lt;img src=&quot;/images/try2hack/19.png&quot; alt=&quot;19&quot;&gt;&lt;br&gt;打开之后它要求我们用IE7.66版本的浏览器。可以人为修改请求头进行欺骗。&lt;br&gt;第一步正常请求头应为：&lt;br&gt;&lt;img src=&quot;/images/try2hack/41.png&quot; alt=&quot;41&quot;&gt;&lt;br&gt;修改为IE7.66，如下（注意User-Agent字段）：&lt;br&gt;&lt;img src=&quot;/images/try2hack/42.png&quot; alt=&quot;42&quot;&gt;&lt;br&gt;结果显示：&lt;br&gt;&lt;img src=&quot;/images/try2hack/43.png&quot; alt=&quot;43&quot;&gt;&lt;br&gt;服务器传过来要求操作系统为Linux系统，继续修改，在请求头中增加Linux：&lt;br&gt;&lt;img src=&quot;/images/try2hack/44.png&quot; alt=&quot;44&quot;&gt;&lt;br&gt;反馈如下，服务器对跳转页面还有要求：&lt;br&gt;&lt;img src=&quot;/images/try2hack/45.png&quot; alt=&quot;45&quot;&gt;&lt;br&gt;继续改，增加一个Referer字段，如下：&lt;br&gt;&lt;img src=&quot;/images/try2hack/46.png&quot; alt=&quot;46&quot;&gt;&lt;br&gt;最后得到结果如下：&lt;br&gt;&lt;img src=&quot;/images/try2hack/47.png&quot; alt=&quot;47&quot;&gt;&lt;br&gt;通过了。&lt;br&gt;&lt;strong&gt;总结：该关主要考查对http请求头的构造和理解，其实都是可以伪装的。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;Level-8&quot;&gt;&lt;a href=&quot;#Level-8&quot; class=&quot;headerlink&quot; title=&quot;Level 8&quot;&gt;&lt;/a&gt;Level 8&lt;/h3&gt;&lt;p&gt;网址：&lt;a href=&quot;http://try2hack.nl/levels/level8-balnrg.xhtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://try2hack.nl/levels/level8-balnrg.xhtml&lt;/a&gt;&lt;br&gt;第八关要求输入用户名和密码：&lt;br&gt;&lt;img src=&quot;/images/try2hack/20.png&quot; alt=&quot;20&quot;&gt;&lt;br&gt;查看页面源代码：&lt;br&gt;&lt;img src=&quot;/images/try2hack/21.png&quot; alt=&quot;21&quot;&gt;&lt;br&gt;因此这是一个phf漏洞的利用，具体介绍可参见&lt;a href=&quot;https://pt.wikipedia.org/wiki/Phf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;维基百科&lt;/a&gt;。&lt;br&gt;利用过程为输入如下URL：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://try2hack.nl/cgi-bin/phf?Qalias=%0A/bin/cat%20/etc/passwd&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://try2hack.nl/cgi-bin/phf?Qalias=%0A/bin/cat%20/etc/passwd&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;得到一份如下的文件：&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;root:khXGN7s.ldaJI:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:Charlie &amp;amp;:&lt;span class=&quot;regexp&quot;&gt;/root:/u&lt;/span&gt;sr/local/bin/bash&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;daemon:*:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:Owner &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; many system processes:&lt;span class=&quot;regexp&quot;&gt;/root:/&lt;/span&gt;sbin/nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;operator:*:&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:System Operator:&lt;span class=&quot;regexp&quot;&gt;/:/&lt;/span&gt;sbin/nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bin:*:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:Binaries Commands and Source:&lt;span class=&quot;regexp&quot;&gt;/:/&lt;/span&gt;sbin/nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tty:*:&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;65533&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:Tty Sandbox:&lt;span class=&quot;regexp&quot;&gt;/:/&lt;/span&gt;sbin/nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;kmem:*:&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;65533&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:KMem Sandbox:&lt;span class=&quot;regexp&quot;&gt;/:/&lt;/span&gt;sbin/nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;games:*:&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;13&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:Games pseudo-user:&lt;span class=&quot;regexp&quot;&gt;/usr/g&lt;/span&gt;ames:&lt;span class=&quot;regexp&quot;&gt;/sbin/&lt;/span&gt;nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;news:*:&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:News Subsystem:&lt;span class=&quot;regexp&quot;&gt;/:/&lt;/span&gt;sbin/nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;man:*:&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:Mister Man Pages:&lt;span class=&quot;regexp&quot;&gt;/usr/&lt;/span&gt;share/man:&lt;span class=&quot;regexp&quot;&gt;/sbin/&lt;/span&gt;nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sshd:*:&lt;span class=&quot;number&quot;&gt;22&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;22&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:Secure Shell Daemon:&lt;span class=&quot;regexp&quot;&gt;/var/&lt;/span&gt;empty:&lt;span class=&quot;regexp&quot;&gt;/sbin/&lt;/span&gt;nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;smmsp:*:&lt;span class=&quot;number&quot;&gt;25&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;25&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:Sendmail Submission User:&lt;span class=&quot;regexp&quot;&gt;/var/&lt;/span&gt;spool/clientmqueue:&lt;span class=&quot;regexp&quot;&gt;/sbin/&lt;/span&gt;nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mailnull:*:&lt;span class=&quot;number&quot;&gt;26&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;26&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:Sendmail Default User:&lt;span class=&quot;regexp&quot;&gt;/var/&lt;/span&gt;spool/mqueue:&lt;span class=&quot;regexp&quot;&gt;/sbin/&lt;/span&gt;nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bind:*:&lt;span class=&quot;number&quot;&gt;53&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;53&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:Bind Sandbox:&lt;span class=&quot;regexp&quot;&gt;/:/&lt;/span&gt;sbin/nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;uucp:*:&lt;span class=&quot;number&quot;&gt;66&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;66&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:UUCP pseudo-user:&lt;span class=&quot;regexp&quot;&gt;/var/&lt;/span&gt;spool/uucppublic:&lt;span class=&quot;regexp&quot;&gt;/usr/&lt;/span&gt;libexec/uucp/uucico xten:*:&lt;span class=&quot;number&quot;&gt;67&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;67&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:X&lt;span class=&quot;number&quot;&gt;-10&lt;/span&gt; daemon:&lt;span class=&quot;regexp&quot;&gt;/usr/&lt;/span&gt;local/xten:&lt;span class=&quot;regexp&quot;&gt;/sbin/&lt;/span&gt;nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pop:*:&lt;span class=&quot;number&quot;&gt;68&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:Post Office Owner:&lt;span class=&quot;regexp&quot;&gt;/nonexistent:/&lt;/span&gt;sbin/nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;www:*:&lt;span class=&quot;number&quot;&gt;80&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;80&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:World Wide Web Owner:&lt;span class=&quot;regexp&quot;&gt;/nonexistent:/&lt;/span&gt;sbin/nologin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nobody:*:&lt;span class=&quot;number&quot;&gt;65534&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;65534&lt;/span&gt;::&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:Unprivileged user:&lt;span class=&quot;regexp&quot;&gt;/nonexistent:/&lt;/span&gt;sbin/nologin&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果搞过密码档的话，这些东西就是经过系统加密的网站注册用户资料文档，其中冒号前面是用户名，用户名是不加密的，冒号后面就是该用户的密码，不过已经被系统加密。绝大部分Unix系统都使用DES加密方式，经过处理的密码应该是13位。注意看第一条记录，这样就只需解密用户root对应的密码“khXGN7s.ldaJI”就行了。&lt;br&gt;用什么解密呢？网上大部分的在线DES加密解密网站都是需要我们自己输入密钥的，因此这些网站对我们破解该密码一点卵用都没有，知道密钥了我还要你破解个毛线啊！后来我找了半天，终于找到了这个软件：&lt;a href=&quot;http://www.openwall.com/john/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;John the Ripper password cracker&lt;/a&gt;，具体用法请&lt;a href=&quot;http://blog.sina.com.cn/s/blog_8cb5c0e501015w0k.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;参考此文&lt;/a&gt;。&lt;br&gt;最后我用的是穷举模式进行的破解，得到结果如下：&lt;br&gt;&lt;img src=&quot;/images/try2hack/22.png&quot; alt=&quot;22&quot;&gt;&lt;br&gt;可以看到用户名是：root，密码是：arse，顺利通过。&lt;br&gt;&lt;strong&gt;总结：该关主要考查对pfh漏洞的利用以及EDS密码的破解。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;Level-9&quot;&gt;&lt;a href=&quot;#Level-9&quot; class=&quot;headerlink&quot; title=&quot;Level 9&quot;&gt;&lt;/a&gt;Level 9&lt;/h3&gt;&lt;p&gt;网址：&lt;a href=&quot;http://try2hack.nl/levels/level9-gnapei.xhtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://try2hack.nl/levels/level9-gnapei.xhtml&lt;/a&gt;&lt;br&gt;这是第九关：&lt;br&gt;&lt;img src=&quot;/images/try2hack/23.png&quot; alt=&quot;23&quot;&gt;&lt;br&gt;同样是输入用户名和密码。&lt;br&gt;用burpsuit拦截后分析，观察到其请求头如下：&lt;br&gt;&lt;img src=&quot;/images/try2hack/24.png&quot; alt=&quot;24&quot;&gt;&lt;br&gt;观察cookie，会发现其很有特色，分别是用户名、密码和是否被验证的标志位。&lt;br&gt;按照会话管理的常理来说，一般会话的cookie检验通过了的话，是不需要检验浏览器提交的用户名和密码了的，于是我第一次是在cookie中将请求是否验证标志位由no改为了yes，提交之后，显示失败。可知服务器还是需要用户名和密码的，这里的用户名和密码输入可以和cookie一样，并且把验证标志位改为yes，再次尝试：&lt;br&gt;&lt;img src=&quot;/images/try2hack/25.png&quot; alt=&quot;25&quot;&gt;&lt;br&gt;提交之后就顺利通过了。&lt;br&gt;&lt;strong&gt;总结：这关考查我们的cookie绕过。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;Level-10&quot;&gt;&lt;a href=&quot;#Level-10&quot; class=&quot;headerlink&quot; title=&quot;Level 10&quot;&gt;&lt;/a&gt;Level 10&lt;/h3&gt;&lt;p&gt;这一关开始页面如下：&lt;br&gt;&lt;img src=&quot;/images/try2hack/26.png&quot; alt=&quot;26&quot;&gt;&lt;br&gt;要求我们下载一个IRC的客户端软件，然后登陆irc.mediamonks.net服务器的#try2hack.level10房间。&lt;br&gt;这里我搞了很久，登陆进去之后如下图所示：&lt;br&gt;&lt;img src=&quot;/images/try2hack/27.png&quot; alt=&quot;27&quot;&gt;&lt;br&gt;这么多0和1构成的字符串，是二进制的，首先想到的二进制解密，但非常蛋疼的是，这个IRC聊天软件居然不能复制，只能先保存成图片，然后进行文字识别。找了半天，终于找到&lt;a href=&quot;http://www.onlineocr.net/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这个网站&lt;/a&gt;提供在线的文字识别，然后又到&lt;a href=&quot;http://www.nickciske.com/tools/binary.php&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这个网站&lt;/a&gt;进行二进制文件的解密。解密出来的字符串为：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Nice job. Now type ‘/msg TRY2HACK showbug’ to see the bug&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;输入之后，给出的回复如下：&lt;br&gt;&lt;img src=&quot;/images/try2hack/28.png&quot; alt=&quot;28&quot;&gt;&lt;/p&gt;
&lt;p&gt;这看起来像一段脚本，感觉又被加密了的，这是用&lt;a href=&quot;http://baike.baidu.com/link?url=23yqs5jB0i4dwPhnIBYzF-Ud3_vNCizdFZ0-Qet11fK0zfP28Xc_A2g0rkhtyI4w9kXTuw0bBz0bVVZAMuqXWK&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ROT13&lt;/a&gt;进行加密的，ROT13加密常被应用于聊天中或网路论坛用作隐藏八卦、妙句、脏话等。&lt;br&gt;在&lt;a href=&quot;http://rot13.de/index.php&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这个网站&lt;/a&gt;中将这段文字在线解密得到如下结果：&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;bind ctcr - PING ctcr:pingreply&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;proc ctcr:pingreply &amp;#123;nick uhost hand dest key arg&amp;#125; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;set&lt;/span&gt; dur [expr [unixtime] - $arg]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	putserv &lt;span class=&quot;string&quot;&gt;&quot;NOTICE $nick :Your ping reply took $dur seconds&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这应该是一个活动主机检测的脚本。然后后面我也不知道该怎么做了，国外有人给出了&lt;a href=&quot;https://github.com/dsolstad/walkthrough-try2hack.nl/blob/master/level10.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;解决方案&lt;/a&gt;，但我没有看懂。如果有人弄懂了，欢迎&lt;a href=&quot;http://qimingyu.github.io/resumeofChinese/&quot;&gt;联系我&lt;/a&gt;。&lt;/p&gt;
&lt;h3 id=&quot;Level-11&quot;&gt;&lt;a href=&quot;#Level-11&quot; class=&quot;headerlink&quot; title=&quot;Level 11&quot;&gt;&lt;/a&gt;Level 11&lt;/h3&gt;&lt;p&gt;网址：&lt;a href=&quot;http://www.try2hack.nl/levels/level11-vmituh.xhtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.try2hack.nl/levels/level11-vmituh.xhtml&lt;/a&gt;&lt;br&gt;第十一关开始的页面如下：&lt;br&gt;&lt;img src=&quot;/images/try2hack/29.png&quot; alt=&quot;29&quot;&gt;&lt;br&gt;上面的字符串和数字均是随机生成的&lt;br&gt;它的要求就是在5秒内输入指定位数的字母对应的ASCII码的十进制值的乘积的前5位数字。&lt;br&gt;首先想到的是修改response，然后修改页面属性。使其把时间延长至无限，再手工算出来，填进去，这是一个解决方案。另一个解决方案是写一段脚本，自动计算后填进去。具体代码后面再给出。&lt;br&gt;&lt;strong&gt;总结：这部分考查我们写一段小脚本的能力。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;Level-12&quot;&gt;&lt;a href=&quot;#Level-12&quot; class=&quot;headerlink&quot; title=&quot;Level 12&quot;&gt;&lt;/a&gt;Level 12&lt;/h3&gt;&lt;p&gt;网址：&lt;a href=&quot;http://www.try2hack.nl/levels/level12-kvdsju.xhtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.try2hack.nl/levels/level12-kvdsju.xhtml&lt;/a&gt;&lt;br&gt;显示页面为：&lt;br&gt;&lt;img src=&quot;/images/try2hack/30.png&quot; alt=&quot;30&quot;&gt;&lt;br&gt;下载之后发现是一个以.pyc为后缀名的文件。pyc是python的字节码文件，因此需要反编译查看源码，在&lt;a href=&quot;http://tool.lu/pyc/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这个网站&lt;/a&gt;可以进行python的在线反编译。&lt;br&gt;反编译后得到如下代码：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; md5 &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; new&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Enter username:&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;username = raw_input()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Enter password:&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;password = raw_input()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    x = chr(int(password[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]) / &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; - &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    x += chr((int(password[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]) / &lt;span class=&quot;number&quot;&gt;12&lt;/span&gt; + &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;) * &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    x += chr((int(password[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]) - &lt;span class=&quot;number&quot;&gt;700&lt;/span&gt;) + &lt;span class=&quot;number&quot;&gt;173&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    x += chr((int(password[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]) - &lt;span class=&quot;number&quot;&gt;148&lt;/span&gt;) / &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt; - &lt;span class=&quot;number&quot;&gt;21&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    x += chr((int(password[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]) - &lt;span class=&quot;number&quot;&gt;327&lt;/span&gt;) / &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; - &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    x += chr(int(password[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]) - &lt;span class=&quot;number&quot;&gt;534&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    x += chr(((int(password[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]) + &lt;span class=&quot;number&quot;&gt;52&lt;/span&gt;) / &lt;span class=&quot;number&quot;&gt;70&lt;/span&gt;) * &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    x += chr(int(password[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]) ** &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; - &lt;span class=&quot;number&quot;&gt;640&lt;/span&gt; * int(password[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]) - &lt;span class=&quot;number&quot;&gt;5083&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    x += chr(int(password[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]) * &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt; - &lt;span class=&quot;number&quot;&gt;3126&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;except&lt;/span&gt; ValueError:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;pass&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; new(username).hexdigest() == &lt;span class=&quot;string&quot;&gt;&#39;3e3a378c63aa1&#39;&lt;/span&gt; + x[&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;] + &lt;span class=&quot;string&quot;&gt;&#39;55e3e9&#39;&lt;/span&gt; + x[&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;] + &lt;span class=&quot;string&quot;&gt;&#39;e9d2bdcd6a1&#39;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; password[&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;] == x:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Well done. Enter the valid username and password on the form online.&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Wrong username and/or password&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;except&lt;/span&gt; NameError:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;Wrong username and/or password&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;由于Python版本不一样，以上代码稍加修改后就能正常运行了。&lt;br&gt;MD5是消息摘要算法，提供消息的完整性保护。这段代码的意思是密码自生成并且自检验，只要符合算法规则的用户名和密码都是合理的。&lt;br&gt;&lt;strong&gt;总结：这部分考查Python反编译和算法。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;Level-13&quot;&gt;&lt;a href=&quot;#Level-13&quot; class=&quot;headerlink&quot; title=&quot;Level 13&quot;&gt;&lt;/a&gt;Level 13&lt;/h3&gt;&lt;p&gt;网址：&lt;a href=&quot;http://www.try2hack.nl/levels/level13-olwehfdow.xhtml&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.try2hack.nl/levels/level13-olwehfdow.xhtml&lt;/a&gt;&lt;br&gt;终于来到最后一关了，显示页面如下：&lt;br&gt;&lt;img src=&quot;/images/try2hack/31.png&quot; alt=&quot;31&quot;&gt;&lt;br&gt;显示需要下载文件，这个文件比较大，有60多兆。&lt;br&gt;Sleuth Kit是一个用来分析磁盘映像和恢复文件的开源取证工具。&lt;br&gt;这是Linux的一个文件系统，我们需要挂载该文件系统。&lt;br&gt;最后得到密码为：f1ff950850ac2f1f51fa82d839f0bd1b&lt;br&gt;然后出现如下页面：&lt;br&gt;&lt;img src=&quot;/images/try2hack/32.png&quot; alt=&quot;32&quot;&gt;&lt;br&gt;已经全部通关了。&lt;br&gt;&lt;strong&gt;总结：这部分考查对Linux系统的了解。&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;&gt;&lt;/a&gt;总结&lt;/h2&gt;&lt;p&gt;Web攻击学无止境，关键在于把基本知识掌握之后，要熟悉很多常见的漏洞及利用方式，然后再加以创造性的综合利用，渗透工程师是一门非常需要积累和经验的工作。而做一名安全构架师，则更是任重而道远。这是需要花时间和精力去认真修炼打磨的。积累自己的势能。&lt;br&gt;这个try2hack网站太老了，很多技术都已经过时，不过用来训练思维还是不错的。&lt;br&gt;任何语言都是可以反编译的。还需要提高自己逆向的能力以及加强对底层的了解。&lt;br&gt;基础还不够，必须要精通一门语言才行，例如第十一关，写一段小代码都要写半天。&lt;br&gt;最后，Level10-13还有待修改完善，以及原理还有待弄懂。未完，待续。  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/05/12/try2hack通关教程/&quot;&gt;http://qimingyu.github.io/2016/05/12/try2hack通关教程/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;初衷&quot;&gt;&lt;a href=&quot;#初衷&quot; class=&quot;headerlink&quot; title=&quot;初衷&quot;&gt;&lt;/a&gt;初衷&lt;/h2&gt;&lt;p&gt;既然学完了WebGoat系列教程，下面来综合实战演练一下，同时也是检测一下自己的学习成果如何。&lt;br&gt;找了这样的一个网站，&lt;a href=&quot;http://www.try2hack.nl/&quot;&gt;try2hack&lt;/a&gt;，这是一个专门用来做网络攻击练习的网站，虽然比较老了，但用来做练习还是可以的。该网站一共有13道关卡，难度是逐步递增的，下面我们逐一开始挑战。&lt;br&gt;
    
    </summary>
    
      <category term="应用安全" scheme="http://qimingyu.github.io/categories/%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络攻击" scheme="http://qimingyu.github.io/tags/%E7%BD%91%E7%BB%9C%E6%94%BB%E5%87%BB/"/>
    
      <category term="try2hack" scheme="http://qimingyu.github.io/tags/try2hack/"/>
    
  </entry>
  
  <entry>
    <title>Webgoat之Report Card（完结篇）</title>
    <link href="http://qimingyu.github.io/2016/05/10/Webgoat%E4%B9%8BReport_Card%EF%BC%88%E5%AE%8C%E7%BB%93%E7%AF%87%EF%BC%89/"/>
    <id>http://qimingyu.github.io/2016/05/10/Webgoat之Report_Card（完结篇）/</id>
    <published>2016-05-10T03:36:59.000Z</published>
    <updated>2016-05-10T05:01:45.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;&gt;&lt;/a&gt;总结&lt;/h2&gt;&lt;p&gt;大约历时一个月左右，系统学完了WebGoat5.2标准版的所有教程。虽然有些东西学的还是比较浅显，但还是加深了很多地方的理解。&lt;br&gt;人从一无所有出生，再到一无所有的离开，区区一辈子，80载，人世走一遭，总得留下些什么。因此一定要做一个有梦想的人，特别是在年轻的时候，在面临很多选择的时候，一定要坚持自己的梦想，不能有一丝一毫的妥协。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;学的越多，往往真有一种学无止境的感觉，学习是为了产出，学习是为了指导实践，学习是为了创造价值。因此，学习过程应该和产出过程相结合，构成良性循环。而世上知识千千万万，一个人要有所作为，则只能专于一点，我给自己定位于信息安全行业，希望能为中国的信息安全行业贡献自己的一份力量。&lt;br&gt;曾经在一篇博客里面看到这样一句话：做正确的事，然后等着被开除。当时我就为之一震，而如今我更深切的体会到说这句话更是需要勇气的，在公司往往会受迫于很多琐事，而无法专注于你希望做的事。这往往是个人理想与社会现实的偏差，这样的偏差并不可怕，也很正常。而面对这样的偏差时，我们一方面要积极修正自己的方向，因为这是来自于外界的反馈，另一方面，要有自己的独到的个性与不可替代性，这是自身价值的体现。&lt;br&gt;要让自己变得厚重、深沉而有魅力，应该永远关注自身势能的提高。学习信安十年，然后在行业内深深积累十年，然后再创业十年，这是我的大方向。深刻的剖析自身，要让自己变得透明，要敢于面对最真实的自己。无畏向前。&lt;/p&gt;
&lt;h2 id=&quot;成果&quot;&gt;&lt;a href=&quot;#成果&quot; class=&quot;headerlink&quot; title=&quot;成果&quot;&gt;&lt;/a&gt;成果&lt;/h2&gt;&lt;p&gt;如下是WebGoat课程的报告清单，也是我的学习成果，其中没有通过的是因为需要在开发版上才能完成。&lt;br&gt;&lt;img src=&quot;/images/webgoat_report_card/1.png&quot; alt=&quot;1&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/webgoat_report_card/2.png&quot; alt=&quot;2&quot;&gt;&lt;br&gt;&lt;img src=&quot;/images/webgoat_report_card/3.png&quot; alt=&quot;3&quot;&gt;  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/05/10/Webgoat之Report_Card（完结篇）/&quot;&gt;http://qimingyu.github.io/2016/05/10/Webgoat之Report_Card（完结篇）/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;&gt;&lt;/a&gt;总结&lt;/h2&gt;&lt;p&gt;大约历时一个月左右，系统学完了WebGoat5.2标准版的所有教程。虽然有些东西学的还是比较浅显，但还是加深了很多地方的理解。&lt;br&gt;人从一无所有出生，再到一无所有的离开，区区一辈子，80载，人世走一遭，总得留下些什么。因此一定要做一个有梦想的人，特别是在年轻的时候，在面临很多选择的时候，一定要坚持自己的梦想，不能有一丝一毫的妥协。
    
    </summary>
    
      <category term="安全感悟" scheme="http://qimingyu.github.io/categories/%E5%AE%89%E5%85%A8%E6%84%9F%E6%82%9F/"/>
    
    
      <category term="网络渗透" scheme="http://qimingyu.github.io/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
      <category term="WebGoat" scheme="http://qimingyu.github.io/tags/WebGoat/"/>
    
      <category term="学习成果" scheme="http://qimingyu.github.io/tags/%E5%AD%A6%E4%B9%A0%E6%88%90%E6%9E%9C/"/>
    
  </entry>
  
  <entry>
    <title>Webgoat之Injection Flaws</title>
    <link href="http://qimingyu.github.io/2016/05/06/Webgoat%E4%B9%8BInjection_Flaws/"/>
    <id>http://qimingyu.github.io/2016/05/06/Webgoat之Injection_Flaws/</id>
    <published>2016-05-06T06:32:01.000Z</published>
    <updated>2016-05-09T09:27:09.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;Command-Injection&quot;&gt;&lt;a href=&quot;#Command-Injection&quot; class=&quot;headerlink&quot; title=&quot;Command Injection&quot;&gt;&lt;/a&gt;Command Injection&lt;/h2&gt;&lt;p&gt;这一节讲的是命令注入攻击。该攻击对任何一个以参数驱动的站点来说都是一个严重威胁。如下图所示：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/1.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;该页面就是一个选择所需查看的文档，然后下方显示文档内容的页面。其存在的漏洞就是后台可以执行用户输入的命令，当我们拦截之后，修改参数如下：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/2.png&quot; alt=&quot;2&quot;&gt;&lt;br&gt;可以看到把我们服务器所开端口情况全部显示出来了：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/3.png&quot; alt=&quot;3&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Blind-SQL-Injection&quot;&gt;&lt;a href=&quot;#Blind-SQL-Injection&quot; class=&quot;headerlink&quot; title=&quot;Blind SQL Injection&quot;&gt;&lt;/a&gt;Blind SQL Injection&lt;/h2&gt;&lt;p&gt;这一节主要讲盲注入，某些SQL注入是没有明确返回信息的，只能通过条件的“真”和“假”进行判断。攻击者必须充分利用查询语句，构造子查询语句。&lt;br&gt;如下图：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/4.png&quot; alt=&quot;4&quot;&gt;&lt;br&gt;这个输入框输入不同的数字他会给不同的反应。它会提示你Account Number是正确的还是错误的。&lt;br&gt;输入如下代码：&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;101 and ( ascii( substr(&lt;span class=&quot;keyword&quot;&gt;select&lt;/span&gt; first_name &lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;user_data&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; userid=&lt;span class=&quot;number&quot;&gt;15613&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) ) &amp;lt; &lt;span class=&quot;number&quot;&gt;77&lt;/span&gt; )&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;从user_data数据库表中把userid字段等于15613的名字找出来，然后求其字符子串，从第一个字符开始截取，截取一个字符长度，这样得到的是名字的一个字母，然后求其ascii值，与77比较，整条语句判断真假。&lt;br&gt;就这样一个个试，可以得到第一个字母是J，第二个字母是o,最后得到Joesph输入，返回正确。&lt;/p&gt;
&lt;h2 id=&quot;Numeric-SQL-Injection&quot;&gt;&lt;a href=&quot;#Numeric-SQL-Injection&quot; class=&quot;headerlink&quot; title=&quot;Numeric SQL Injection&quot;&gt;&lt;/a&gt;Numeric SQL Injection&lt;/h2&gt;&lt;p&gt;这节讲数字型注入攻击，如下图这是一个选择城市，然后出来相应天气预报的页面：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/6.png&quot; alt=&quot;6&quot;&gt;&lt;br&gt;通过截取数据分析发现，所提交的是城市的数字代码，我们把state字段改为如下即可以了：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/7.png&quot; alt=&quot;7&quot;&gt;&lt;br&gt;最后攻击成功：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/5.png&quot; alt=&quot;5&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Log-Spoofing&quot;&gt;&lt;a href=&quot;#Log-Spoofing&quot; class=&quot;headerlink&quot; title=&quot;Log Spoofing&quot;&gt;&lt;/a&gt;Log Spoofing&lt;/h2&gt;&lt;p&gt;这节讲登陆欺骗，如图所示，这是一个登陆的页面，下面灰色部分是后台日志：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/8.png&quot; alt=&quot;8&quot;&gt;&lt;br&gt;现在是要求欺骗后台日志，也就是说一个人明明没有登陆进去，但它要在后台日志记录中显示登陆进去了。&lt;br&gt;因此可以插入如下内容：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Smith%0d%0aLogin Succeeded for username: admin&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;最后日志上面会显示成这样：&lt;br&gt;&lt;img src=&quot;/images/webgoat_web_services/9.png&quot; alt=&quot;9&quot;&gt;&lt;br&gt;这主要是说用户注入内容到后台日志中了。&lt;br&gt;而当输入如下内容时：&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;admin &amp;lt;script&amp;gt;alert(&lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.cookie)&amp;lt;&lt;span class=&quot;regexp&quot;&gt;/script&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;页面会显示如下：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/10.png&quot; alt=&quot;10&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;XPATH-Injection&quot;&gt;&lt;a href=&quot;#XPATH-Injection&quot; class=&quot;headerlink&quot; title=&quot;XPATH Injection&quot;&gt;&lt;/a&gt;XPATH Injection&lt;/h2&gt;&lt;p&gt;如下图所示，下面页面是输入账户名和密码查询工资的页面：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/11.png&quot; alt=&quot;11&quot;&gt;&lt;br&gt;我们的目标是看到其他员工的工资。XPATH 注入类似于SQL注入。通过未验证的输入创建一个XPATH 查询。&lt;br&gt;一般的XPATH查询，其页面代码如下：&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt; dir = s.getContext().getRealPath(&lt;span class=&quot;string&quot;&gt;&quot;/lessons/XPATHInjection/EmployeesData.xml&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;File d = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; File(dir);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;XPathFactory factory = XPathFactory.newInstance();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;XPath xPath = factory.newXPath();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;InputSource inputSource = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; InputSource(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; FileInputStream(d));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt; expression = &lt;span class=&quot;string&quot;&gt;&quot;/employees/employee[loginID/text()=&#39;&quot;&lt;/span&gt; + username + &lt;span class=&quot;string&quot;&gt;&quot;&#39; and passwd/text()=&#39;&quot;&lt;/span&gt; + password + &lt;span class=&quot;string&quot;&gt;&quot;&#39;]&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nodes = (NodeList) xPath.evaluate(expression, inputSource, XPathConstants.NODESET);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;当我们在浏览器中输入如下内容时：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Smith’ or 1=1 or ‘a’=’a&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;则服务器获取的数据为：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;expression = “/employees/employee[loginID/text()=’Smith’ or 1=1 or ‘a’=’a’ and passwd/text()=’password’]”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;服务器解析后的结果为：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;expression = “/employees/employee[ ( loginID/text()=’Smith’ or 1=1 ) OR ( ‘a’=’a’ and passwd/text()=’password’ ) ]”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;浏览器显示页面为：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/12.png&quot; alt=&quot;12&quot;&gt;&lt;br&gt;攻击成功。&lt;/p&gt;
&lt;h2 id=&quot;SQL-Injection&quot;&gt;&lt;a href=&quot;#SQL-Injection&quot; class=&quot;headerlink&quot; title=&quot;SQL Injection&quot;&gt;&lt;/a&gt;SQL Injection&lt;/h2&gt;&lt;h3 id=&quot;Stage-1&quot;&gt;&lt;a href=&quot;#Stage-1&quot; class=&quot;headerlink&quot; title=&quot;Stage 1&quot;&gt;&lt;/a&gt;Stage 1&lt;/h3&gt;&lt;p&gt;第一步是字符串注入，要求以Neville的用户名，密码不知道的情况下登陆：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/16.png&quot; alt=&quot;16&quot;&gt;&lt;br&gt;因此需要拦截之后修改（一定要拦截后修改，因为直接在浏览器输入会有转义）：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/17.png&quot; alt=&quot;17&quot;&gt;&lt;br&gt;这样就可以顺利进入了。&lt;/p&gt;
&lt;h3 id=&quot;Stage-2&quot;&gt;&lt;a href=&quot;#Stage-2&quot; class=&quot;headerlink&quot; title=&quot;Stage 2&quot;&gt;&lt;/a&gt;Stage 2&lt;/h3&gt;&lt;p&gt;这部分需要我们使用参数化查询阻止SQL注入。但是这部分内容只有在开发版上才能完成，我用的是标准版。&lt;br&gt;应该修改webgoat/lessons/SQLInjection/ViewProfile.java文件中的getEmployeeProfile方法，代码如下：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;String query = &lt;span class=&quot;string&quot;&gt;&quot;SELECT employee.* &quot;&lt;/span&gt;+ &lt;span class=&quot;string&quot;&gt;&quot;FROM employee,ownership WHERE employee.userid = ownership.employee_id and &quot;&lt;/span&gt;+ &lt;span class=&quot;string&quot;&gt;&quot;ownership.employer_id = ? and ownership.employee_id = ?&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	Connection connection = WebSession.getConnections(s);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	PreparedStatement statement = connection.prepareStatement(query,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	statement.setString(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, userId);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	statement.setString(&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, subjectUserId);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	ResultSet answer_results = statement.executeQuery();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;Stage-3&quot;&gt;&lt;a href=&quot;#Stage-3&quot; class=&quot;headerlink&quot; title=&quot;Stage 3&quot;&gt;&lt;/a&gt;Stage 3&lt;/h3&gt;&lt;p&gt;这一节需要我们以普通用户的身份看到老板的简介：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/20.png&quot; alt=&quot;20&quot;&gt;&lt;br&gt;先以普通用户Larry的身份登陆进去：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/21.png&quot; alt=&quot;21&quot;&gt;&lt;br&gt;再点击ViewProfile进行抓包，后修改：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/19.png&quot; alt=&quot;19&quot;&gt;&lt;br&gt;最后提交看到老板简介：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/18.png&quot; alt=&quot;18&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;Stage-4&quot;&gt;&lt;a href=&quot;#Stage-4&quot; class=&quot;headerlink&quot; title=&quot;Stage 4&quot;&gt;&lt;/a&gt;Stage 4&lt;/h3&gt;&lt;p&gt;这部分需要通过参数化查询防止这类攻击，与Stage 2的方法差不多。&lt;/p&gt;
&lt;h2 id=&quot;String-SQL-Injection&quot;&gt;&lt;a href=&quot;#String-SQL-Injection&quot; class=&quot;headerlink&quot; title=&quot;String SQL Injection&quot;&gt;&lt;/a&gt;String SQL Injection&lt;/h2&gt;&lt;p&gt;如下图所示是一个输入姓名查银行卡的页面：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/13.png&quot; alt=&quot;13&quot;&gt;&lt;br&gt;要求我们把所有人的银行卡信息都显示出来。输入如下代码：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Smith’ or 1=1 –&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;成功了：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/14.png&quot; alt=&quot;14&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Database-Backdoors&quot;&gt;&lt;a href=&quot;#Database-Backdoors&quot; class=&quot;headerlink&quot; title=&quot;Database Backdoors&quot;&gt;&lt;/a&gt;Database Backdoors&lt;/h2&gt;&lt;p&gt;这一节讲的数据库后门攻击。数据库通常作为一个Web应用程序的后端来使用。此外，它也用来作为存储的媒介。它也可以被用来作为存储恶意活动的地方，如触发器。触发器是在数据库管理系统上调用另一个数据库操作，如insert, select, update or delete。举个例子：攻击者可以创建一个触发器，该触发器在创建新用户时，将每个新用户的Email地址设置为攻击者的地址。&lt;br&gt;正常情况下在如下页面输入工号，进行查询一些信息：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/15.png&quot; alt=&quot;15&quot;&gt;&lt;br&gt;后来发现客户端输入的查询语句没有在服务器端进行验证。&lt;br&gt;当我们输入如下代码时：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;101; update employee set salary=10000&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;服务器为我们执行了更新。&lt;br&gt;因此我们可以创建如下触发器：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;101;CREATE TRIGGER myBackDoor BEFORE INSERT ON employee FOR EACH ROW BEGIN UPDATE employee SET email=’john@hackme.com’ WHERE userid = NEW.userid&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;使没创建一个新用户的时候，自动为其填充为我们所希望的邮箱。&lt;/p&gt;
&lt;h2 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h2&gt;&lt;p&gt;SQL注入需要对数据库熟悉，并且对后台代码了解，内容还是比较多的。  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/05/06/Webgoat之Injection_Flaws/&quot;&gt;http://qimingyu.github.io/2016/05/06/Webgoat之Injection_Flaws/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Command-Injection&quot;&gt;&lt;a href=&quot;#Command-Injection&quot; class=&quot;headerlink&quot; title=&quot;Command Injection&quot;&gt;&lt;/a&gt;Command Injection&lt;/h2&gt;&lt;p&gt;这一节讲的是命令注入攻击。该攻击对任何一个以参数驱动的站点来说都是一个严重威胁。如下图所示：&lt;br&gt;&lt;img src=&quot;/images/webgoat_injection_flaws/1.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="应用安全" scheme="http://qimingyu.github.io/categories/%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络渗透" scheme="http://qimingyu.github.io/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
      <category term="WebGoat" scheme="http://qimingyu.github.io/tags/WebGoat/"/>
    
      <category term="注入攻击" scheme="http://qimingyu.github.io/tags/%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/"/>
    
  </entry>
  
  <entry>
    <title>Webgoat之Web Services</title>
    <link href="http://qimingyu.github.io/2016/05/05/Webgoat%E4%B9%8BWeb_Services/"/>
    <id>http://qimingyu.github.io/2016/05/05/Webgoat之Web_Services/</id>
    <published>2016-05-05T07:51:40.000Z</published>
    <updated>2016-05-06T06:20:57.000Z</updated>
    
    <content type="html">&lt;p&gt;什么是Web Service？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Web Service就是一种基于Web 的服务，但这个服务需要供求双方按照规定去做才能实现的服务。&lt;/li&gt;
&lt;li&gt;Web Service就是一个应用程序，它向外界暴露出一个能够通过Web进行调用的API。这就是说，你能够用编程的方法通过Web来调用这个应用程序。我们把能调用这个Web service 的应用程序叫做客户端程序。&lt;/li&gt;
&lt;li&gt;Web Service希望实现不同的系统之间能够用“软件-软件对话”的方式相互调用，打破了软件应用、网站和各种设备之间的格格不入的状态，实现“基于Web无缝集成”的目标。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;详细内容见&lt;a href=&quot;http://blog.csdn.net/weiguolee/article/details/6881411&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;，它有三要素：WSDL用来描述服务；UDDI用来注册和查找服务；SOAP用来在消费者和服务提供者之间传送消息。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Create-a-SOAP-Request&quot;&gt;&lt;a href=&quot;#Create-a-SOAP-Request&quot; class=&quot;headerlink&quot; title=&quot;Create a SOAP Request&quot;&gt;&lt;/a&gt;Create a SOAP Request&lt;/h2&gt;&lt;p&gt;第一部分要求我们创建一个SOAP的请求。&lt;br&gt;以下显示的是WSDL文档：&lt;br&gt;&lt;img src=&quot;/images/webgoat_web_services/1.png&quot; alt=&quot;1&quot;&gt;&lt;br&gt;我们展开portType：&lt;br&gt;&lt;img src=&quot;/images/webgoat_web_services/2.png&quot; alt=&quot;2&quot;&gt;&lt;br&gt;发现有四种操作。因此WSDL中定义了4种操作。&lt;br&gt;第二步要填写方法getFirstNameRequest方法中参数的类型&lt;br&gt;&lt;img src=&quot;/images/webgoat_web_services/12.png&quot; alt=&quot;12&quot;&gt;&lt;br&gt;由上图可以看出是int类型的。&lt;br&gt;然后接着要发送一个SOAP的请求，点击按钮“Press to generate an HTTP request”，然后用burp进行拦截，拦截之后修改请求符合SOAP标准，如下：&lt;br&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;POST https://localhost:8443/WebGoat/services/SoapRequest HTTP/1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Host: localhost:8443&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:45.0) Gecko/20100101 Firefox/45.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Accept: textml,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Accept-Encoding: gzip, deflate, br&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Referer: https://localhost:8443/WebGoat/attack?Screen=32&amp;amp;menu=1800&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Cookie: JSESSIONID=B0E2BCDE68B32C2894064DF30A545EAA&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Authorization: Basic Z3Vlc3Q6Z3Vlc3Q=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Connection: close&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Content-Type: text/xml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SOAPAction:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Content-Length: 445&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;SOAP-ENV:Envelope&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;xmlns:SOAP-ENV&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;xmlns:xsd&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;xmlns:xsi&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;SOAP-ENV:Body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;ns1:getFirstName&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;SOAP-ENV:encodingStyle&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;xmlns:ns1&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://lessons&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;xsi:type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;xsd:int&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;101&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;id&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;ns1:getFirstName&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;SOAP-ENV:Body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;SOAP-ENV:Envelope&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;注意以上代码的Host，Post，Content-Type，SOAPAction字段。&lt;/p&gt;
&lt;p&gt;此时服务器会有一个响应：&lt;br&gt;&lt;img src=&quot;/images/webgoat_web_services/10.png&quot; alt=&quot;10&quot;&gt;&lt;br&gt;传回来的值为：Joe&lt;br&gt;此时再将xml中的函数getFirstName两处改为getLastName，再发送一次请求，服务器返回：Snow&lt;br&gt;这关就过了。&lt;/p&gt;
&lt;h2 id=&quot;WSDL-Scanning&quot;&gt;&lt;a href=&quot;#WSDL-Scanning&quot; class=&quot;headerlink&quot; title=&quot;WSDL Scanning&quot;&gt;&lt;/a&gt;WSDL Scanning&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/images/webgoat_web_services/3.png&quot; alt=&quot;3&quot;&gt;&lt;br&gt;做这个实验的时候，我也是醉了，因为这样点击的时候，下面的SNOW一直出不来，其他函数也出不来，搞不清楚是什么问题。后来发现我用的https，然后改为http后就好了。在网络应用中，可以在配置文件里面要求强制转换为https，也可以同时保留http和https，这些的前提是服务器一定配了https。&lt;br&gt;这部分课程是要我们用到所有WSDL中定义的API操作，并且有返回值。我们知道WSDL中实际上有四种操作，而这里只列出了三种，我们可以查看WSDL文档后，将其修改为我们需要的操作。如图所示，把请求更改为这样：&lt;br&gt;&lt;img src=&quot;/images/webgoat_web_services/4.png&quot; alt=&quot;4&quot;&gt;&lt;br&gt;最后出现结果为如下：&lt;br&gt;&lt;img src=&quot;/images/webgoat_web_services/5.png&quot; alt=&quot;5&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Web-Service-SAX-Injection&quot;&gt;&lt;a href=&quot;#Web-Service-SAX-Injection&quot; class=&quot;headerlink&quot; title=&quot;Web Service SAX Injection&quot;&gt;&lt;/a&gt;Web Service SAX Injection&lt;/h2&gt;&lt;p&gt;有些Web界面在后台使用的是Web Services。而Web Services通过SOAP请求进行通信。该节课程需要我们修改除了用户101以外的另一个用户的密码：&lt;br&gt;&lt;img src=&quot;/images/webgoat_web_services/6.png&quot; alt=&quot;6&quot;&gt;&lt;br&gt;拦截后，把请求修改为如下：&lt;br&gt;&lt;img src=&quot;/images/webgoat_web_services/7.png&quot; alt=&quot;7&quot;&gt;&lt;br&gt;最后成功修改了编号102的密码：&lt;br&gt;&lt;img src=&quot;/images/webgoat_web_services/8.png&quot; alt=&quot;8&quot;&gt;&lt;br&gt;图片下面部分显示的是我们发送过去的请求。&lt;br&gt;其原理就是：SAX解析器会解析任何格式正常的XML文件，例如：匹配到有效的标记符号及闭合符号即认为正确。当您向原有的XML文件中添加新的changePAssword元素时，如果id和password等标记都正确，那么解析器将很乐意帮您去修改另一个userid的密码。我们在password字段增加了多余的恶意代码。&lt;/p&gt;
&lt;h2 id=&quot;Web-Service-SQL-Injection&quot;&gt;&lt;a href=&quot;#Web-Service-SQL-Injection&quot; class=&quot;headerlink&quot; title=&quot;Web Service SQL Injection&quot;&gt;&lt;/a&gt;Web Service SQL Injection&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/images/webgoat_web_services/9.png&quot; alt=&quot;9&quot;&gt;&lt;br&gt;要求我们查看WSDL文件，并尝试获取多个客户的信用卡帐号。&lt;br&gt;这一节与第一节一样，需要我们自己构造一个SOAP请求，构造如下请求发送：&lt;br&gt;&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;POST http://127.0.0.1:8080/WebGoat/services/WsSqlInjection HTTP/1.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Accept: application/soap+xml, application/dime, multipart/related, text/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Host: 127.0.0.1:8080&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Content-Type: text/xml; charset=utf-8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SOAPAction: &quot;&quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Content-length: 584&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Authorization: Basic Z3Vlc3Q6Z3Vlc3Q=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;wsns0:Envelope&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;xmlns:wsns1&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&#39;http://www.w3.org/2001/XMLSchema-instance&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;xmlns:xsd&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&#39;http://www.w3.org/2001/XMLSchema&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;xmlns:wsns0&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&#39;http://schemas.xmlsoap.org/soap/envelope/&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;wsns0:Body&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;wsns0:encodingStyle&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&#39;http://schemas.xmlsoap.org/soap/encoding/&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;wsns2:getCreditCard&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;attr&quot;&gt;xmlns:wsns2&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&#39;http://lessons.webgoat.owasp.org&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;id&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;xsi:type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&#39;xsd:string&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              &lt;span class=&quot;attr&quot;&gt;xmlns:xsi&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&#39;http://www.w3.org/2001/XMLSchema-instance&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;gt;&lt;/span&gt;1 or 1=1&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;id&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;ns2:getCreditCard&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;ns0:Body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;ns0:Envelope&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这里主要注意上面的ID是：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1 or 1=1&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;并且注意这里POST的地址与第一小节的地址是不一样的。&lt;br&gt;并且在getCreditCard之间加了一个id，写为string，然后传为以上值。攻击成功。服务器返回所有人的信用卡值：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/webgoat_web_services/11.png&quot; alt=&quot;11&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h2&gt;&lt;p&gt;这一节实验花了较多的时间，主要是对于Web Services基础理解不熟，然后在做第三小节的时候，先是用Webscarab攻击成功之后，看源码，再在burpsuit里面做的。  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/05/05/Webgoat之Web_Services/&quot;&gt;http://qimingyu.github.io/2016/05/05/Webgoat之Web_Services/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;什么是Web Service？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Web Service就是一种基于Web 的服务，但这个服务需要供求双方按照规定去做才能实现的服务。&lt;/li&gt;
&lt;li&gt;Web Service就是一个应用程序，它向外界暴露出一个能够通过Web进行调用的API。这就是说，你能够用编程的方法通过Web来调用这个应用程序。我们把能调用这个Web service 的应用程序叫做客户端程序。&lt;/li&gt;
&lt;li&gt;Web Service希望实现不同的系统之间能够用“软件-软件对话”的方式相互调用，打破了软件应用、网站和各种设备之间的格格不入的状态，实现“基于Web无缝集成”的目标。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;详细内容见&lt;a href=&quot;http://blog.csdn.net/weiguolee/article/details/6881411&quot;&gt;这里&lt;/a&gt;，它有三要素：WSDL用来描述服务；UDDI用来注册和查找服务；SOAP用来在消费者和服务提供者之间传送消息。&lt;br&gt;
    
    </summary>
    
      <category term="应用安全" scheme="http://qimingyu.github.io/categories/%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络渗透" scheme="http://qimingyu.github.io/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
      <category term="WebGoat" scheme="http://qimingyu.github.io/tags/WebGoat/"/>
    
      <category term="Web服务漏洞" scheme="http://qimingyu.github.io/tags/Web%E6%9C%8D%E5%8A%A1%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
  <entry>
    <title>Webgoat之Concurrency</title>
    <link href="http://qimingyu.github.io/2016/05/05/Webgoat%E4%B9%8BConcurrency/"/>
    <id>http://qimingyu.github.io/2016/05/05/Webgoat之Concurrency/</id>
    <published>2016-05-05T06:51:24.000Z</published>
    <updated>2016-05-05T07:47:31.000Z</updated>
    
    <content type="html">&lt;p&gt;这一节主要是讲线程安全的问题，考虑并发性。一个Web服务器总是同时服务很多人的，并且是同时处理很多的HTTP请求的，如果开发人员使用的变量不是线程安全的话，会存在并发带来的安全威胁。因为所有的线程共享同一个方法区，而所有的类变量都存储在方法区，多个线程试图同时使用相同的类变量，会造成错误。&lt;/p&gt;
&lt;h2 id=&quot;Thread-Safety-Problems&quot;&gt;&lt;a href=&quot;#Thread-Safety-Problems&quot; class=&quot;headerlink&quot; title=&quot;Thread Safety Problems&quot;&gt;&lt;/a&gt;Thread Safety Problems&lt;/h2&gt;&lt;p&gt;线程的安全问题。假设有两个用户同时登陆一个网站查看自己的账户，如果他们在同一时间登陆的话，网站的反馈会发生错乱。该部分需要用两个浏览器，一个输入用户名“jeff”，一个输入用户名“dave”，如下图所示：&lt;br&gt;&lt;img src=&quot;/images/webgoat_concurrency/1.png&quot; alt=&quot;1&quot;&gt;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;需要以尽可能快的速度同时点击“提交”按钮。&lt;br&gt;&lt;img src=&quot;/images/webgoat_concurrency/2.png&quot; alt=&quot;2&quot;&gt;&lt;br&gt;如图所示，两个人看到的都是jeff的账户，另一个dave的人却进入了jeff的账户。这是服务端并发性错误引起的。&lt;/p&gt;
&lt;h2 id=&quot;Shopping-Cart-Concurrency-Flaw&quot;&gt;&lt;a href=&quot;#Shopping-Cart-Concurrency-Flaw&quot; class=&quot;headerlink&quot; title=&quot;Shopping Cart Concurrency Flaw&quot;&gt;&lt;/a&gt;Shopping Cart Concurrency Flaw&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/images/webgoat_concurrency/3.png&quot; alt=&quot;3&quot;&gt;&lt;br&gt;这是一个购物车的页面，需要我们以少的钱买高价值的商品。&lt;br&gt;首先用浏览器A，选择169美元的商品，并且点击购买，得到如下界面：&lt;br&gt;&lt;img src=&quot;/images/webgoat_concurrency/4.png&quot; alt=&quot;4&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后用浏览器B，选一个1799美元的商品，点击更新，浏览器B显示为这样：&lt;br&gt;&lt;img src=&quot;/images/webgoat_concurrency/5.png&quot; alt=&quot;5&quot;&gt;&lt;/p&gt;
&lt;p&gt;此时浏览器A再点击确认就变成了这样：&lt;br&gt;&lt;img src=&quot;/images/webgoat_concurrency/6.png&quot; alt=&quot;6&quot;&gt;&lt;/p&gt;
&lt;p&gt;说明对于浏览器A而言，他用169美元买了1799美元的商品。&lt;br&gt;这个原因在于浏览器B的更新时，浏览器A受影响了，服务器没有很好的处理多线程的问题。&lt;/p&gt;
&lt;h2 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h2&gt;&lt;p&gt;多线程和并发安全在网络安全中也是需要考虑的。  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/05/05/Webgoat之Concurrency/&quot;&gt;http://qimingyu.github.io/2016/05/05/Webgoat之Concurrency/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;这一节主要是讲线程安全的问题，考虑并发性。一个Web服务器总是同时服务很多人的，并且是同时处理很多的HTTP请求的，如果开发人员使用的变量不是线程安全的话，会存在并发带来的安全威胁。因为所有的线程共享同一个方法区，而所有的类变量都存储在方法区，多个线程试图同时使用相同的类变量，会造成错误。&lt;/p&gt;
&lt;h2 id=&quot;Thread-Safety-Problems&quot;&gt;&lt;a href=&quot;#Thread-Safety-Problems&quot; class=&quot;headerlink&quot; title=&quot;Thread Safety Problems&quot;&gt;&lt;/a&gt;Thread Safety Problems&lt;/h2&gt;&lt;p&gt;线程的安全问题。假设有两个用户同时登陆一个网站查看自己的账户，如果他们在同一时间登陆的话，网站的反馈会发生错乱。该部分需要用两个浏览器，一个输入用户名“jeff”，一个输入用户名“dave”，如下图所示：&lt;br&gt;&lt;img src=&quot;/images/webgoat_concurrency/1.png&quot; alt=&quot;1&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="应用安全" scheme="http://qimingyu.github.io/categories/%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络渗透" scheme="http://qimingyu.github.io/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
      <category term="WebGoat" scheme="http://qimingyu.github.io/tags/WebGoat/"/>
    
      <category term="并发性" scheme="http://qimingyu.github.io/tags/%E5%B9%B6%E5%8F%91%E6%80%A7/"/>
    
  </entry>
  
  <entry>
    <title>Webgoat之Session Management Flaws</title>
    <link href="http://qimingyu.github.io/2016/05/04/Webgoat%E4%B9%8BSession_Management_Flaws/"/>
    <id>http://qimingyu.github.io/2016/05/04/Webgoat之Session_Management_Flaws/</id>
    <published>2016-05-04T10:00:59.000Z</published>
    <updated>2016-05-05T06:32:43.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;Hijack-a-Session&quot;&gt;&lt;a href=&quot;#Hijack-a-Session&quot; class=&quot;headerlink&quot; title=&quot;Hijack a Session&quot;&gt;&lt;/a&gt;Hijack a Session&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/1.png&quot; alt=&quot;1&quot;&gt;&lt;br&gt;如图是一个登陆页面，现在要求在不知道用户名和密码的情况下登陆进去。现在我们已经知道的是如果传过去的cookie是对的话，服务器端会跳过验证用户名和密码的环节。也就是说用户名和密码可以随便填写，关键是猜对cookie，并且这个cookie需要是正在使用的会话cookie。我们先随便抓一个看看所提交的是哪些数据：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/2.png&quot; alt=&quot;2&quot;&gt;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;可以看到在请求头中cookie有两个，一个是WEAKID，一个是JSESSION，我们主要是猜对请求头的WEAKID，这是我们的会话ID。首先我们连续刷新该页面，观察服务器传过来的cookie的变化。也就是说在刷新该页面的时候，需要删掉WEAKID后再发送请求，这样每次服务器都会传过来一个WEAKID，我们可以观察其规律。先试第一个，我们提交一个请求后，服务器传过来的响应是这样的：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/3.png&quot; alt=&quot;3&quot;&gt;&lt;br&gt;继续提交一个请求，服务器传过来的响应是这样的：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/4.png&quot; alt=&quot;4&quot;&gt;&lt;br&gt;可以发现WEAKID由两部分组成，减号前面是依次递增的，减号后面也是递增的，这是我们观察之后的结论。下面继续验证，采用burpsuit提供的自动化发包工具，提交一个数据，抓到之后删掉WEAKID，然后点击Action发送到Sequencer。然后进行相应的设置：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/5.png&quot; alt=&quot;5&quot;&gt;&lt;br&gt;上面是选择tooken出现的地方。&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/6.png&quot; alt=&quot;6&quot;&gt;&lt;br&gt;上面是选择运行的线程个数。然后点击Start live capture，开始抓包：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/7.png&quot; alt=&quot;7&quot;&gt;&lt;br&gt;上面表示已经发送的请求和已经抓到的tooken。此时点击copy token，再回到Manual load，点击Paste：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/8.png&quot; alt=&quot;8&quot;&gt;&lt;br&gt;上图可以看到这是我们抓到的所有token，都是连续的，但是只有16964和16966之间却缺少了16965，因此我们猜测这个token是一个已经登录进去的会话，我们可以利用这个会话进行登录。现在我们需要猜测减号后面的那部分数据，它是在1462418466736到1462418466754之间的，下面使用暴力破解，我们将请求继续发送到Intruder，如下图所示：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/9.png&quot; alt=&quot;9&quot;&gt;&lt;br&gt;给cookie的最后两位数增加变量，然后给该变量设置范围，burpsuit会根据你设定的范围一个个的去试，如下图所示：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/10.png&quot; alt=&quot;10&quot;&gt;&lt;br&gt;上面对相关变量的一些设置。然后点击Stack Attack。&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/11.png&quot; alt=&quot;11&quot;&gt;&lt;br&gt;可以看到有一条记录服务器响应的长度与其他记录不一样，而上图下方显示的是该条记录具体发送的内容和服务器的响应。最后可以看到以该内容作为请求发送时，成功登陆了：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/12.png&quot; alt=&quot;12&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Spoof-an-Anthentication-cookie&quot;&gt;&lt;a href=&quot;#Spoof-an-Anthentication-cookie&quot; class=&quot;headerlink&quot; title=&quot;Spoof an Anthentication cookie&quot;&gt;&lt;/a&gt;Spoof an Anthentication cookie&lt;/h2&gt;&lt;p&gt;如下登陆页面：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/13.png&quot; alt=&quot;13&quot;&gt;&lt;br&gt;我们有两个用户名和密码，分别为：webgoat/webgoat、aspect/aspect，现在我们还知道alice的用户名却不知道其密码，要求我们以alice的身份登陆。&lt;br&gt;我们尝试以webgoat的身份进行登陆，发现登陆时的请求为：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/14.png&quot; alt=&quot;14&quot;&gt;&lt;br&gt;服务器端的响应为：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/15.png&quot; alt=&quot;15&quot;&gt;&lt;br&gt;可见登陆的时候是没有AuthCookie的，登陆之后服务器传给浏览器一个AuthCookie，我们观察其值。&lt;br&gt;下面以aspect身份进行登陆，看到：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/16.png&quot; alt=&quot;16&quot;&gt;&lt;br&gt;观察如下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;webgoat  ——&amp;gt;  65432ubphcfs&lt;br&gt;aspect   ——&amp;gt;  65432udfqtb&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;可以找到规律了，就是把字母反过来，再向后移动一位。&lt;br&gt;那么猜测alice的AuthCookie为：65432fdjmb，在用户名和密码那里什么都不填，直接提交，burpsuit拦截后修改cookie如下：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/17.png&quot; alt=&quot;17&quot;&gt;&lt;br&gt;然后成功登陆:&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/18.png&quot; alt=&quot;18&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Session-Fixation&quot;&gt;&lt;a href=&quot;#Session-Fixation&quot; class=&quot;headerlink&quot; title=&quot;Session Fixation&quot;&gt;&lt;/a&gt;Session Fixation&lt;/h2&gt;&lt;p&gt;通过会话固定盗取Session。服务器通过每个用户唯一的Session ID来确认其合法性。如果用户已登录，并且授权服务器不必重新验证授权后，当该用户需要重新登录进入系统时，他的Session ID 依然被服务器认为是合法的。&lt;br&gt;在一些程序中，可能会在GET-REQUEST请求中传递Session ID。这就是攻击的起点。一个攻击者可以用一个选定的Session ID给受害人发送一个超链接。例如，这里有一个准备好的邮件，它看起来像是一个从应用程序管理员发来的官方邮件。如果受害者点击了这个链接，并且该受害者以攻击者指定的Session ID登录了系统，那么攻击者可以不经授权直接使用与受害者相同的Session ID来访问该页面。&lt;br&gt;在实际课程中需要我们同时扮演攻击者和受害者，攻击者是Hacker，受害者是Jane。&lt;br&gt;首先由Hacker向Jane发一封看起来很正常的邮件，该邮件是关于银行对账单的。需要诱导受害者点击该邮件的链接。该邮件为：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/20.png&quot; alt=&quot;20&quot;&gt;&lt;br&gt;邮件中间是一个超链接，对应的代码为：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/19.png&quot; alt=&quot;19&quot;&gt;&lt;br&gt;然后受害者点击了该超链接，进入他的银行系统的登陆页面：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/21.png&quot; alt=&quot;21&quot;&gt;&lt;br&gt;该页面的链接地址为：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://localhost:8443/WebGoat/attack?Screen=16&amp;amp;menu=1700&amp;amp;SID=qimingyu&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://localhost:8443/WebGoat/attack?Screen=16&amp;amp;menu=1700&amp;amp;SID=qimingyu&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;受害者本人要登陆系统，肯定知道自己的账号和密码。于是输入账号：Jane，密码：tarzan，进入系统。受害者进入系统之后，他的sessionID已经通过验证，就是有效的了。这时，黑客也进入该银行系统的登陆页面，此时的地址为：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://localhost:8443/WebGoat/attack?Screen=16&amp;amp;menu=1700&amp;amp;SID=NOVALIDSESSION&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://localhost:8443/WebGoat/attack?Screen=16&amp;amp;menu=1700&amp;amp;SID=NOVALIDSESSION&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;将后面的SID修改为qimingyu，无需输入用户名和密码，就可以以受害者Jane的身份登陆该系统了。&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/22.png&quot; alt=&quot;22&quot;&gt;&lt;br&gt;这是一连串精心构造的攻击，其关键漏洞是网站依靠URL来传递SID的值，容易被人截取并修改。&lt;/p&gt;
&lt;h2 id=&quot;Summarize&quot;&gt;&lt;a href=&quot;#Summarize&quot; class=&quot;headerlink&quot; title=&quot;Summarize&quot;&gt;&lt;/a&gt;Summarize&lt;/h2&gt;&lt;p&gt;第一节是通过暴力猜对cookie绕过验证进行登陆。&lt;br&gt;第二节是通过观察猜对cookie绕过验证进行登陆。&lt;br&gt;第三节是诱骗受害者以固定的Session登陆，然后攻击者再通过该Session绕过验证直接登陆。  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;【版权声明】&lt;/strong&gt;&lt;br&gt;本文首发于&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰的博客&lt;/a&gt;（ &lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;http://qimingyu.github.io/&lt;/a&gt; ），欢迎转载，但是必须保留本文的署名&lt;a href=&quot;http://qimingyu.github.io/&quot;&gt;戚名钰&lt;/a&gt;（包含链接）。如您有任何商业合作或者授权方面的协商，请给我留言：mingyuqi.java@qq.com&lt;br&gt;本文永久链接：&lt;a href=&quot;http://qimingyu.github.io/2016/05/04/Webgoat之Session_Management_Flaws/&quot;&gt;http://qimingyu.github.io/2016/05/04/Webgoat之Session_Management_Flaws/&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Hijack-a-Session&quot;&gt;&lt;a href=&quot;#Hijack-a-Session&quot; class=&quot;headerlink&quot; title=&quot;Hijack a Session&quot;&gt;&lt;/a&gt;Hijack a Session&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/1.png&quot; alt=&quot;1&quot;&gt;&lt;br&gt;如图是一个登陆页面，现在要求在不知道用户名和密码的情况下登陆进去。现在我们已经知道的是如果传过去的cookie是对的话，服务器端会跳过验证用户名和密码的环节。也就是说用户名和密码可以随便填写，关键是猜对cookie，并且这个cookie需要是正在使用的会话cookie。我们先随便抓一个看看所提交的是哪些数据：&lt;br&gt;&lt;img src=&quot;/images/webgoat_session_management_flaws/2.png&quot; alt=&quot;2&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="应用安全" scheme="http://qimingyu.github.io/categories/%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="网络渗透" scheme="http://qimingyu.github.io/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
      <category term="WebGoat" scheme="http://qimingyu.github.io/tags/WebGoat/"/>
    
      <category term="会话管理" scheme="http://qimingyu.github.io/tags/%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
</feed>
